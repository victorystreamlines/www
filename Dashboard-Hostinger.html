<!--
HOSTINGER DATABASE CONTROL PANEL
LAYOUT: sidebar
THEME: gradient-sunset
CSS_FRAMEWORK: tailwind
LANGUAGE: english
SERVER: Hostinger (Shared/VPS)
DATABASE_OPERATIONS: Manage Hostinger database connections
TABLE_OPERATIONS: list_tables, create_table, edit_table, delete_table, rename_table
PHASE: Hostinger Edition
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hostinger Database Control Panel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #991b1b 100%);
            min-height: 100vh;
            color: #fef3c7;
        }

        /* Sidebar Navigation */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 260px;
            height: 100vh;
            background: rgba(0, 0, 0, 0.3);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            padding: 20px;
            transition: transform 0.3s ease;
            z-index: 1000;
            border-right: 1px solid rgba(251, 191, 36, 0.2);
        }

        .sidebar.collapsed {
            transform: translateX(-260px);
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(251, 191, 36, 0.3);
        }

        .sidebar-title {
            font-size: 20px;
            font-weight: bold;
            color: #fbbf24;
        }

        .sidebar-toggle {
            background: none;
            border: none;
            color: #fbbf24;
            cursor: pointer;
            font-size: 20px;
            padding: 5px;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 10px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            color: #fef3c7;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .nav-link:hover {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
            transform: translateX(5px);
        }

        .nav-link.active {
            background: rgba(251, 191, 36, 0.3);
            color: #fbbf24;
            border-left: 3px solid #f59e0b;
        }

        .nav-icon {
            margin-right: 10px;
            font-size: 18px;
        }

        /* Main Content Area */
        .main-content {
            margin-left: 260px;
            padding: 30px;
            transition: margin-left 0.3s ease;
            min-height: 100vh;
        }

        .main-content.expanded {
            margin-left: 0;
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .page-title {
            font-size: 32px;
            font-weight: bold;
            color: #fbbf24;
        }

        .toggle-sidebar-btn {
            display: none;
            background: rgba(251, 191, 36, 0.2);
            border: 1px solid #fbbf24;
            color: #fbbf24;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .toggle-sidebar-btn:hover {
            background: rgba(251, 191, 36, 0.3);
        }

        /* Cards */
        .card {
            background: rgba(255, 255, 255, 0.1);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid rgba(251, 191, 36, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }

        .card-title {
            font-size: 20px;
            font-weight: bold;
            color: #fbbf24;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        .card-title-icon {
            margin-right: 10px;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: #fef3c7;
            font-weight: 500;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(251, 191, 36, 0.3);
            border-radius: 8px;
            color: #fef3c7;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #fbbf24;
            background: rgba(255, 255, 255, 0.15);
        }

        .form-input::placeholder {
            color: rgba(254, 243, 199, 0.5);
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #fbbf24;
            color: #1e3a8a;
        }

        .btn-primary:hover {
            background: #f59e0b;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(251, 191, 36, 0.4);
        }

        .btn-danger {
            background: #dc2626;
            color: white;
        }

        .btn-danger:hover {
            background: #b91c1c;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 38, 38, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #fef3c7;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Database List */
        .database-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        /* Database Card - Vertical Flex (3 Rows) */
        .database-item {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(251, 191, 36, 0.2);
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            flex-direction: column;
            gap: 15px;
            min-height: 280px;
            cursor: pointer;
        }

        .database-item:hover {
            background: rgba(251, 191, 36, 0.15);
            border-color: #fbbf24;
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(251, 191, 36, 0.3);
        }

        /* Row 1: Logo/Icon (Centered) */
        .database-icon-row {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(251, 191, 36, 0.15);
        }

        .database-icon {
            font-size: 48px;
        }

        /* Row 2: Text Content (Connection Name, Database, Host) */
        .database-text-row {
            display: flex;
            flex-direction: column;
            gap: 10px;
            flex: 1;
            padding: 10px 0;
        }

        .database-name {
            font-size: 18px;
            font-weight: bold;
            color: #fbbf24;
            text-align: center;
            word-wrap: break-word;
            overflow-wrap: break-word;
            margin-bottom: 8px;
        }

        .database-info-item {
            font-size: 13px;
            color: rgba(254, 243, 199, 0.8);
            text-align: center;
            word-wrap: break-word;
            overflow-wrap: break-word;
            font-family: monospace;
        }

        /* Row 3: Status + Button */
        .database-actions-row {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding-top: 10px;
            border-top: 1px solid rgba(251, 191, 36, 0.15);
        }

        .database-status {
            padding: 10px;
            border-radius: 6px;
            font-size: 12px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-height: 40px;
        }

        .database-status.testing {
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid #3b82f6;
            color: #93c5fd;
        }

        .database-status.success {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid #22c55e;
            color: #86efac;
        }

        .database-status.error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
            color: #fca5a5;
        }

        .database-button {
            width: 100%;
            padding: 10px;
            font-size: 13px;
        }

        .lock-icon {
            position: absolute;
            top: 10px;
            right: 10px;
            color: #fbbf24;
            font-size: 16px;
        }

        /* Messages */
        .message {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.success {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid #22c55e;
            color: #86efac;
        }

        .message.error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
            color: #fca5a5;
        }

        .message.info {
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid #3b82f6;
            color: #93c5fd;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            -webkit-backdrop-filter: blur(5px);
            backdrop-filter: blur(5px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(30, 58, 138, 0.95) 0%, rgba(153, 27, 27, 0.95) 100%);
            border: 1px solid rgba(251, 191, 36, 0.3);
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 22px;
            font-weight: bold;
            color: #fbbf24;
        }

        .modal-close {
            background: none;
            border: none;
            color: #fef3c7;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
        }

        .modal-close:hover {
            color: #fbbf24;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* Loading Spinner */
        .spinner {
            border: 3px solid rgba(251, 191, 36, 0.3);
            border-top: 3px solid #fbbf24;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Expandable Section */
        .expandable-section {
            margin-top: 15px;
        }

        .expandable-header {
            cursor: pointer;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
        }

        .expandable-header:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .expandable-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .expandable-content.expanded {
            max-height: 500px;
            margin-top: 15px;
        }

        .helper-text {
            font-size: 12px;
            color: rgba(254, 243, 199, 0.7);
            margin-top: 5px;
        }

        .security-notice {
            background: rgba(245, 158, 11, 0.2);
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 13px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-260px);
            }

            .sidebar.show {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .toggle-sidebar-btn {
                display: block;
            }

            .database-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Datalist styling hint */
        .datalist-wrapper {
            position: relative;
        }

        .saved-credentials-badge {
            display: inline-block;
            background: rgba(34, 197, 94, 0.2);
            color: #86efac;
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 4px;
            margin-left: 10px;
        }

        /* Table Operations Styles */
        .connection-status {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid #22c55e;
            color: #86efac;
            padding: 12px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            font-weight: 500;
        }

        .connection-status.active {
            display: block;
        }

        .column-builder {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(251, 191, 36, 0.2);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .column-row {
            display: grid;
            grid-template-columns: 2fr 2fr 1fr 1fr 1fr auto;
            gap: 10px;
            margin-bottom: 10px;
            align-items: end;
        }

        .column-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 6px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-group label {
            margin: 0;
            cursor: pointer;
            color: #fef3c7;
            font-size: 13px;
        }

        .btn-icon {
            width: 40px;
            height: 40px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .sql-preview {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(251, 191, 36, 0.2);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #86efac;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 300px;
            overflow-y: auto;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .template-card {
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(251, 191, 36, 0.2);
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .template-card:hover {
            border-color: #fbbf24;
            background: rgba(251, 191, 36, 0.15);
            transform: translateY(-3px);
        }

        .template-card.selected {
            border-color: #fbbf24;
            background: rgba(251, 191, 36, 0.2);
        }

        .template-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .template-name {
            font-weight: bold;
            color: #fef3c7;
            margin-bottom: 5px;
        }

        .template-desc {
            font-size: 11px;
            color: rgba(254, 243, 199, 0.6);
        }

        .table-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .table-item {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(251, 191, 36, 0.2);
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .table-item:hover {
            background: rgba(251, 191, 36, 0.15);
            border-color: #fbbf24;
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(251, 191, 36, 0.3);
        }

        .table-actions {
            display: flex;
            gap: 8px;
            padding-top: 10px;
            border-top: 1px solid rgba(251, 191, 36, 0.15);
        }

        .table-actions .btn {
            flex: 1;
            padding: 8px 12px;
            font-size: 12px;
            white-space: nowrap;
        }

        .table-actions .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* CRUD Action buttons */
        .btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .btn:disabled:hover {
            transform: none;
            box-shadow: none;
        }

        /* SQL Autocomplete - Ghost Text */
        .sql-ac-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .sql-ac-ghost {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow: hidden;
            padding: 12px 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            color: transparent;
            z-index: 1;
        }

        .sql-ac-ghost-text {
            color: rgba(147, 197, 253, 0.4);
            background: rgba(59, 130, 246, 0.1);
        }

        .sql-ac-textarea {
            position: relative;
            background: transparent;
            z-index: 2;
        }

        #sqlSuggestions {
            scrollbar-width: thin;
            scrollbar-color: rgba(251, 191, 36, 0.5) rgba(0, 0, 0, 0.3);
        }

        #sqlSuggestions::-webkit-scrollbar {
            width: 8px;
        }

        #sqlSuggestions::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
        }

        #sqlSuggestions::-webkit-scrollbar-thumb {
            background: rgba(251, 191, 36, 0.5);
            border-radius: 4px;
        }

        .sql-suggestion-item:last-child {
            border-bottom: none !important;
        }

        .table-name {
            font-size: 16px;
            font-weight: bold;
            color: #fef3c7;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .table-icon {
            font-size: 24px;
        }

        /* Tab styles for create table */
        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(251, 191, 36, 0.2);
        }

        .tab-btn {
            background: none;
            border: none;
            color: #fef3c7;
            padding: 12px 24px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
        }

        .tab-btn:hover {
            color: #fbbf24;
        }

        .tab-btn.active {
            color: #fbbf24;
            border-bottom-color: #fbbf24;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Migration Table Box Styles */
        .migration-table-box {
            flex: 0 0 calc(33.333% - 7px);
            min-width: 120px;
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.1) 0%, rgba(251, 191, 36, 0.05) 100%);
            border: 2px solid rgba(251, 191, 36, 0.3);
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            user-select: none;
        }

        .migration-table-box:hover {
            transform: translateY(-3px);
            border-color: #fbbf24;
            box-shadow: 0 5px 15px rgba(251, 191, 36, 0.3);
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.2) 0%, rgba(251, 191, 36, 0.1) 100%);
        }

        .migration-table-box.selected {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.3) 0%, rgba(34, 197, 94, 0.15) 100%);
            border-color: #22c55e;
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.4);
        }

        .migration-table-box.selected:hover {
            transform: translateY(-3px);
            border-color: #86efac;
        }

        .migration-table-emoji {
            font-size: 32px;
            margin-bottom: 8px;
            display: block;
        }

        .migration-table-name {
            color: #fef3c7;
            font-size: 13px;
            font-weight: 500;
            word-wrap: break-word;
            line-height: 1.3;
        }

        .migration-table-box.selected .migration-table-name {
            color: #86efac;
        }

        .migration-check-icon {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #22c55e;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .migration-table-box.selected .migration-check-icon {
            opacity: 1;
        }

        /* Drag and Drop styles */
        .migration-table-box.dragging {
            opacity: 0.5;
            cursor: grabbing !important;
            transform: scale(1.05) rotate(3deg);
            transition: transform 0.2s;
            box-shadow: 0 10px 30px rgba(251, 191, 36, 0.5);
            border-color: #fbbf24 !important;
            z-index: 1000;
            animation: wiggle 0.3s ease-in-out infinite;
        }

        @keyframes wiggle {
            0%, 100% { transform: scale(1.05) rotate(3deg); }
            50% { transform: scale(1.05) rotate(-3deg); }
        }

        .migration-drop-zone {
            position: relative;
            transition: all 0.3s ease;
        }

        .migration-drop-zone.drag-over {
            border-color: #22c55e !important;
            border-width: 3px !important;
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.2) 0%, rgba(251, 191, 36, 0.2) 100%) !important;
            box-shadow: inset 0 0 40px rgba(34, 197, 94, 0.4), 0 0 20px rgba(251, 191, 36, 0.3);
            animation: dropZonePulse 1s ease-in-out infinite;
        }

        @keyframes dropZonePulse {
            0%, 100% { box-shadow: inset 0 0 40px rgba(34, 197, 94, 0.4), 0 0 20px rgba(251, 191, 36, 0.3); }
            50% { box-shadow: inset 0 0 50px rgba(34, 197, 94, 0.6), 0 0 30px rgba(251, 191, 36, 0.5); }
        }

        .migration-drop-zone.drag-over::before {
            content: 'üì• Drop Here to Move Table';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #22c55e;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.9);
            pointer-events: none;
            z-index: 1000;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.95) 0%, rgba(34, 197, 94, 0.2) 100%);
            padding: 25px 40px;
            border-radius: 15px;
            border: 3px solid #22c55e;
            animation: fadeInScale 0.3s ease-out;
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        /* Migration tables container scrollbar */
        #migrationTablesContainer::-webkit-scrollbar {
            width: 8px;
        }

        #migrationTablesContainer::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
        }

        #migrationTablesContainer::-webkit-scrollbar-thumb {
            background: rgba(251, 191, 36, 0.5);
            border-radius: 4px;
        }

        #migrationTablesContainer::-webkit-scrollbar-thumb:hover {
            background: rgba(251, 191, 36, 0.7);
        }

        /* Destination tables container scrollbar */
        #migrationDestinationTablesContainer::-webkit-scrollbar {
            width: 8px;
        }

        #migrationDestinationTablesContainer::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
        }

        #migrationDestinationTablesContainer::-webkit-scrollbar-thumb {
            background: rgba(34, 197, 94, 0.5);
            border-radius: 4px;
        }

        #migrationDestinationTablesContainer::-webkit-scrollbar-thumb:hover {
            background: rgba(34, 197, 94, 0.7);
        }

        /* Destination dropdown hover effect */
        #migrationDestinationSelect:hover {
            border-color: #86efac;
            box-shadow: 0 0 15px rgba(34, 197, 94, 0.3);
        }

        #migrationDestinationSelect:focus {
            border-color: #22c55e;
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.5);
        }

        /* Arrow pulse animation */
        @keyframes pulse {
            0%, 100% {
                opacity: 0.5;
                transform: scale(1);
            }
            50% {
                opacity: 1;
                transform: scale(1.2);
            }
        }

        @media (max-width: 768px) {
            .column-row {
                grid-template-columns: 1fr;
            }

            .template-grid {
                grid-template-columns: 1fr;
            }

            .migration-table-box {
                flex: 0 0 calc(50% - 5px);
            }
        }

        /* Hidden sections - for temporary hiding */
        .hidden-section {
            display: none !important;
        }

        /* Table Data Viewer Styles */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 0;
            font-size: 13px;
        }

        .data-table thead {
            background: rgba(251, 191, 36, 0.2);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .data-table th {
            padding: 12px 15px;
            text-align: left;
            color: #fbbf24;
            font-weight: bold;
            border-bottom: 2px solid rgba(251, 191, 36, 0.3);
            white-space: nowrap;
        }

        .data-table td {
            padding: 10px 15px;
            color: #fef3c7;
            border-bottom: 1px solid rgba(251, 191, 36, 0.1);
            word-wrap: break-word;
            max-width: 300px;
        }

        .data-table tbody tr {
            transition: all 0.2s ease;
        }

        .data-table tbody tr:hover {
            background: rgba(251, 191, 36, 0.1);
        }

        .data-table tbody tr:nth-child(even) {
            background: rgba(255, 255, 255, 0.02);
        }

        .data-table tbody tr:nth-child(even):hover {
            background: rgba(251, 191, 36, 0.1);
        }

        /* Actions column hover effect */
        .data-table tbody tr:hover td:first-child {
            background: rgba(251, 191, 36, 0.15) !important;
        }

        .stat-box {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(251, 191, 36, 0.2);
            transition: all 0.3s ease;
        }

        .stat-box:hover {
            background: rgba(251, 191, 36, 0.1);
            border-color: #fbbf24;
        }

        .stat-label {
            font-size: 12px;
            color: rgba(254, 243, 199, 0.7);
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 18px;
            color: #fbbf24;
            font-weight: bold;
        }

        .pagination-info {
            color: rgba(254, 243, 199, 0.8);
            font-size: 14px;
        }

        .pagination-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .page-input {
            width: 60px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(251, 191, 36, 0.3);
            border-radius: 6px;
            color: #fef3c7;
            text-align: center;
        }

        /* SQL Modal specific styles */
        #sqlCode {
            scrollbar-width: thin;
            scrollbar-color: rgba(251, 191, 36, 0.5) rgba(0, 0, 0, 0.3);
        }

        #sqlCode::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        #sqlCode::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
        }

        #sqlCode::-webkit-scrollbar-thumb {
            background: rgba(251, 191, 36, 0.5);
            border-radius: 5px;
        }

        #sqlCode::-webkit-scrollbar-thumb:hover {
            background: rgba(251, 191, 36, 0.7);
        }

        /* Selected database card - Shiny/Glowing effect */
        .database-item.selected {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.25) 0%, rgba(245, 158, 11, 0.25) 100%);
            border: 2px solid #fbbf24;
            box-shadow: 0 0 30px rgba(251, 191, 36, 0.6), 0 8px 40px rgba(251, 191, 36, 0.4);
            transform: translateY(-5px) scale(1.02);
        }

        .database-item.selected .database-icon {
            animation: glow-pulse 2s ease-in-out infinite;
        }

        @keyframes glow-pulse {
            0%, 100% {
                filter: drop-shadow(0 0 8px rgba(251, 191, 36, 0.8));
            }
            50% {
                filter: drop-shadow(0 0 20px rgba(251, 191, 36, 1));
            }
        }

        /* Deselect button */
        .deselect-btn {
            display: none;
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            color: white;
            border: 1px solid #ef4444;
            padding: 8px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
        }

        .deselect-btn:hover {
            background: linear-gradient(135deg, #b91c1c 0%, #7f1d1d 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(220, 38, 38, 0.5);
        }

        .deselect-btn.active {
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        /* Card header with button */
        .card-header-with-action {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        /* Selected Database Badge in Sidebar */
        .selected-db-badge {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.25) 0%, rgba(245, 158, 11, 0.3) 100%);
            border: 2px solid #fbbf24;
            border-radius: 10px;
            padding: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.5), 0 4px 15px rgba(251, 191, 36, 0.3);
            animation: pulse-glow 2s ease-in-out infinite;
            position: relative;
            overflow: hidden;
        }

        .selected-db-badge::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shine 3s linear infinite;
        }

        @keyframes pulse-glow {
            0%, 100% {
                box-shadow: 0 0 20px rgba(251, 191, 36, 0.5), 0 4px 15px rgba(251, 191, 36, 0.3);
            }
            50% {
                box-shadow: 0 0 30px rgba(251, 191, 36, 0.8), 0 6px 25px rgba(251, 191, 36, 0.5);
            }
        }

        @keyframes shine {
            0% {
                transform: translateX(-100%) translateY(-100%) rotate(45deg);
            }
            100% {
                transform: translateX(100%) translateY(100%) rotate(45deg);
            }
        }

        .selected-db-icon {
            font-size: 28px;
            animation: rotate-sparkle 4s linear infinite;
            filter: drop-shadow(0 0 8px rgba(251, 191, 36, 0.8));
            flex-shrink: 0;
        }

        @keyframes rotate-sparkle {
            0%, 100% {
                transform: rotate(0deg) scale(1);
            }
            25% {
                transform: rotate(10deg) scale(1.1);
            }
            50% {
                transform: rotate(0deg) scale(1);
            }
            75% {
                transform: rotate(-10deg) scale(1.1);
            }
        }

        .selected-db-content {
            flex: 1;
            position: relative;
            z-index: 1;
        }

        .selected-db-label {
            font-size: 11px;
            color: rgba(254, 243, 199, 0.8);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .selected-db-name {
            font-size: 14px;
            color: #fbbf24;
            font-weight: bold;
            word-wrap: break-word;
            overflow-wrap: break-word;
            line-height: 1.3;
            text-shadow: 0 0 10px rgba(251, 191, 36, 0.5);
        }
    </style>
</head>
<body>
    <!-- Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-title">üåê Hostinger DB</div>
            <button class="sidebar-toggle" onclick="toggleSidebar()">‚ò∞</button>
        </div>
        <ul class="nav-menu">
            <li class="nav-item">
                <a class="nav-link active" onclick="showSection('dashboard')">
                    <span class="nav-icon">üìä</span>
                    <span>Dashboard</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" onclick="showSection('list')">
                    <span class="nav-icon">üìã</span>
                    <span>List Databases</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" onclick="showSection('create')">
                    <span class="nav-icon">‚ûï</span>
                    <span>Create Database</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" onclick="showSection('delete')">
                    <span class="nav-icon">üóëÔ∏è</span>
                    <span>Delete Database</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" onclick="showSection('rename')">
                    <span class="nav-icon">‚úèÔ∏è</span>
                    <span>Rename Database</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" onclick="showSection('credentials')">
                    <span class="nav-icon">üîê</span>
                    <span>Set Credentials</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" onclick="showSection('settings')">
                    <span class="nav-icon">‚öôÔ∏è</span>
                    <span>Hostinger Connections</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" onclick="showSection('generateDatabase')">
                    <span class="nav-icon">üóÑÔ∏è</span>
                    <span>Generate Database SQL</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" onclick="showSection('aiPrompt')">
                    <span class="nav-icon">ü§ñ</span>
                    <span>AI Connection Prompt</span>
                </a>
            </li>
            <!-- TABLE OPERATIONS - HIDDEN -->
            <li class="nav-item hidden-section" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(251, 191, 36, 0.3);">
                <div style="color: rgba(251, 191, 36, 0.7); font-size: 12px; padding: 0 15px; margin-bottom: 10px;">TABLE OPERATIONS</div>
            </li>
            <!-- Selected Database Alert -->
            <li id="selectedDatabaseAlert" class="nav-item hidden-section" style="padding: 0 10px; margin-bottom: 15px;">
                <div class="selected-db-badge">
                    <div class="selected-db-icon">‚ú®</div>
                    <div class="selected-db-content">
                        <div class="selected-db-label">Database Selected</div>
                        <div id="selectedDatabaseName" class="selected-db-name">Database Name</div>
                    </div>
                </div>
            </li>
            <li class="nav-item hidden-section">
                <a class="nav-link" onclick="showSection('listTables')">
                    <span class="nav-icon">üìÑ</span>
                    <span>List Tables</span>
                </a>
            </li>
            <li class="nav-item hidden-section">
                <a class="nav-link" onclick="showSection('createTable')">
                    <span class="nav-icon">‚ûï</span>
                    <span>Create Table</span>
                </a>
            </li>
            <li class="nav-item hidden-section">
                <a class="nav-link" onclick="showSection('editTable')">
                    <span class="nav-icon">‚úèÔ∏è</span>
                    <span>Edit Table</span>
                </a>
            </li>
            <li class="nav-item hidden-section">
                <a class="nav-link" onclick="showSection('deleteTable')">
                    <span class="nav-icon">üóëÔ∏è</span>
                    <span>Delete Table</span>
                </a>
            </li>
            <li class="nav-item hidden-section">
                <a class="nav-link" onclick="showSection('renameTable')">
                    <span class="nav-icon">‚úèÔ∏è</span>
                    <span>Rename Table</span>
                </a>
            </li>
        </ul>
    </aside>

    <!-- Main Content -->
    <main class="main-content" id="mainContent">
        <div class="content-header">
            <h1 class="page-title">Hostinger Database Control Panel</h1>
            <button class="toggle-sidebar-btn" onclick="toggleSidebar()">‚ò∞ Menu</button>
        </div>

        <!-- Dashboard Section -->
        <section id="dashboard" class="section active">
            <div class="card">
                <div class="card-header-with-action">
                    <h2 class="card-title" style="margin-bottom: 0;">
                        <span class="card-title-icon">üåê</span>
                        Configured Hostinger Connections
                    </h2>
                    <button id="deselectDatabaseBtn" class="deselect-btn" onclick="deselectAllDatabases()">
                        <span>‚úñÔ∏è</span>
                        <span>Deselect Database</span>
                    </button>
                </div>
                <div id="dashboardMessage"></div>
                <div id="configuredConnectionsList" class="database-grid" style="margin-top: 20px;">
                    <p style="color: rgba(254, 243, 199, 0.6); text-align: center; padding: 40px;">
                        No Hostinger connections configured.<br>
                        <span style="font-size: 14px;">Go to <strong>Hostinger Connections</strong> in the sidebar to add your first connection.</span>
                    </p>
                </div>
            </div>

            <div class="card">
                <h2 class="card-title">
                    <span class="card-title-icon">üíª</span>
                    Your PC Information
                </h2>
                <div style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.3); margin-bottom: 15px;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <span style="font-size: 24px;">üñ•Ô∏è</span>
                        <div>
                            <strong style="color: #fbbf24; font-size: 16px;">Your PC IP Address:</strong>
                            <div style="font-family: monospace; font-size: 18px; color: #3b82f6; margin-top: 5px;">192.168.8.4</div>
                        </div>
                    </div>
                    <div style="font-size: 13px; color: rgba(254, 243, 199, 0.7);">
                        üí° Use this IP when connecting to databases on your local network or for external access to your PC's MySQL server
                    </div>
                </div>
            </div>

            <div class="card">
                <h2 class="card-title">
                    <span class="card-title-icon">üìä</span>
                    Quick Guide
                </h2>
                <p>Welcome to the Hostinger Database Control Panel. Manage your Hostinger databases (Shared Hosting or VPS).</p>
                <ul style="margin-top: 15px; line-height: 1.8;">
                    <li>‚úÖ Add multiple Hostinger database connections</li>
                    <li>‚úÖ Test connection status for each database</li>
                    <li>‚úÖ Manage tables, create, edit, delete operations</li>
                    <li>‚úÖ Supports both Shared Hosting and VPS databases</li>
                    <li>‚úÖ All credentials stored locally in your browser</li>
                </ul>
            </div>
        </section>

        <!-- List Databases Section -->
        <section id="list" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span class="card-title-icon">üìã</span>
                    Available Databases
                </h2>
                <div id="listMessage"></div>
                <button class="btn btn-primary" onclick="loadDatabases()">
                    <span>üîÑ</span> Refresh List
                </button>
                <div id="databaseList" class="database-grid"></div>
            </div>
        </section>

        <!-- Create Database Section -->
        <section id="create" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span class="card-title-icon">‚ûï</span>
                    Create New Database
                </h2>
                <div id="createMessage"></div>
                <form onsubmit="createDatabase(event)">
                    <div class="form-group">
                        <label class="form-label">Database Name *</label>
                        <input type="text" id="newDbName" class="form-input" placeholder="Enter database name" required>
                        <div class="helper-text">Use alphanumeric characters and underscores only</div>
                    </div>

                    <div class="expandable-section">
                        <div class="expandable-header" onclick="toggleExpandable('createCredentials')">
                            <span>üîê Set Database Credentials (Optional)</span>
                            <span id="createCredentialsToggle">‚ñº</span>
                        </div>
                        <div id="createCredentials" class="expandable-content">
                            <div class="helper-text" style="margin-bottom: 15px;">
                                Set specific username/password for this database (optional). Leave empty to use default credentials. Credentials will be saved for future use.
                            </div>
                            <div class="form-group">
                                <label class="form-label">Database Username</label>
                                <input type="text" id="newDbUsername" class="form-input" placeholder="Enter username (optional)">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Database Password</label>
                                <input type="password" id="newDbPassword" class="form-input" placeholder="Enter password (optional)">
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary">
                        <span>‚ûï</span> Create Database
                    </button>
                </form>
            </div>
        </section>

        <!-- Delete Database Section -->
        <section id="delete" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span class="card-title-icon">üóëÔ∏è</span>
                    Delete Database
                </h2>
                <div id="deleteMessage"></div>
                <form onsubmit="deleteDatabase(event)">
                    <div class="form-group">
                        <label class="form-label">Select Database to Delete *</label>
                        <select id="deleteDbSelect" class="form-select" required>
                            <option value="">-- Select Database --</option>
                        </select>
                        <div class="helper-text">‚ö†Ô∏è This action cannot be undone!</div>
                    </div>
                    <button type="submit" class="btn btn-danger">
                        <span>üóëÔ∏è</span> Delete Database
                    </button>
                </form>
            </div>
        </section>

        <!-- Rename Database Section -->
        <section id="rename" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span class="card-title-icon">‚úèÔ∏è</span>
                    Rename Database
                </h2>
                <div id="renameMessage"></div>
                <form onsubmit="renameDatabase(event)">
                    <div class="form-group">
                        <label class="form-label">Select Database to Rename *</label>
                        <select id="renameOldSelect" class="form-select" required>
                            <option value="">-- Select Database --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">New Database Name *</label>
                        <input type="text" id="renameNewName" class="form-input" placeholder="Enter new name" required>
                        <div class="helper-text">Use alphanumeric characters and underscores only</div>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <span>‚úèÔ∏è</span> Rename Database
                    </button>
                </form>
            </div>
        </section>

        <!-- Set Credentials Section -->
        <section id="credentials" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span class="card-title-icon">üîê</span>
                    Set Database Credentials
                </h2>
                <div id="credentialsMessage"></div>
                <p style="margin-bottom: 20px;">Add username and password authentication to secure your database. This creates a database user with specific credentials.</p>
                <form onsubmit="setDatabaseCredentials(event)">
                    <div class="form-group">
                        <label class="form-label">Select Database *</label>
                        <select id="credentialsDbSelect" class="form-select" required onchange="checkExistingCredentials()">
                            <option value="">-- Select Database --</option>
                        </select>
                    </div>
                    <div id="credentialStatus" style="margin-bottom: 15px;"></div>
                    <div class="form-group">
                        <label class="form-label">Username *</label>
                        <input type="text" id="credentialsUsername" class="form-input" placeholder="Enter username" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password *</label>
                        <input type="password" id="credentialsPassword" class="form-input" placeholder="Enter password" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Confirm Password *</label>
                        <input type="password" id="credentialsConfirmPassword" class="form-input" placeholder="Confirm password" required>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <span>üîê</span> Set Credentials
                    </button>
                </form>
            </div>
        </section>

        <!-- Settings Section - Hostinger Connections -->
        <section id="settings" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span class="card-title-icon">‚öôÔ∏è</span>
                    Manage Hostinger Connections
                </h2>
                <div class="security-notice">
                    <strong>üåê Hostinger Database Connections:</strong> Add your Hostinger database credentials (Shared Hosting or VPS). All data is stored locally in your browser's localStorage.
                </div>
                <div id="settingsMessage"></div>

                <!-- Add New Connection Form -->
                <div style="background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3 style="color: #fbbf24; margin-bottom: 15px;">‚ûï Add New Connection</h3>
                    <form onsubmit="addHostingerConnection(event)">
                        <div class="form-group">
                            <label class="form-label">Connection Name *</label>
                            <input type="text" id="connName" class="form-input" placeholder="e.g., My VPS, Shared Host 1" required>
                            <div class="helper-text">Give a friendly name to identify this connection</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Connection Type *</label>
                            <select id="connType" class="form-select" required>
                                <option value="shared">Shared Hosting</option>
                                <option value="vps">VPS</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Database Host *</label>
                            <div style="display: flex; gap: 10px; margin-bottom: 5px;">
                                <button type="button" class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px; flex: 1;" onclick="document.getElementById('connHost').value='192.168.8.4'">üñ•Ô∏è My PC (192.168.8.4)</button>
                                <button type="button" class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px; flex: 1;" onclick="document.getElementById('connHost').value='localhost'">üìç localhost</button>
                                <button type="button" class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px; flex: 1;" onclick="document.getElementById('connHost').value='127.0.0.1'">üîó 127.0.0.1</button>
                            </div>
                            <input type="text" id="connHost" class="form-input" list="hostList" placeholder="e.g., localhost, 192.168.8.4, or Hostinger host" value="192.168.8.4" required>
                            <datalist id="hostList"></datalist>
                            <div class="helper-text">üí° Your PC IP: 192.168.8.4 | Use 'localhost' for shared hosting | Use Hostinger host for remote</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Database Name *</label>
                            <input type="text" id="connDbName" class="form-input" list="dbNameList" placeholder="Database name" required>
                            <datalist id="dbNameList"></datalist>
                            <div class="helper-text">üí° Select from previous entries or type new name</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Database Username *</label>
                            <input type="text" id="connUsername" class="form-input" list="usernameList" placeholder="Username" required>
                            <datalist id="usernameList"></datalist>
                            <div class="helper-text">üí° Select from previous entries or type new username</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Database Password *</label>
                            <div style="position: relative;">
                                <input type="password" id="connPassword" class="form-input" placeholder="Password" required style="padding-right: 45px;">
                                <button type="button" onclick="togglePasswordVisibility()" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: rgba(59, 130, 246, 0.2); border: 1px solid #3b82f6; color: #93c5fd; padding: 6px 10px; border-radius: 6px; cursor: pointer; font-size: 16px; transition: all 0.3s;" id="togglePasswordBtn">
                                    üëÅÔ∏è
                                </button>
                            </div>
                            <div class="helper-text">üí° Click the eye icon to show/hide password</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Port</label>
                            <input type="text" id="connPort" class="form-input" placeholder="3306" value="3306">
                            <div class="helper-text">Default MySQL port is 3306</div>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <span>‚ûï</span> Add Connection
                        </button>
                    </form>
                </div>

                <!-- Connections List Table -->
                <div style="margin-top: 30px;">
                    <h3 style="color: #fbbf24; margin-bottom: 15px;">üìã Saved Connections</h3>
                    <div id="hostingerConnectionsTable"></div>
                </div>

                <!-- Export/Import Buttons -->
                <div style="margin-top: 30px; display: flex; gap: 15px; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="exportConnectionsToFile()">
                        <span>üì§</span> Export (Save to File)
                    </button>
                    <button class="btn btn-primary" onclick="showImportModal()">
                        <span>üì•</span> Import (Load from File)
                    </button>
                    <button class="btn btn-danger" onclick="clearAllHostingerConnections()">
                        <span>üóëÔ∏è</span> Clear All Connections
                    </button>
                </div>

                <!-- Export/Import Info -->
                <div style="margin-top: 20px; background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.3);">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <span style="font-size: 24px;">üíæ</span>
                        <div>
                            <strong style="color: #fbbf24; font-size: 16px;">Backup & Restore with File Picker</strong>
                        </div>
                    </div>
                    <div style="font-size: 13px; color: rgba(254, 243, 199, 0.7); line-height: 1.6;">
                        <strong>üì§ Export:</strong> Opens file picker - Choose where to save your backup (JSON file)<br>
                        <strong>üì• Import:</strong> Opens file picker - Select a backup file to restore<br>
                        <strong>üí° Smart Merge:</strong> Import merges with existing connections (no data loss)<br>
                        <strong>üîí Secure:</strong> Files saved on your computer with full control
                    </div>
                </div>
            </div>
        </section>

        <!-- Generate Database SQL Section -->
        <section id="generateDatabase" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span class="card-title-icon">üóÑÔ∏è</span>
                    Database SQL Tools
                </h2>
                <div id="generateDatabaseMessage"></div>
                
                <!-- Selected Database Info -->
                <div id="selectedDbInfo" style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.3); margin-bottom: 20px;">
                    <div style="font-size: 14px; color: rgba(254, 243, 199, 0.9);">
                        <strong>üìä Selected Database:</strong> <span id="selectedDbNameDisplay" style="color: #fbbf24; font-weight: bold;">None</span>
                    </div>
                    <div style="font-size: 13px; color: rgba(254, 243, 199, 0.7); margin-top: 5px;">
                        üí° Please select a database from the Dashboard
                    </div>
                </div>

                <!-- Tabs -->
                <div class="tab-buttons">
                    <button class="tab-btn active" onclick="switchDatabaseSQLTab('generate')">üóÑÔ∏è Generate SQL Dump</button>
                    <button class="tab-btn" onclick="switchDatabaseSQLTab('executor')">‚ö° SQL Executor</button>
                    <button class="tab-btn" onclick="switchDatabaseSQLTab('migration')">üîÑ Database Migration</button>
                </div>

                <!-- Tab 1: Generation Options -->
                <div id="generateSQLTab" class="tab-content active">
                <div style="background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3 style="color: #fbbf24; margin-bottom: 20px;">üìù SQL Generation Options</h3>
                    
                    <!-- Option 1: Structure Only -->
                    <div style="background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(251, 191, 36, 0.2); border-radius: 10px; padding: 20px; margin-bottom: 15px; transition: all 0.3s;" onmouseover="this.style.borderColor='#fbbf24'; this.style.background='rgba(251, 191, 36, 0.1)';" onmouseout="this.style.borderColor='rgba(251, 191, 36, 0.2)'; this.style.background='rgba(255, 255, 255, 0.05)';">
                        <div style="display: flex; justify-content: space-between; align-items: center; gap: 20px;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                    <span style="font-size: 32px;">üèóÔ∏è</span>
                                    <div>
                                        <h4 style="color: #fbbf24; margin: 0;">Tables Structure Only</h4>
                                        <p style="margin: 5px 0 0 0; font-size: 13px; color: rgba(254, 243, 199, 0.7);">
                                            Generate CREATE TABLE statements for all tables (no data)<br>
                                            ‚úÖ Perfect for: Injecting into existing database
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="generateDatabaseSQL(false, false)" style="padding: 12px 24px;">
                                <span>üèóÔ∏è</span> Generate
                            </button>
                        </div>
                    </div>

                    <!-- Option 2: Full Database (CREATE DATABASE + Structure) -->
                    <div style="background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(251, 191, 36, 0.2); border-radius: 10px; padding: 20px; margin-bottom: 15px; transition: all 0.3s;" onmouseover="this.style.borderColor='#fbbf24'; this.style.background='rgba(251, 191, 36, 0.1)';" onmouseout="this.style.borderColor='rgba(251, 191, 36, 0.2)'; this.style.background='rgba(255, 255, 255, 0.05)';">
                        <div style="display: flex; justify-content: space-between; align-items: center; gap: 20px;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                    <span style="font-size: 32px;">üóÑÔ∏è</span>
                                    <div>
                                        <h4 style="color: #fbbf24; margin: 0;">Full Database (CREATE DATABASE + Tables)</h4>
                                        <p style="margin: 5px 0 0 0; font-size: 13px; color: rgba(254, 243, 199, 0.7);">
                                            Generate CREATE DATABASE + all table structures (no data)<br>
                                            ‚úÖ Perfect for: Complete database migration
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="generateDatabaseSQL(true, false)" style="padding: 12px 24px;">
                                <span>üóÑÔ∏è</span> Generate
                            </button>
                        </div>
                    </div>

                    <!-- Option 3: Structure + Data -->
                    <div style="background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(251, 191, 36, 0.2); border-radius: 10px; padding: 20px; margin-bottom: 15px; transition: all 0.3s;" onmouseover="this.style.borderColor='#fbbf24'; this.style.background='rgba(251, 191, 36, 0.1)';" onmouseout="this.style.borderColor='rgba(251, 191, 36, 0.2)'; this.style.background='rgba(255, 255, 255, 0.05)';">
                        <div style="display: flex; justify-content: space-between; align-items: center; gap: 20px;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                    <span style="font-size: 32px;">üì¶</span>
                                    <div>
                                        <h4 style="color: #fbbf24; margin: 0;">Tables Structure + Data</h4>
                                        <p style="margin: 5px 0 0 0; font-size: 13px; color: rgba(254, 243, 199, 0.7);">
                                            Generate all table structures + INSERT data (no CREATE DATABASE)<br>
                                            ‚úÖ Perfect for: Injecting complete data into existing database
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="generateDatabaseSQL(false, true)" style="padding: 12px 24px;">
                                <span>üì¶</span> Generate
                            </button>
                        </div>
                    </div>

                    <!-- Option 4: Full Database + Data -->
                    <div style="background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(34, 197, 94, 0.2); border-radius: 10px; padding: 20px; transition: all 0.3s;" onmouseover="this.style.borderColor='#22c55e'; this.style.background='rgba(34, 197, 94, 0.1)';" onmouseout="this.style.borderColor='rgba(34, 197, 94, 0.2)'; this.style.background='rgba(255, 255, 255, 0.05)';">
                        <div style="display: flex; justify-content: space-between; align-items: center; gap: 20px;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                    <span style="font-size: 32px;">üíé</span>
                                    <div>
                                        <h4 style="color: #86efac; margin: 0;">Complete Database Dump (Everything!)</h4>
                                        <p style="margin: 5px 0 0 0; font-size: 13px; color: rgba(254, 243, 199, 0.7);">
                                            Generate CREATE DATABASE + all tables + all data<br>
                                            ‚úÖ Perfect for: Complete backup and restore
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="generateDatabaseSQL(true, true)" style="padding: 12px 24px; background: #22c55e; color: #1e3a8a;">
                                <span>üíé</span> Generate All
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Help Section -->
                <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid #f59e0b; border-radius: 8px; padding: 15px;">
                    <h4 style="color: #fbbf24; margin: 0 0 10px 0;">üí° Quick Tips</h4>
                    <ul style="margin: 0; padding-left: 20px; line-height: 1.8; font-size: 13px; color: rgba(254, 243, 199, 0.8);">
                        <li><strong>Structure Only:</strong> Use when you want to recreate table structure in another database</li>
                        <li><strong>+ CREATE DATABASE:</strong> Use when migrating to new server (with database creation permission)</li>
                        <li><strong>+ Data:</strong> Use for complete backup or migration with all data</li>
                        <li><strong>Complete Dump:</strong> Full backup - includes everything</li>
                    </ul>
                </div>
                </div>
                </div>

                <!-- Tab 2: SQL Executor -->
                <div id="sqlExecutorTab" class="tab-content">
                    <div style="background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h3 style="color: #fbbf24; margin: 0;">‚ö° SQL Query Builder & Executor</h3>
                            <button class="btn btn-secondary" onclick="toggleVisualBuilder()" id="toggleBuilderBtn">
                                <span>üé®</span> <span id="builderToggleText">Show Visual Builder</span>
                            </button>
                        </div>
                        
                        <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid #3b82f6; border-radius: 8px; padding: 12px; margin-bottom: 15px; font-size: 13px;">
                            <strong style="color: #93c5fd;">üí° Two Ways:</strong> Use Visual Builder for easy query creation OR write SQL directly in the textarea below.
                        </div>

                        <!-- Visual Query Builder -->
                        <div id="visualQueryBuilder" style="display: none; background: rgba(34, 197, 94, 0.05); border: 2px solid #22c55e; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                            <h4 style="color: #22c55e; margin: 0 0 20px 0;">üé® Visual Query Builder</h4>
                            
                            <!-- Step 1: Select Operation -->
                            <div class="form-group">
                                <label class="form-label">1Ô∏è‚É£ Select Operation</label>
                                <select id="queryOperation" class="form-select" onchange="updateQueryBuilder()">
                                    <option value="">-- Choose Operation --</option>
                                    <option value="SELECT">üîç SELECT - Read data</option>
                                    <option value="INSERT">‚ûï INSERT - Add new record</option>
                                    <option value="UPDATE">‚úèÔ∏è UPDATE - Modify records</option>
                                    <option value="DELETE">üóëÔ∏è DELETE - Remove records</option>
                                </select>
                            </div>

                            <!-- Step 2: Select Table -->
                            <div class="form-group">
                                <label class="form-label">2Ô∏è‚É£ Select Table</label>
                                <select id="queryTable" class="form-select" onchange="loadTableColumnsForQuery()">
                                    <option value="">-- Choose Table --</option>
                                </select>
                                <div class="helper-text" id="tableRecordCount"></div>
                            </div>

                            <!-- Dynamic Query Options (changes based on operation) -->
                            <div id="queryOptionsContainer"></div>

                            <!-- Build Query Button -->
                            <div style="margin-top: 20px;">
                                <button class="btn btn-primary" onclick="buildQueryFromVisual()" style="background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);">
                                    <span>üî®</span> Build SQL Query
                                </button>
                                <button class="btn btn-secondary" onclick="resetQueryBuilder()">
                                    <span>üîÑ</span> Reset Builder
                                </button>
                            </div>
                        </div>

                        <!-- SQL Input with Ghost Text Autocomplete -->
                        <div class="form-group">
                            <label class="form-label">SQL Query</label>
                            <div class="sql-ac-wrapper">
                                <pre id="sqlGhostLayer" class="sql-ac-ghost"></pre>
                                <textarea id="customSQLInput" class="form-input sql-ac-textarea" rows="8" placeholder="Start typing SQL... (Ctrl+Space for AI suggestions, Tab to accept)" style="font-family: 'Courier New', monospace; font-size: 14px; line-height: 1.5; background: rgba(255, 255, 255, 0.1);" onkeydown="handleSQLAutocompleteKeydown(event)" oninput="handleSQLAutocompleteInput()" onscroll="syncGhostScroll()" onclick="handleSQLAutocompleteInput()" onfocus="handleSQLAutocompleteFocus()" onblur="handleSQLAutocompleteBlur()"></textarea>
                            </div>
                            <div class="helper-text">
                                üí° <strong>Ghost Text Autocomplete:</strong> Press <kbd style="background: rgba(251, 191, 36, 0.2); padding: 2px 6px; border-radius: 4px;">Ctrl+Space</kbd> for AI suggestion | 
                                <kbd style="background: rgba(251, 191, 36, 0.2); padding: 2px 6px; border-radius: 4px;">Tab</kbd> to accept | 
                                <kbd style="background: rgba(251, 191, 36, 0.2); padding: 2px 6px; border-radius: 4px;">Esc</kbd> to dismiss
                            </div>
                        </div>

                        <!-- Execute Button -->
                        <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                            <button class="btn btn-primary" onclick="executeSQLQuery()" id="executeSQLBtn" disabled style="background: linear-gradient(135deg, #22c55e 0%, #15803d 100%);">
                                <span>‚ñ∂Ô∏è</span> Execute Query
                            </button>
                            <button class="btn btn-secondary" onclick="clearSQLInput()">
                                <span>üóëÔ∏è</span> Clear
                            </button>
                            <button class="btn btn-secondary" onclick="showSQLExamples()">
                                <span>üìö</span> Examples
                            </button>
                        </div>

                        <!-- Results Container -->
                        <div id="sqlResultsContainer" style="display: none;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <h4 style="color: #fbbf24; margin: 0;">Query Results</h4>
                                <button class="btn btn-secondary" onclick="closeSQLResults()" style="padding: 6px 12px; font-size: 12px;">
                                    ‚úñÔ∏è Close Results
                                </button>
                            </div>
                            
                            <div id="sqlResultsMessage"></div>
                            <div id="sqlResultsData"></div>
                        </div>

                        <!-- SQL Examples -->
                        <div id="sqlExamplesContainer" style="display: none; background: rgba(59, 130, 246, 0.1); border: 1px solid #3b82f6; border-radius: 8px; padding: 15px; margin-top: 15px;">
                            <h4 style="color: #93c5fd; margin: 0 0 10px 0;">üìö SQL Query Examples</h4>
                            <div style="font-size: 13px; line-height: 1.8; color: rgba(254, 243, 199, 0.9);">
                                <div style="margin-bottom: 10px; cursor: pointer;" onclick="insertSQLExample('SELECT * FROM users LIMIT 10;')">
                                    <strong style="color: #fbbf24;">SELECT:</strong> <code style="background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px;">SELECT * FROM users LIMIT 10;</code>
                                </div>
                                <div style="margin-bottom: 10px; cursor: pointer;" onclick="insertSQLExample('INSERT INTO users (username, email) VALUES (\\'testuser\\', \\'test@email.com\\');')">
                                    <strong style="color: #fbbf24;">INSERT:</strong> <code style="background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px;">INSERT INTO users (username, email) VALUES ('testuser', 'test@email.com');</code>
                                </div>
                                <div style="margin-bottom: 10px; cursor: pointer;" onclick="insertSQLExample('UPDATE users SET status = \\'active\\' WHERE id = 1;')">
                                    <strong style="color: #fbbf24;">UPDATE:</strong> <code style="background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px;">UPDATE users SET status = 'active' WHERE id = 1;</code>
                                </div>
                                <div style="margin-bottom: 10px; cursor: pointer;" onclick="insertSQLExample('DELETE FROM logs WHERE created_at < \\'2024-01-01\\';')">
                                    <strong style="color: #fbbf24;">DELETE:</strong> <code style="background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px;">DELETE FROM logs WHERE created_at < '2024-01-01';</code>
                                </div>
                                <div style="margin-bottom: 10px; cursor: pointer;" onclick="insertSQLExample('SHOW TABLES;')">
                                    <strong style="color: #fbbf24;">SHOW TABLES:</strong> <code style="background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px;">SHOW TABLES;</code>
                                </div>
                                <div style="margin-bottom: 10px; cursor: pointer;" onclick="insertSQLExample('DESCRIBE users;')">
                                    <strong style="color: #fbbf24;">DESCRIBE:</strong> <code style="background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px;">DESCRIBE users;</code>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab 3: Database Migration -->
                <div id="databaseMigrationTab" class="tab-content">
                    <div style="background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h3 style="color: #fbbf24; margin-bottom: 15px;">üîÑ Database Migration</h3>
                        
                        <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid #3b82f6; border-radius: 8px; padding: 12px; margin-bottom: 20px; font-size: 13px;">
                            <strong style="color: #93c5fd;">üí° Migration:</strong> Copy all tables and data from the selected (source) database to another (destination) database.
                        </div>

                        <!-- Source Database -->
                        <div style="background: rgba(34, 197, 94, 0.1); border: 1px solid #22c55e; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <h4 style="color: #86efac; margin: 0 0 10px 0;">üì§ Source Database (Selected)</h4>
                            <div style="font-size: 16px; color: #fef3c7; font-weight: bold;" id="migrationSourceDb">None selected</div>
                            <div style="font-size: 13px; color: rgba(254, 243, 199, 0.7); margin-top: 5px;" id="migrationSourceInfo">Please select a database from Dashboard</div>
                        </div>

                        <!-- Destination Database -->
                        <div class="form-group">
                            <label class="form-label">üì• Destination Database</label>
                            <select id="migrationDestinationDb" class="form-select" onchange="updateMigrationDestinationInfo()">
                                <option value="">-- Select Destination Database --</option>
                            </select>
                            <div class="helper-text" id="migrationDestInfo">Choose where to migrate the data</div>
                        </div>

                        <!-- Migration Type -->
                        <div class="form-group">
                            <label class="form-label">üîß Migration Type</label>
                            
                            <!-- Option 1: Overwrite -->
                            <div style="background: rgba(239, 68, 68, 0.1); border: 2px solid #ef4444; border-radius: 10px; padding: 15px; margin-bottom: 15px; cursor: pointer; transition: all 0.3s;" onclick="selectMigrationType('overwrite')" id="migrationType_overwrite">
                                <div style="display: flex; align-items: center; gap: 15px;">
                                    <input type="radio" name="migrationType" value="overwrite" id="migrationOverwrite" style="width: 20px; height: 20px; cursor: pointer;">
                                    <div style="flex: 1;">
                                        <h4 style="color: #fca5a5; margin: 0 0 8px 0;">‚ö†Ô∏è Overwrite (Replace All)</h4>
                                        <p style="margin: 0; font-size: 13px; color: rgba(254, 243, 199, 0.8);">
                                            <strong>Deletes ALL tables</strong> in destination, then creates fresh copy from source.<br>
                                            ‚ö†Ô∏è <strong>Warning:</strong> All existing data in destination will be LOST!
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- Option 2: Append -->
                            <div style="background: rgba(34, 197, 94, 0.1); border: 2px solid rgba(34, 197, 94, 0.3); border-radius: 10px; padding: 15px; cursor: pointer; transition: all 0.3s;" onclick="selectMigrationType('append')" id="migrationType_append">
                                <div style="display: flex; align-items: center; gap: 15px;">
                                    <input type="radio" name="migrationType" value="append" id="migrationAppend" style="width: 20px; height: 20px; cursor: pointer;">
                                    <div style="flex: 1;">
                                        <h4 style="color: #86efac; margin: 0 0 8px 0;">‚úÖ Append (Merge Data)</h4>
                                        <p style="margin: 0; font-size: 13px; color: rgba(254, 243, 199, 0.8);">
                                            <strong>Adds data</strong> from source to destination without deleting existing tables.<br>
                                            ‚úÖ <strong>Safe:</strong> Existing data preserved. New tables created if missing.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Migration Options -->
                        <div id="migrationOptions" style="background: rgba(245, 158, 11, 0.1); border: 1px solid #f59e0b; border-radius: 8px; padding: 15px; margin-bottom: 20px; display: none;">
                            <h4 style="color: #fbbf24; margin: 0 0 15px 0;">‚öôÔ∏è Migration Options</h4>
                            
                            <div class="checkbox-group" style="margin-bottom: 10px;">
                                <input type="checkbox" id="migrationIncludeData" checked>
                                <label for="migrationIncludeData">Include table data (INSERT statements)</label>
                            </div>
                            
                            <div class="checkbox-group" style="margin-bottom: 10px;">
                                <input type="checkbox" id="migrationCreateDatabase">
                                <label for="migrationCreateDatabase">Create destination database if not exists (requires ROOT)</label>
                            </div>

                            <div class="form-group" style="margin-top: 15px;">
                                <label class="form-label">Batch Size (records per transaction)</label>
                                <input type="number" id="migrationBatchSize" class="form-input" value="100" min="1" max="1000">
                                <div class="helper-text">Lower for slower servers, higher for faster migration</div>
                            </div>
                        </div>

                        <!-- Migrate Button -->
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-primary" onclick="startDatabaseMigration()" id="startMigrationBtn" disabled style="background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);">
                                <span>üöÄ</span> Start Migration
                            </button>
                            <button class="btn btn-danger" onclick="cancelMigration()" id="cancelMigrationBtn" disabled style="display: none;">
                                <span>‚õî</span> Cancel Migration
                            </button>
                            <button class="btn btn-secondary" onclick="showMigrationOptions()">
                                <span>‚öôÔ∏è</span> Advanced Options
                            </button>
                        </div>

                        <!-- Migration Progress -->
                        <div id="migrationProgress" style="display: none; margin-top: 20px; background: rgba(59, 130, 246, 0.1); border: 1px solid #3b82f6; border-radius: 8px; padding: 20px;">
                            <h4 style="color: #93c5fd; margin: 0 0 15px 0;">üìä Migration Progress</h4>
                            <div id="migrationProgressDetails"></div>
                            <div style="background: rgba(0,0,0,0.3); height: 30px; border-radius: 15px; overflow: hidden; margin-top: 15px;">
                                <div id="migrationProgressBar" style="height: 100%; background: linear-gradient(90deg, #22c55e 0%, #15803d 100%); width: 0%; transition: width 0.3s;"></div>
                            </div>
                            <div id="migrationProgressText" style="text-align: center; margin-top: 10px; color: #fef3c7; font-weight: bold;">0%</div>
                        </div>

                        <!-- Migration Results -->
                        <div id="migrationResults" style="display: none; margin-top: 20px;"></div>

                        <!-- Database Repair Tool -->
                        <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid #f59e0b; border-radius: 8px; padding: 15px; margin-top: 30px;">
                            <h4 style="color: #fbbf24; margin: 0 0 15px 0;">üîß Database Repair & Diagnostics</h4>
                            <p style="font-size: 13px; color: rgba(254, 243, 199, 0.8); margin-bottom: 15px;">
                                If migration was interrupted, use these tools to check and repair the destination database.
                            </p>
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <button class="btn btn-secondary" onclick="testDatabaseConnection()" style="padding: 8px 16px; font-size: 13px;">
                                    <span>üîå</span> Test Connection
                                </button>
                                <button class="btn btn-secondary" onclick="checkDatabaseTables()" style="padding: 8px 16px; font-size: 13px;">
                                    <span>üìã</span> List Tables
                                </button>
                                <button class="btn btn-secondary" onclick="repairAllTables()" style="padding: 8px 16px; font-size: 13px;">
                                    <span>üîß</span> Repair All Tables
                                </button>
                            </div>
                            <div id="diagnosticResults" style="margin-top: 15px;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- AI Connection Prompt Section -->
        <section id="aiPrompt" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span class="card-title-icon">ü§ñ</span>
                    AI Assistant Helper
                </h2>
                <div id="aiPromptMessage"></div>
                
                <!-- Selected Database Info -->
                <div id="aiPromptDbInfo" style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.3); margin-bottom: 20px;">
                    <div style="font-size: 14px; color: rgba(254, 243, 199, 0.9);">
                        <strong>üìä Selected Database:</strong> <span id="aiPromptDbNameDisplay" style="color: #fbbf24; font-weight: bold;">None</span>
                    </div>
                    <div style="font-size: 13px; color: rgba(254, 243, 199, 0.7); margin-top: 5px;">
                        üí° Please select a database from the Dashboard to generate AI prompts
                    </div>
                </div>

                <!-- Tabs -->
                <div class="tab-buttons">
                    <button class="tab-btn active" onclick="switchAITab('connection')">üîå Connection Prompt</button>
                    <button class="tab-btn" onclick="switchAITab('description')">üìä Database Description</button>
                </div>

                <!-- Tab 1: Connection Prompt -->
                <div id="aiConnectionTab" class="tab-content active">
                    <div style="background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h3 style="color: #fbbf24; margin: 0;">üìù AI Connection Prompt</h3>
                            <button class="btn btn-primary" onclick="copyAIConnectionPrompt()" id="copyAIPromptBtn" disabled>
                                <span>üìã</span> Copy to Clipboard
                            </button>
                        </div>
                        
                        <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid #f59e0b; border-radius: 8px; padding: 12px; margin-bottom: 15px; font-size: 13px;">
                            <strong style="color: #fbbf24;">üí° How to use:</strong> Copy this prompt and paste it into any AI code editor (Cursor, GitHub Copilot, etc.) to give the AI direct access to your database connection info.
                        </div>

                        <textarea id="aiPromptText" readonly style="width: 100%; min-height: 350px; padding: 20px; background: rgba(0, 0, 0, 0.4); border: 2px solid rgba(251, 191, 36, 0.3); border-radius: 8px; color: #86efac; font-family: 'Courier New', monospace; font-size: 14px; line-height: 1.6; resize: vertical;">Select a database from the Dashboard to generate AI connection prompt...</textarea>
                    </div>
                </div>

                <!-- Tab 2: Database Description -->
                <div id="aiDescriptionTab" class="tab-content">
                    <div style="background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h3 style="color: #fbbf24; margin: 0;">üìä AI Database Description</h3>
                            <div style="display: flex; gap: 10px;">
                                <button class="btn btn-secondary" onclick="generateDatabaseDescription()" id="generateDescBtn" disabled>
                                    <span>üîÑ</span> Generate Description
                                </button>
                                <button class="btn btn-primary" onclick="copyDatabaseDescription()" id="copyDescBtn" disabled>
                                    <span>üìã</span> Copy to Clipboard
                                </button>
                            </div>
                        </div>
                        
                        <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid #f59e0b; border-radius: 8px; padding: 12px; margin-bottom: 15px; font-size: 13px;">
                            <strong style="color: #fbbf24;">üí° How to use:</strong> This generates a complete description of your database structure for AI context. Include this when asking AI to work with your database schema.
                        </div>

                        <div id="descriptionLoading" style="display: none; text-align: center; padding: 40px;">
                            <div class="spinner"></div>
                            <div style="margin-top: 15px; color: rgba(254, 243, 199, 0.8);">Analyzing database structure...</div>
                        </div>

                        <textarea id="aiDescriptionText" readonly style="width: 100%; min-height: 450px; padding: 20px; background: rgba(0, 0, 0, 0.4); border: 2px solid rgba(251, 191, 36, 0.3); border-radius: 8px; color: #86efac; font-family: 'Courier New', monospace; font-size: 14px; line-height: 1.6; resize: vertical;">Click "Generate Description" button to analyze the database structure...</textarea>
                    </div>
                </div>

                <!-- Quick Info Cards -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                    <div class="stat-box">
                        <div class="stat-label">üñ•Ô∏è Database Host</div>
                        <div class="stat-value" style="font-size: 14px; word-break: break-all;" id="aiPromptHost">-</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">üìÅ Database Name</div>
                        <div class="stat-value" style="font-size: 14px; word-break: break-all;" id="aiPromptDbName">-</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">üë§ Username</div>
                        <div class="stat-value" style="font-size: 14px; word-break: break-all;" id="aiPromptUser">-</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">üîå Port</div>
                        <div class="stat-value" style="font-size: 14px;" id="aiPromptPort">-</div>
                    </div>
                </div>

                <!-- Security Notice -->
                <div style="background: rgba(239, 68, 68, 0.2); border: 1px solid #ef4444; border-radius: 8px; padding: 15px; margin-top: 20px;">
                    <strong style="color: #fca5a5;">‚ö†Ô∏è Security Warning:</strong>
                    <ul style="margin: 10px 0 0 20px; line-height: 1.8; font-size: 13px; color: rgba(254, 243, 199, 0.8);">
                        <li>This prompt contains your <strong>database password</strong> in plain text</li>
                        <li>Only share with trusted AI assistants in secure environments</li>
                        <li>Do not paste in public channels or forums</li>
                        <li>Consider using temporary credentials for AI interactions</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- List Tables Section - HIDDEN -->
        <section id="listTables" class="section hidden-section">
            <div id="tableConnectionStatus" class="connection-status"></div>
            
            <!-- Tables List View -->
            <div id="tablesListView" class="card">
                <h2 class="card-title">
                    <span class="card-title-icon">üìÑ</span>
                    Tables in Database
                </h2>
                <div id="listTablesMessage"></div>
                <button class="btn btn-primary" onclick="loadTables()">
                    <span>üîÑ</span> Refresh Tables
                </button>
                <div id="tableList" class="table-grid"></div>
            </div>

            <!-- Table Data View -->
            <div id="tableDataView" class="card" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
                    <h2 class="card-title" style="margin: 0;">
                        <span class="card-title-icon">üìä</span>
                        <span id="currentTableName">Table Data</span>
                    </h2>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="injectRandomRecords()" style="background: linear-gradient(135deg, #22c55e 0%, #15803d 100%);">
                            <span>üé≤</span> Inject 10 Random Records
                        </button>
                        <button class="btn btn-primary" onclick="generateSQL(false)">
                            <span>üèóÔ∏è</span> Generate Structure
                        </button>
                        <button class="btn btn-primary" onclick="generateSQL(true)">
                            <span>üì¶</span> Generate Structure + Data
                        </button>
                        <button class="btn btn-secondary" onclick="backToTablesList()">
                            <span>‚¨ÖÔ∏è</span> Back to Tables
                        </button>
                    </div>
                </div>
                
                <!-- Table Info Stats -->
                <div id="tableInfoStats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;"></div>
                
                <div id="tableDataMessage"></div>
                
                <!-- Pagination Controls (Top) -->
                <div id="paginationTop" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 8px;"></div>
                
                <!-- Table Data -->
                <div id="tableDataContainer" style="overflow-x: auto; background: rgba(0,0,0,0.2); border-radius: 8px; padding: 10px;"></div>
                
                <!-- Pagination Controls (Bottom) -->
                <div id="paginationBottom" style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 8px;"></div>
            </div>
        </section>

        <!-- Create Table Section - HIDDEN -->
        <section id="createTable" class="section hidden-section">
            <!-- Selected Database Display -->
            <div style="background: rgba(34, 197, 94, 0.2); border: 1px solid #22c55e; color: #86efac; padding: 12px 20px; border-radius: 8px; margin-bottom: 20px; font-weight: 500;">
                ‚úÖ Creating table in: <strong id="createTableDbName" style="color: #fbbf24;">Database Name</strong>
            </div>
            
            <div class="card">
                <h2 class="card-title">
                    <span class="card-title-icon">‚ûï</span>
                    Create New Table
                </h2>
                <div id="createTableMessage"></div>

                <!-- Tab Navigation -->
                <div class="tab-buttons">
                    <button class="tab-btn active" onclick="switchTab('manual')">Manual Definition</button>
                    <button class="tab-btn" onclick="switchTab('template')">Use Template</button>
                    <button class="tab-btn" onclick="switchTab('migration')">Migration</button>
                </div>

                <!-- Manual Tab -->
                <div id="manualTab" class="tab-content active">
                    <form onsubmit="createTableManual(event)">
                        <div class="form-group">
                            <label class="form-label">Table Name *</label>
                            <input type="text" id="newTableName" class="form-input" placeholder="Enter table name" required>
                            <div class="helper-text">Use alphanumeric characters and underscores only</div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Table Columns</label>
                            <div id="columnBuilder" class="column-builder"></div>
                            <button type="button" class="btn btn-secondary" onclick="addColumnRow()">
                                <span>‚ûï</span> Add Column
                            </button>
                        </div>

                        <div id="sqlPreview" class="sql-preview" style="display: none;"></div>

                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button type="button" class="btn btn-secondary" onclick="previewSQL()">
                                <span>üëÅÔ∏è</span> Preview SQL
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <span>‚ûï</span> Create Table
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Template Tab -->
                <div id="templateTab" class="tab-content">
                    <form onsubmit="createTableFromTemplate(event)">
                        <div class="form-group">
                            <label class="form-label">Select Template First</label>
                            <div class="template-grid" id="templateGrid"></div>
                        </div>

                        <div class="form-group" id="templateNameSection" style="display: none;">
                            <label class="form-label">Table Name *</label>
                            <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                                <select id="templateSuggestedNames" class="form-select" onchange="useSuggestedName()" style="flex: 1;">
                                    <option value="">-- Choose Suggested Name --</option>
                                </select>
                                <button type="button" class="btn btn-secondary" onclick="clearTemplateName()" style="padding: 8px 16px;">
                                    <span>‚úñÔ∏è</span> Clear
                                </button>
                            </div>
                            <input type="text" id="templateTableName" class="form-input" placeholder="Or type custom name..." required>
                            <div class="helper-text">üí° Select a suggested name above or type your own</div>
                        </div>

                        <div id="templateColumnBuilder" class="column-builder" style="display: none; margin-top: 20px;">
                            <h4 style="color: #fbbf24; margin-bottom: 15px;">Template Columns (You can modify)</h4>
                            <div id="templateColumns"></div>
                        </div>

                        <div id="templateSqlPreview" class="sql-preview" style="display: none;"></div>

                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button type="button" class="btn btn-secondary" onclick="previewTemplateSQL()">
                                <span>üëÅÔ∏è</span> Preview SQL
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <span>‚ûï</span> Create Table from Template
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Migration Tab -->
                <div id="migrationTab" class="tab-content">
                    <div style="display: flex; gap: 20px; align-items: flex-start;">
                        <!-- Source Tables Container (Left Side - 48%) -->
                        <div style="flex: 0 0 48%; background: linear-gradient(135deg, rgba(30, 58, 138, 0.3) 0%, rgba(153, 27, 27, 0.3) 100%); border: 2px solid rgba(251, 191, 36, 0.3); border-radius: 12px; padding: 20px; backdrop-filter: blur(10px);">
                            <!-- Container Header -->
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid rgba(251, 191, 36, 0.3);">
                                <div>
                                    <h3 style="color: #fbbf24; margin: 0; font-size: 18px; display: flex; align-items: center; gap: 10px;">
                                        <span style="font-size: 24px;">üì¶</span>
                                        <span>Source Tables</span>
                                    </h3>
                                    <p style="color: rgba(254, 243, 199, 0.7); margin: 5px 0 0 34px; font-size: 13px;" id="migrationSourceDbName">
                                        No database selected
                                    </p>
                                </div>
                                <div style="display: flex; gap: 8px;">
                                    <button onclick="refreshMigrationTables()" class="btn btn-secondary" style="padding: 8px 12px; font-size: 12px;" title="Refresh tables">
                                        <span>üîÑ</span>
                                    </button>
                                    <button onclick="selectAllMigrationTables()" class="btn btn-secondary" style="padding: 8px 12px; font-size: 12px;" title="Select all">
                                        <span>‚úÖ</span>
                                    </button>
                                    <button onclick="deselectAllMigrationTables()" class="btn btn-secondary" style="padding: 8px 12px; font-size: 12px;" title="Deselect all">
                                        <span>‚ùå</span>
                                    </button>
                                </div>
                            </div>

                            <!-- Tables Grid -->
                            <div id="migrationTablesContainer" style="display: flex; flex-wrap: wrap; gap: 10px; min-height: 200px; max-height: 500px; overflow-y: auto; padding: 5px;">
                                <!-- Tables will be loaded here dynamically -->
                                <div style="width: 100%; text-align: center; padding: 40px 20px; color: rgba(254, 243, 199, 0.5);">
                                    <div style="font-size: 48px; margin-bottom: 15px;">ÔøΩ</div>
                                    <p style="font-size: 14px;">Select a database to view tables</p>
                                </div>
                            </div>

                            <!-- Selected Count -->
                            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(251, 191, 36, 0.2); color: rgba(254, 243, 199, 0.8); font-size: 13px; display: flex; justify-content: space-between; align-items: center;">
                                <span id="migrationSelectedCount">0 tables selected</span>
                                <span id="migrationTotalCount">0 tables total</span>
                            </div>
                        </div>

                        <!-- Arrow Container (Center) -->
                        <div style="flex: 0 0 60px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 15px;">
                            <div style="font-size: 36px; animation: pulse 2s infinite;">‚û°Ô∏è</div>
                            <div style="width: 2px; height: 80px; background: linear-gradient(to bottom, rgba(251, 191, 36, 0.5), rgba(251, 191, 36, 0.1));"></div>
                            <div style="font-size: 36px; animation: pulse 2s infinite; animation-delay: 1s;">‚û°Ô∏è</div>
                        </div>

                        <!-- Destination Database Container (Right Side - 48%) -->
                        <div style="flex: 0 0 48%; background: linear-gradient(135deg, rgba(34, 197, 94, 0.2) 0%, rgba(59, 130, 246, 0.2) 100%); border: 2px solid rgba(34, 197, 94, 0.4); border-radius: 12px; padding: 20px; backdrop-filter: blur(10px);">
                            <!-- Container Header -->
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid rgba(34, 197, 94, 0.3);">
                                <div>
                                    <h3 style="color: #86efac; margin: 0; font-size: 18px; display: flex; align-items: center; gap: 10px;">
                                        <span style="font-size: 24px;">üì•</span>
                                        <span>Destination Database</span>
                                    </h3>
                                    <p style="color: rgba(254, 243, 199, 0.7); margin: 5px 0 0 34px; font-size: 13px;">
                                        Select where to copy tables
                                    </p>
                                </div>
                                <div style="display: flex; gap: 8px;">
                                    <button onclick="refreshDestinationTables()" class="btn btn-secondary" style="padding: 8px 12px; font-size: 12px;" title="Refresh tables">
                                        <span>üîÑ</span>
                                    </button>
                                    <button onclick="selectAllDestinationTables()" class="btn btn-secondary" style="padding: 8px 12px; font-size: 12px;" title="Select all">
                                        <span>‚úÖ</span>
                                    </button>
                                    <button onclick="deselectAllDestinationTables()" class="btn btn-secondary" style="padding: 8px 12px; font-size: 12px;" title="Deselect all">
                                        <span>‚ùå</span>
                                    </button>
                                </div>
                            </div>

                            <!-- Database Selection Dropdown -->
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; color: #fbbf24; font-size: 14px; font-weight: 500; margin-bottom: 10px;">
                                    üéØ Select Destination Database
                                </label>
                                <select id="migrationDestinationSelect" 
                                        onchange="loadDestinationTables()"
                                        style="width: 100%; padding: 12px 15px; background: linear-gradient(135deg, rgba(0, 0, 0, 0.4) 0%, rgba(0, 0, 0, 0.2) 100%); border: 2px solid rgba(34, 197, 94, 0.4); border-radius: 8px; color: #fef3c7; font-size: 14px; cursor: pointer; outline: none; transition: all 0.3s;">
                                    <option value="">-- Select Destination --</option>
                                </select>
                            </div>

                            <!-- Destination Info Display -->
                            <div id="migrationDestinationInfo" style="background: rgba(59, 130, 246, 0.15); border: 1px solid rgba(59, 130, 246, 0.4); border-radius: 8px; padding: 12px 15px; margin-bottom: 20px; display: none;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <span style="font-size: 20px;">üåê</span>
                                    <div style="flex: 1;">
                                        <div style="color: #93c5fd; font-size: 13px; font-weight: 500;" id="migrationDestDbName">Database Name</div>
                                        <div style="color: rgba(254, 243, 199, 0.6); font-size: 11px;" id="migrationDestHost">Host</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Destination Tables Container -->
                            <div id="migrationDestinationTablesContainer" 
                                 class="migration-drop-zone"
                                 ondrop="handleDrop(event)"
                                 ondragover="handleDragOver(event)"
                                 ondragleave="handleDragLeave(event)"
                                 style="display: flex; flex-wrap: wrap; gap: 10px; min-height: 200px; max-height: 340px; overflow-y: auto; padding: 5px; background: rgba(0, 0, 0, 0.2); border-radius: 8px; border: 1px solid rgba(34, 197, 94, 0.2); transition: all 0.3s;">
                                <!-- Destination tables will be loaded here -->
                                <div style="width: 100%; text-align: center; padding: 40px 20px; color: rgba(254, 243, 199, 0.5);">
                                    <div style="font-size: 48px; margin-bottom: 15px;">üéØ</div>
                                    <p style="font-size: 14px;">Select a destination database</p>
                                </div>
                            </div>

                            <!-- Destination Tables Count -->
                            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(34, 197, 94, 0.2); color: rgba(254, 243, 199, 0.8); font-size: 13px; display: flex; justify-content: space-between; align-items: center;">
                                <span id="migrationDestinationSelectedCount">0 tables selected</span>
                                <span id="migrationDestinationCount">0 tables total</span>
                            </div>

                            <!-- Drag & Drop Instruction -->
                            <div style="margin-top: 20px; padding-top: 20px; border-top: 2px solid rgba(34, 197, 94, 0.3); color: rgba(254, 243, 199, 0.7); font-size: 13px;">
                                <div style="text-align: center; margin-bottom: 15px;">
                                    <div style="font-size: 32px; margin-bottom: 10px;">üñ±Ô∏è ‚ûú üì•</div>
                                    <p style="margin: 5px 0; font-weight: bold;">Drag tables to migrate</p>
                                </div>
                                <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid #f59e0b; border-radius: 6px; padding: 10px; font-size: 12px;">
                                    <div style="margin-bottom: 8px;">
                                        <strong style="color: #fbbf24;">üèóÔ∏è Drag from table card:</strong> Move (Structure Only)
                                    </div>
                                    <div style="margin-bottom: 8px;">
                                        <strong style="color: #22c55e;">‚úã Drag from green badge:</strong> Move (Structure + Data)
                                    </div>
                                    <div style="margin-bottom: 8px;">
                                        <strong style="color: #3b82f6;">üé≤ Blue "Dice" button:</strong> Inject 10 random records
                                    </div>
                                    <div style="margin-bottom: 8px;">
                                        <strong style="color: #a78bfa;">üìã Purple "Copy" button:</strong> Duplicate table in same DB
                                    </div>
                                    <div style="margin-bottom: 8px;">
                                        <strong style="color: #f59e0b;">üßπ Orange "Empty" button:</strong> Delete all data (keep structure)
                                    </div>
                                    <div style="margin-bottom: 8px;">
                                        <strong style="color: #ef4444;">üóëÔ∏è Red "Delete" button:</strong> Permanently delete table
                                    </div>
                                    <div style="margin-bottom: 8px;">
                                        <strong style="color: #fbbf24;">üñ±Ô∏è Hover + Right-click name:</strong> Rename (Enter to save, Esc to cancel)
                                    </div>
                                    <div style="font-size: 11px; opacity: 0.8; margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(245, 158, 11, 0.2);">
                                        üí° Top-left: Row count | Top-right: 4 action buttons (Dice/Copy/Empty/Delete) | Bottom: Drag badges
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Edit Table Section - HIDDEN -->
        <section id="editTable" class="section hidden-section">
            <!-- Selected Database Display -->
            <div style="background: rgba(34, 197, 94, 0.2); border: 1px solid #22c55e; color: #86efac; padding: 12px 20px; border-radius: 8px; margin-bottom: 20px; font-weight: 500;">
                ‚úÖ Editing tables in: <strong id="editTableDbName" style="color: #fbbf24;">Database Name</strong>
            </div>

            <div class="card">
                <h2 class="card-title">
                    <span class="card-title-icon">‚úèÔ∏è</span>
                    Edit Table
                </h2>
                <div id="editTableMessage"></div>
                
                <div class="form-group">
                    <label class="form-label">Select Table *</label>
                    <select id="editTableSelect" class="form-select" onchange="loadTableForEditing()" required>
                        <option value="">-- Select Table --</option>
                    </select>
                    <div class="helper-text" id="editTableHelper">üí° Select a database from Dashboard to see available tables</div>
                </div>

                <!-- Tabs for Structure / Manage Data / Table Info -->
                <div id="editTableTabs" style="display: none;">
                    <div style="background: rgba(59, 130, 246, 0.1); padding: 12px 15px; border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.3); margin-bottom: 15px;">
                        <div style="font-size: 13px; color: rgba(254, 243, 199, 0.9);">
                            <strong>üí° Three Modes:</strong> <strong style="color: #fbbf24;">Structure</strong> to modify columns | <strong style="color: #22c55e;">Manage Data</strong> to CRUD records | <strong style="color: #3b82f6;">Table Info</strong> for AI context
                        </div>
                    </div>
                    <div class="tab-buttons" style="margin: 20px 0;">
                        <button class="tab-btn active" onclick="switchEditTab('structure')">üèóÔ∏è Table Structure</button>
                        <button class="tab-btn" onclick="switchEditTab('manageData')">üìù Manage Data (CRUD)</button>
                        <button class="tab-btn" onclick="switchEditTab('tableInfo')">ü§ñ Table Info for AI</button>
                    </div>

                    <!-- Structure Tab -->
                    <div id="editStructureTab" class="tab-content active">
                        <h3 style="color: #fbbf24; margin: 20px 0 10px;">Current Columns</h3>
                        <div id="currentColumns"></div>

                        <h3 style="color: #fbbf24; margin: 20px 0 10px;">Add New Column</h3>
                        <div class="column-builder">
                            <div class="column-row">
                                <div class="form-group" style="margin: 0;">
                                    <input type="text" id="newColName" class="form-input" placeholder="Column name">
                                </div>
                                <div class="form-group" style="margin: 0;">
                                    <select id="newColType" class="form-select">
                                        <option value="INT">INT</option>
                                        <option value="VARCHAR">VARCHAR</option>
                                        <option value="TEXT">TEXT</option>
                                        <option value="DATE">DATE</option>
                                        <option value="DATETIME">DATETIME</option>
                                        <option value="TIMESTAMP">TIMESTAMP</option>
                                        <option value="BOOLEAN">BOOLEAN</option>
                                        <option value="DECIMAL">DECIMAL</option>
                                        <option value="FLOAT">FLOAT</option>
                                    </select>
                                </div>
                                <div class="form-group" style="margin: 0;">
                                    <input type="text" id="newColLength" class="form-input" placeholder="Length">
                                </div>
                                <div class="form-group" style="margin: 0;">
                                    <select id="newColNullable" class="form-select">
                                        <option value="yes">NULL</option>
                                        <option value="no">NOT NULL</option>
                                    </select>
                                </div>
                                <div class="form-group" style="margin: 0;">
                                    <input type="text" id="newColDefault" class="form-input" placeholder="Default">
                                </div>
                                <button type="button" class="btn btn-primary btn-icon" onclick="addColumn()">+</button>
                            </div>
                        </div>
                    </div>

                    <!-- Manage Data Tab -->
                    <div id="editDataTab" class="tab-content">
                        <!-- Action Bar -->
                        <div style="background: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                                <input type="text" id="dataSearchInput" class="form-input" placeholder="üîç Type to search instantly..." style="flex: 1; min-width: 250px;" oninput="searchTableRecordsInstant()">
                                <button class="btn btn-secondary" onclick="clearSearch()">
                                    <span>‚úñÔ∏è</span> Clear
                                </button>
                                <button class="btn btn-primary" onclick="injectRandomRecordsFromEdit()" style="background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);">
                                    <span>üé≤</span> Inject 10 Random
                                </button>
                                <button class="btn btn-primary" onclick="showRecordForm('add')" style="background: linear-gradient(135deg, #22c55e 0%, #15803d 100%);">
                                    <span>‚ûï</span> Add New Record
                                </button>
                            </div>
                            <div id="searchStatus" style="margin-top: 10px; font-size: 13px; color: rgba(254, 243, 199, 0.7);"></div>
                        </div>

                        <!-- Data Container -->
                        <div id="dataManagementContainer"></div>

                        <!-- Pagination for data -->
                        <div id="dataPagination" style="margin-top: 20px;"></div>
                    </div>

                    <!-- Table Info for AI Tab -->
                    <div id="editTableInfoTab" class="tab-content">
                        <div style="background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 10px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <h3 style="color: #fbbf24; margin: 0;">ü§ñ Table Information for AI</h3>
                                <div style="display: flex; gap: 10px;">
                                    <button class="btn btn-secondary" onclick="generateTableInfo()">
                                        <span>üîÑ</span> Refresh Info
                                    </button>
                                    <button class="btn btn-primary" onclick="copyTableInfo()">
                                        <span>üìã</span> Copy to Clipboard
                                    </button>
                                </div>
                            </div>
                            
                            <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid #f59e0b; border-radius: 8px; padding: 12px; margin-bottom: 15px; font-size: 13px;">
                                <strong style="color: #fbbf24;">üí° How to use:</strong> This generates a detailed description of this specific table for AI context. Perfect for asking AI to work with this table's data.
                            </div>

                            <div id="tableInfoLoading" style="display: none; text-align: center; padding: 40px;">
                                <div class="spinner"></div>
                                <div style="margin-top: 15px; color: rgba(254, 243, 199, 0.8);">Analyzing table structure...</div>
                            </div>

                            <textarea id="tableInfoText" readonly style="width: 100%; min-height: 450px; padding: 20px; background: rgba(0, 0, 0, 0.4); border: 2px solid rgba(251, 191, 36, 0.3); border-radius: 8px; color: #86efac; font-family: 'Courier New', monospace; font-size: 14px; line-height: 1.6; resize: vertical;">Table information will be generated automatically when you select a table...</textarea>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Delete Table Section - HIDDEN -->
        <section id="deleteTable" class="section hidden-section">
            <!-- Selected Database Display -->
            <div style="background: rgba(34, 197, 94, 0.2); border: 1px solid #22c55e; color: #86efac; padding: 12px 20px; border-radius: 8px; margin-bottom: 20px; font-weight: 500;">
                ‚úÖ Deleting tables from: <strong id="deleteTableDbName" style="color: #fbbf24;">Database Name</strong>
            </div>

            <div class="card">
                <h2 class="card-title">
                    <span class="card-title-icon">üóëÔ∏è</span>
                    Delete Table
                </h2>
                <div id="deleteTableMessage"></div>
                <form onsubmit="deleteTableAction(event)">
                    <div class="form-group">
                        <label class="form-label">Select Table to Delete *</label>
                        <select id="deleteTableSelect" class="form-select" required>
                            <option value="">-- Select Table --</option>
                        </select>
                        <div class="helper-text">‚ö†Ô∏è This action cannot be undone!</div>
                    </div>
                    <button type="submit" class="btn btn-danger">
                        <span>üóëÔ∏è</span> Delete Table
                    </button>
                </form>
            </div>
        </section>

        <!-- Rename Table Section - HIDDEN -->
        <section id="renameTable" class="section hidden-section">
            <!-- Selected Database Display -->
            <div style="background: rgba(34, 197, 94, 0.2); border: 1px solid #22c55e; color: #86efac; padding: 12px 20px; border-radius: 8px; margin-bottom: 20px; font-weight: 500;">
                ‚úÖ Renaming tables in: <strong id="renameTableDbName" style="color: #fbbf24;">Database Name</strong>
            </div>

            <div class="card">
                <h2 class="card-title">
                    <span class="card-title-icon">‚úèÔ∏è</span>
                    Rename Table
                </h2>
                <div id="renameTableMessage"></div>
                <form onsubmit="renameTableAction(event)">
                    <div class="form-group">
                        <label class="form-label">Select Table to Rename *</label>
                        <select id="renameTableOldSelect" class="form-select" required>
                            <option value="">-- Select Table --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">New Table Name *</label>
                        <input type="text" id="renameTableNewName" class="form-input" placeholder="Enter new name" required>
                        <div class="helper-text">Use alphanumeric characters and underscores only</div>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <span>‚úèÔ∏è</span> Rename Table
                    </button>
                </form>
            </div>
        </section>
    </main>

    <!-- Connection Modal -->
    <div id="connectionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Database Connection</h3>
                <button class="modal-close" onclick="closeConnectionModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div id="modalMessage"></div>
                <div class="form-group">
                    <label class="form-label">Database Username</label>
                    <div class="datalist-wrapper">
                        <input type="text" id="modalUsername" class="form-input" placeholder="Enter username" list="savedUsernames">
                        <datalist id="savedUsernames"></datalist>
                    </div>
                    <div class="helper-text">Select a previously saved username or enter a new one</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Database Password</label>
                    <input type="password" id="modalPassword" class="form-input" placeholder="Enter password">
                </div>
                <div class="helper-text">‚úÖ Credentials will be saved locally for future use</div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeConnectionModal()">Cancel</button>
                <button class="btn btn-primary" onclick="submitConnection()">
                    <span>üîå</span> Connect
                </button>
            </div>
        </div>
    </div>

    <!-- Record Form Modal -->
    <div id="recordFormModal" class="modal">
        <div class="modal-content" style="max-width: 700px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h3 class="modal-title" id="recordFormTitle">Add New Record</h3>
                <button class="modal-close" onclick="closeRecordForm()">√ó</button>
            </div>
            <div class="modal-body">
                <div id="recordFormMessage"></div>
                <form id="recordForm" onsubmit="saveRecord(event)">
                    <div id="recordFormFields"></div>
                    <div class="modal-footer" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(251, 191, 36, 0.2);">
                        <button type="button" class="btn btn-secondary" onclick="closeRecordForm()">Cancel</button>
                        <button type="submit" class="btn btn-primary">
                            <span id="recordFormSaveIcon">üíæ</span> <span id="recordFormSaveText">Save</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- SQL Generator Modal -->
    <div id="sqlModal" class="modal">
        <div class="modal-content" style="max-width: 900px; max-height: 90vh;">
            <div class="modal-header">
                <h3 class="modal-title">
                    <span>üìù</span> Generated SQL for <span id="sqlTableName"></span>
                </h3>
                <button class="modal-close" onclick="closeSQLModal()">√ó</button>
            </div>
            <div class="modal-body" style="max-height: 70vh; overflow: hidden; display: flex; flex-direction: column;">
                <div id="sqlMessage" style="margin-bottom: 15px;"></div>
                
                <!-- SQL Info -->
                <div id="sqlInfo" style="display: flex; gap: 15px; margin-bottom: 15px; flex-wrap: wrap;"></div>
                
                <!-- SQL Code Container -->
                <div style="position: relative; flex: 1; display: flex; flex-direction: column; overflow: hidden;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <div style="color: rgba(254, 243, 199, 0.8); font-size: 13px;">üí° Copy the SQL below and run it in any MySQL database</div>
                        <button class="btn btn-primary" onclick="copySQLToClipboard()" style="padding: 8px 16px;">
                            <span>üìã</span> Copy to Clipboard
                        </button>
                    </div>
                    <textarea id="sqlCode" readonly style="width: 100%; flex: 1; min-height: 400px; padding: 15px; background: rgba(0, 0, 0, 0.4); border: 1px solid rgba(251, 191, 36, 0.3); border-radius: 8px; color: #86efac; font-family: 'Courier New', monospace; font-size: 13px; resize: vertical; line-height: 1.5;"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeSQLModal()">Close</button>
                <button class="btn btn-primary" onclick="downloadSQL()">
                    <span>üíæ</span> Download SQL File
                </button>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const API_URL = 'http://localhost/Backend-Hostinger.php';
        const HOSTINGER_CONNECTIONS_KEY = 'hostinger_connections';
        const SELECTED_DATABASE_KEY = 'selected_database_id';
        let currentDatabase = null;
        let currentConnection = null;
        let columnCounter = 0;
        let selectedTemplate = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardConnections();
            loadHostingerConnectionsTable();
            addColumnRow(); // Add initial column row for table creation
            
            // Load selected database from localStorage
            setTimeout(() => {
                loadSelectedDatabase();
                
                // Load migration tables if a database is selected
                setTimeout(() => {
                    if (selectedDatabaseId && typeof loadMigrationTables === 'function') {
                        console.log('Initial migration tables load on page load');
                        loadMigrationTables();
                    }
                }, 200);
            }, 100);
        });

        // Sidebar toggle
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            sidebar.classList.toggle('show');
            sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('expanded');
        }

        // Section navigation
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Update active nav link
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            event.target.closest('.nav-link').classList.add('active');

            // Close sidebar on mobile
            if (window.innerWidth <= 768) {
                toggleSidebar();
            }

            // Load data when entering certain sections
            if (sectionId === 'dashboard') {
                loadDashboardConnections();
            } else if (sectionId === 'settings') {
                loadHostingerConnectionsTable();
            } else if (sectionId === 'generateDatabase') {
                updateSelectedDatabaseDisplay();
            } else if (sectionId === 'aiPrompt') {
                updateAIPromptDisplay();
            } else if (sectionId === 'createTable') {
                updateCreateTableDatabaseDisplay();
            } else if (sectionId === 'editTable') {
                updateEditTableDatabaseDisplay();
                // Auto-load tables for dropdown
                if (selectedDatabaseId) {
                    loadTablesForDropdowns();
                }
            } else if (sectionId === 'deleteTable') {
                updateDeleteTableDatabaseDisplay();
                // Auto-load tables for dropdown
                if (selectedDatabaseId) {
                    loadTablesForDropdowns();
                }
            } else if (sectionId === 'renameTable') {
                updateRenameTableDatabaseDisplay();
                // Auto-load tables for dropdown
                if (selectedDatabaseId) {
                    loadTablesForDropdowns();
                }
            } else if (sectionId === 'listTables') {
                // Auto-load tables when entering List Tables section
                if (selectedDatabaseId) {
                    setTimeout(() => {
                        loadTables();
                    }, 100);
                }
            }

            // Restore selection state when navigating
            setTimeout(() => {
                loadSelectedDatabase();
            }, 50);
        }

        // Update AI Prompt display
        function updateAIPromptDisplay() {
            const displayEl = document.getElementById('aiPromptDbNameDisplay');
            const promptTextarea = document.getElementById('aiPromptText');
            const copyBtn = document.getElementById('copyAIPromptBtn');
            const generateDescBtn = document.getElementById('generateDescBtn');
            const hostEl = document.getElementById('aiPromptHost');
            const dbNameEl = document.getElementById('aiPromptDbName');
            const userEl = document.getElementById('aiPromptUser');
            const portEl = document.getElementById('aiPromptPort');

            if (!displayEl || !promptTextarea) return;

            if (selectedDatabaseId) {
                const connId = selectedDatabaseId.replace('conn_', '');
                const connections = getHostingerConnections();
                const conn = connections.find(c => c.id === connId);
                
                if (conn) {
                    // Update display
                    displayEl.textContent = `${conn.name} (${conn.dbName})`;
                    displayEl.style.color = '#22c55e';
                    
                    // Update quick info cards
                    if (hostEl) hostEl.textContent = conn.host;
                    if (dbNameEl) dbNameEl.textContent = conn.dbName;
                    if (userEl) userEl.textContent = conn.username;
                    if (portEl) portEl.textContent = conn.port;
                    
                    // Enable generate description button
                    if (generateDescBtn) generateDescBtn.disabled = false;
                    
                    // Generate AI Prompt
                    const prompt = `DATABASE CONNECTION INFORMATION
=====================================

I need you to connect to my MySQL database with the following credentials:

Connection Name: ${conn.name}
Server Type: ${conn.type === 'vps' ? 'VPS Server' : 'Shared Hosting'}

Database Host: ${conn.host}
Database Name: ${conn.dbName}
Database Username: ${conn.username}
Database Password: ${conn.password}
Database Port: ${conn.port}

IMPORTANT INSTRUCTIONS FOR AI:
- Use these exact credentials to establish database connection
- Default charset: utf8mb4
- Default collation: utf8mb4_unicode_ci
- Connection method: PDO (PHP) or appropriate driver for your language
- Always use prepared statements for security

SAMPLE CONNECTION CODE (PHP):
\`\`\`php
$host = '${conn.host}';
$dbname = '${conn.dbName}';
$username = '${conn.username}';
$password = '${conn.password}';
$port = '${conn.port}';

try {
    $dsn = "mysql:host=\$host;port=\$port;dbname=\$dbname;charset=utf8mb4";
    $pdo = new PDO($dsn, $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
    $pdo->setAttribute(PDO::ATTR_EMULATE_PREPARES, false);
    echo "Connected successfully!";
} catch(PDOException $e) {
    echo "Connection failed: " . $e->getMessage();
}
\`\`\`

SAMPLE CONNECTION CODE (Node.js):
\`\`\`javascript
const mysql = require('mysql2/promise');

const connection = await mysql.createConnection({
    host: '${conn.host}',
    port: ${conn.port},
    user: '${conn.username}',
    password: '${conn.password}',
    database: '${conn.dbName}',
    charset: 'utf8mb4'
});

console.log('Connected successfully!');
\`\`\`

SAMPLE CONNECTION CODE (Python):
\`\`\`python
import mysql.connector

connection = mysql.connector.connect(
    host='${conn.host}',
    port=${conn.port},
    user='${conn.username}',
    password='${conn.password}',
    database='${conn.dbName}',
    charset='utf8mb4'
)

print("Connected successfully!")
\`\`\`

You can now use this connection to:
- Query tables and data
- Create/modify database schema
- Execute SQL statements
- Perform CRUD operations
- Generate reports and analytics

Please confirm you can connect successfully before proceeding with any operations.
`;
                    
                    promptTextarea.value = prompt;
                    if (copyBtn) copyBtn.disabled = false;
                } else {
                    displayEl.textContent = 'None - Please select from Dashboard';
                    displayEl.style.color = '#fca5a5';
                    promptTextarea.value = 'Select a database from the Dashboard to generate AI connection prompt...';
                    if (copyBtn) copyBtn.disabled = true;
                    if (generateDescBtn) generateDescBtn.disabled = true;
                    if (hostEl) hostEl.textContent = '-';
                    if (dbNameEl) dbNameEl.textContent = '-';
                    if (userEl) userEl.textContent = '-';
                    if (portEl) portEl.textContent = '-';
                }
            } else {
                displayEl.textContent = 'None - Please select from Dashboard';
                displayEl.style.color = '#fca5a5';
                promptTextarea.value = 'Select a database from the Dashboard to generate AI connection prompt...';
                if (copyBtn) copyBtn.disabled = true;
                if (generateDescBtn) generateDescBtn.disabled = true;
                if (hostEl) hostEl.textContent = '-';
                if (dbNameEl) dbNameEl.textContent = '-';
                if (userEl) userEl.textContent = '-';
                if (portEl) portEl.textContent = '-';
            }
        }

        // Switch between AI tabs
        function switchAITab(tabName) {
            // Only target AI section tabs
            const aiSection = document.getElementById('aiPrompt');
            if (!aiSection) return;

            aiSection.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            if (tabName === 'connection') {
                aiSection.querySelector('.tab-btn:nth-child(1)').classList.add('active');
                document.getElementById('aiConnectionTab').classList.add('active');
                document.getElementById('aiDescriptionTab').classList.remove('active');
            } else if (tabName === 'description') {
                aiSection.querySelector('.tab-btn:nth-child(2)').classList.add('active');
                document.getElementById('aiDescriptionTab').classList.add('active');
                document.getElementById('aiConnectionTab').classList.remove('active');
            }
        }

        // Copy AI Connection Prompt to clipboard
        async function copyAIConnectionPrompt() {
            const promptText = document.getElementById('aiPromptText').value;
            
            try {
                await navigator.clipboard.writeText(promptText);
                showMessage('aiPromptMessage', '‚úÖ AI Connection Prompt copied to clipboard!', 'success');
                
                // Visual feedback
                const btn = document.getElementById('copyAIPromptBtn');
                const originalHtml = btn.innerHTML;
                btn.innerHTML = '<span>‚úÖ</span> Copied!';
                btn.style.background = '#22c55e';
                
                setTimeout(() => {
                    btn.innerHTML = originalHtml;
                    btn.style.background = '';
                }, 2000);
            } catch (err) {
                // Fallback
                const textarea = document.getElementById('aiPromptText');
                textarea.select();
                document.execCommand('copy');
                showMessage('aiPromptMessage', '‚úÖ AI Connection Prompt copied to clipboard!', 'success');
            }
        }

        // Generate Database Description for AI
        async function generateDatabaseDescription() {
            if (!selectedDatabaseId) {
                showMessage('aiPromptMessage', '‚ùå Please select a database first', 'error');
                return;
            }

            const connId = selectedDatabaseId.replace('conn_', '');
            const connections = getHostingerConnections();
            const conn = connections.find(c => c.id === connId);
            
            if (!conn) {
                showMessage('aiPromptMessage', '‚ùå Connection not found', 'error');
                return;
            }

            // Show loading
            document.getElementById('descriptionLoading').style.display = 'block';
            document.getElementById('aiDescriptionText').value = 'Analyzing database structure...';
            showMessage('aiPromptMessage', 'üîÑ Analyzing database structure...', 'info');

            // Get list of tables
            const tablesResult = await apiRequest('list_tables', {
                db_host: conn.host,
                db_name: conn.dbName,
                db_user: conn.username,
                db_pass: conn.password,
                db_port: conn.port
            });

            if (!tablesResult.success) {
                document.getElementById('descriptionLoading').style.display = 'none';
                showMessage('aiPromptMessage', `‚ùå ${tablesResult.message}`, 'error');
                return;
            }

            // Start building description
            let description = `DATABASE STRUCTURE ANALYSIS
=====================================

Connection Name: ${conn.name}
Server Type: ${conn.type === 'vps' ? 'VPS Server' : 'Shared Hosting'}
Database Name: ${conn.dbName}
Database Host: ${conn.host}

OVERVIEW:
- Total Tables: ${tablesResult.tables.length}
- Database Engine: MySQL/MariaDB
- Character Set: utf8mb4
- Collation: utf8mb4_unicode_ci

`;

            if (tablesResult.tables.length === 0) {
                description += `\nDATABASE STATUS: Empty (No tables found)\n`;
                document.getElementById('aiDescriptionText').value = description;
                document.getElementById('descriptionLoading').style.display = 'none';
                document.getElementById('copyDescBtn').disabled = false;
                showMessage('aiPromptMessage', '‚úÖ Database description generated', 'success');
                return;
            }

            description += `\nTABLES IN DATABASE:\n`;
            description += `${'='.repeat(60)}\n\n`;

            // Get structure for each table
            let totalRecords = 0;
            for (let i = 0; i < tablesResult.tables.length; i++) {
                const tableName = tablesResult.tables[i];
                
                // Get table structure
                const structureResult = await apiRequest('get_table_structure', {
                    db_host: conn.host,
                    db_name: conn.dbName,
                    db_user: conn.username,
                    db_pass: conn.password,
                    db_port: conn.port,
                    table_name: tableName
                });

                // Get table data count
                const dataResult = await apiRequest('get_table_data', {
                    db_host: conn.host,
                    db_name: conn.dbName,
                    db_user: conn.username,
                    db_pass: conn.password,
                    db_port: conn.port,
                    table_name: tableName,
                    page: 1,
                    limit: 1
                });

                if (structureResult.success && dataResult.success) {
                    const rowCount = dataResult.pagination.total_rows;
                    totalRecords += rowCount;

                    description += `TABLE ${i + 1}: ${tableName}\n`;
                    description += `${'-'.repeat(60)}\n`;
                    description += `Records: ${rowCount.toLocaleString()} rows\n`;
                    description += `Columns: ${structureResult.columns.length}\n\n`;

                    description += `Column Structure:\n`;
                    structureResult.columns.forEach((col, idx) => {
                        description += `  ${idx + 1}. ${col.Field}\n`;
                        description += `     Type: ${col.Type}\n`;
                        description += `     Null: ${col.Null}\n`;
                        if (col.Key) description += `     Key: ${col.Key}\n`;
                        if (col.Default !== null) description += `     Default: ${col.Default}\n`;
                        if (col.Extra) description += `     Extra: ${col.Extra}\n`;
                        description += `\n`;
                    });

                    description += `\n`;
                }
            }

            description += `\n${'='.repeat(60)}\n`;
            description += `\nSUMMARY:\n`;
            description += `- Total Tables: ${tablesResult.tables.length}\n`;
            description += `- Total Records Across All Tables: ${totalRecords.toLocaleString()}\n`;
            description += `- Database Type: Relational (MySQL)\n`;
            description += `- Server Environment: ${conn.type === 'vps' ? 'VPS (Full Control)' : 'Shared Hosting (Limited Privileges)'}\n\n`;

            description += `RECOMMENDATIONS FOR AI:\n`;
            description += `- Use this structure information when generating queries\n`;
            description += `- Respect foreign key relationships if present\n`;
            description += `- Consider table sizes when performing operations\n`;
            description += `- Use appropriate indexes for optimization\n`;
            description += `- Follow naming conventions observed in the schema\n`;

            // Set the description
            document.getElementById('aiDescriptionText').value = description;
            document.getElementById('descriptionLoading').style.display = 'none';
            document.getElementById('copyDescBtn').disabled = false;
            showMessage('aiPromptMessage', `‚úÖ Database description generated (${tablesResult.tables.length} tables analyzed)`, 'success');
        }

        // Copy Database Description to clipboard
        async function copyDatabaseDescription() {
            const descText = document.getElementById('aiDescriptionText').value;
            
            try {
                await navigator.clipboard.writeText(descText);
                showMessage('aiPromptMessage', '‚úÖ Database description copied to clipboard!', 'success');
                
                // Visual feedback
                const btn = document.getElementById('copyDescBtn');
                const originalHtml = btn.innerHTML;
                btn.innerHTML = '<span>‚úÖ</span> Copied!';
                btn.style.background = '#22c55e';
                
                setTimeout(() => {
                    btn.innerHTML = originalHtml;
                    btn.style.background = '';
                }, 2000);
            } catch (err) {
                // Fallback
                const textarea = document.getElementById('aiDescriptionText');
                textarea.select();
                document.execCommand('copy');
                showMessage('aiPromptMessage', '‚úÖ Database description copied to clipboard!', 'success');
            }
        }

        // Update selected database display in Delete Table section
        function updateDeleteTableDatabaseDisplay() {
            const displayEl = document.getElementById('deleteTableDbName');
            if (!displayEl) return;

            if (selectedDatabaseId) {
                const connId = selectedDatabaseId.replace('conn_', '');
                const connections = getHostingerConnections();
                const conn = connections.find(c => c.id === connId);
                
                if (conn) {
                    displayEl.textContent = `${conn.name} (${conn.dbName})`;
                } else {
                    displayEl.textContent = 'None - Please select from Dashboard';
                }
            } else {
                displayEl.textContent = 'None - Please select from Dashboard';
            }
        }

        // Update selected database display in Rename Table section
        function updateRenameTableDatabaseDisplay() {
            const displayEl = document.getElementById('renameTableDbName');
            if (!displayEl) return;

            if (selectedDatabaseId) {
                const connId = selectedDatabaseId.replace('conn_', '');
                const connections = getHostingerConnections();
                const conn = connections.find(c => c.id === connId);
                
                if (conn) {
                    displayEl.textContent = `${conn.name} (${conn.dbName})`;
                } else {
                    displayEl.textContent = 'None - Please select from Dashboard';
                }
            } else {
                displayEl.textContent = 'None - Please select from Dashboard';
            }
        }

        // Update selected database display in Edit Table section
        function updateEditTableDatabaseDisplay() {
            const displayEl = document.getElementById('editTableDbName');
            if (!displayEl) return;

            if (selectedDatabaseId) {
                const connId = selectedDatabaseId.replace('conn_', '');
                const connections = getHostingerConnections();
                const conn = connections.find(c => c.id === connId);
                
                if (conn) {
                    displayEl.textContent = `${conn.name} (${conn.dbName})`;
                } else {
                    displayEl.textContent = 'None - Please select from Dashboard';
                }
            } else {
                displayEl.textContent = 'None - Please select from Dashboard';
            }
        }

        // Update selected database display in Create Table section
        function updateCreateTableDatabaseDisplay() {
            const displayEl = document.getElementById('createTableDbName');
            if (!displayEl) return;

            if (selectedDatabaseId) {
                const connId = selectedDatabaseId.replace('conn_', '');
                const connections = getHostingerConnections();
                const conn = connections.find(c => c.id === connId);
                
                if (conn) {
                    displayEl.textContent = `${conn.name} (${conn.dbName})`;
                } else {
                    displayEl.textContent = 'None - Please select from Dashboard';
                }
            } else {
                displayEl.textContent = 'None - Please select from Dashboard';
            }
        }

        // Update selected database display in Generate Database section
        function updateSelectedDatabaseDisplay() {
            const displayEl = document.getElementById('selectedDbNameDisplay');
            const executeSQLBtn = document.getElementById('executeSQLBtn');
            
            if (!displayEl) return;

            if (selectedDatabaseId) {
                const connId = selectedDatabaseId.replace('conn_', '');
                const connections = getHostingerConnections();
                const conn = connections.find(c => c.id === connId);
                
                if (conn) {
                    displayEl.textContent = `${conn.name} (${conn.dbName})`;
                    displayEl.style.color = '#22c55e';
                    // Enable SQL executor button
                    if (executeSQLBtn) executeSQLBtn.disabled = false;
                } else {
                    displayEl.textContent = 'None - Please select from Dashboard';
                    displayEl.style.color = '#fca5a5';
                    if (executeSQLBtn) executeSQLBtn.disabled = true;
                }
            } else {
                displayEl.textContent = 'None - Please select from Dashboard';
                displayEl.style.color = '#fca5a5';
                if (executeSQLBtn) executeSQLBtn.disabled = true;
            }
        }

        // ========================================
        // SQL EXECUTOR FUNCTIONS
        // ========================================

        // Switch between Database SQL tabs
        function switchDatabaseSQLTab(tabName) {
            const section = document.getElementById('generateDatabase');
            if (!section) return;

            section.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById('generateSQLTab').classList.remove('active');
            document.getElementById('sqlExecutorTab').classList.remove('active');
            document.getElementById('databaseMigrationTab').classList.remove('active');
            
            if (tabName === 'generate') {
                section.querySelector('.tab-btn:nth-child(1)').classList.add('active');
                document.getElementById('generateSQLTab').classList.add('active');
            } else if (tabName === 'executor') {
                section.querySelector('.tab-btn:nth-child(2)').classList.add('active');
                document.getElementById('sqlExecutorTab').classList.add('active');
                // Initialize autocomplete when switching to executor tab
                initSQLAutocomplete();
            } else if (tabName === 'migration') {
                section.querySelector('.tab-btn:nth-child(3)').classList.add('active');
                document.getElementById('databaseMigrationTab').classList.add('active');
                // Initialize migration tab
                initMigrationTab();
            }
        }

        // Execute SQL Query
        async function executeSQLQuery() {
            if (!selectedDatabaseId) {
                showMessage('generateDatabaseMessage', '‚ùå Please select a database first', 'error');
                return;
            }

            const connId = selectedDatabaseId.replace('conn_', '');
            const connections = getHostingerConnections();
            const conn = connections.find(c => c.id === connId);
            
            if (!conn) {
                showMessage('generateDatabaseMessage', '‚ùå Connection not found', 'error');
                return;
            }

            const sqlQuery = document.getElementById('customSQLInput').value.trim();
            
            if (!sqlQuery) {
                showMessage('generateDatabaseMessage', '‚ùå Please enter an SQL query', 'error');
                return;
            }

            showMessage('generateDatabaseMessage', 'üîÑ Executing SQL query...', 'info');

            const result = await apiRequest('execute_sql', {
                db_host: conn.host,
                db_name: conn.dbName,
                db_user: conn.username,
                db_pass: conn.password,
                db_port: conn.port,
                sql_query: sqlQuery
            });

            if (result.success) {
                showMessage('generateDatabaseMessage', `‚úÖ ${result.message}`, 'success');
                displaySQLResults(result);
            } else {
                showMessage('generateDatabaseMessage', `‚ùå ${result.message}`, 'error');
                displaySQLError(result);
            }
        }

        // Display SQL results
        function displaySQLResults(result) {
            const container = document.getElementById('sqlResultsContainer');
            const messageEl = document.getElementById('sqlResultsMessage');
            const dataEl = document.getElementById('sqlResultsData');
            
            container.style.display = 'block';
            
            // Show success message
            messageEl.innerHTML = `
                <div class="message success" style="display: block; margin-bottom: 15px;">
                    ‚úÖ ${result.message}<br>
                    <strong>Query Type:</strong> ${result.query_type}
                </div>
            `;

            // Display results based on query type
            if (result.results && result.results.length > 0) {
                // SELECT/SHOW/DESCRIBE results - display as table
                let html = '<div style="overflow-x: auto; background: rgba(0,0,0,0.2); border-radius: 8px; padding: 10px; max-height: 500px; overflow-y: auto;">';
                html += '<table class="data-table">';
                
                // Header
                html += '<thead><tr>';
                result.columns.forEach(col => {
                    html += `<th>${col}</th>`;
                });
                html += '</tr></thead>';
                
                // Body
                html += '<tbody>';
                result.results.forEach(row => {
                    html += '<tr>';
                    result.columns.forEach(col => {
                        const value = row[col];
                        const displayValue = value === null ? '<span style="color: #fca5a5; font-style: italic;">NULL</span>' : value;
                        html += `<td title="${value}">${displayValue}</td>`;
                    });
                    html += '</tr>';
                });
                html += '</tbody></table></div>';
                
                html += `<div style="margin-top: 10px; padding: 10px; background: rgba(59, 130, 246, 0.1); border-radius: 6px; font-size: 13px; color: #93c5fd;">
                    üìä <strong>${result.row_count} row(s)</strong> returned | <strong>${result.columns.length} column(s)</strong>
                </div>`;
                
                dataEl.innerHTML = html;
            } else if (result.affected_rows !== undefined) {
                // INSERT/UPDATE/DELETE results
                let html = '<div style="padding: 20px; background: rgba(34, 197, 94, 0.1); border: 1px solid #22c55e; border-radius: 8px;">';
                html += `<div style="font-size: 16px; color: #86efac; margin-bottom: 10px;"><strong>‚úÖ Operation Completed</strong></div>`;
                html += `<div style="font-size: 14px; color: rgba(254, 243, 199, 0.9);">`;
                html += `üìä <strong>Affected Rows:</strong> ${result.affected_rows}<br>`;
                if (result.insert_id) {
                    html += `üîë <strong>Last Insert ID:</strong> ${result.insert_id}`;
                }
                html += `</div></div>`;
                dataEl.innerHTML = html;
            } else {
                // DDL queries (CREATE, DROP, ALTER)
                dataEl.innerHTML = `
                    <div style="padding: 20px; background: rgba(34, 197, 94, 0.1); border: 1px solid #22c55e; border-radius: 8px; text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 10px;">‚úÖ</div>
                        <div style="font-size: 16px; color: #86efac;"><strong>Query Executed Successfully</strong></div>
                        <div style="font-size: 13px; color: rgba(254, 243, 199, 0.7); margin-top: 5px;">No results to display (DDL operation)</div>
                    </div>
                `;
            }
        }

        // Display SQL error
        function displaySQLError(result) {
            const container = document.getElementById('sqlResultsContainer');
            const messageEl = document.getElementById('sqlResultsMessage');
            const dataEl = document.getElementById('sqlResultsData');
            
            container.style.display = 'block';
            
            messageEl.innerHTML = `
                <div class="message error" style="display: block; margin-bottom: 15px;">
                    ‚ùå ${result.message}
                </div>
            `;

            dataEl.innerHTML = `
                <div style="padding: 20px; background: rgba(239, 68, 68, 0.1); border: 1px solid #ef4444; border-radius: 8px;">
                    <div style="font-size: 14px; color: #fca5a5; margin-bottom: 10px;"><strong>Error Details:</strong></div>
                    <div style="font-size: 13px; color: rgba(254, 243, 199, 0.9); font-family: monospace;">
                        ${result.message}
                    </div>
                    ${result.executed_query ? `
                        <div style="margin-top: 15px; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                            <div style="font-size: 12px; color: rgba(254, 243, 199, 0.6); margin-bottom: 5px;">Executed Query:</div>
                            <div style="font-size: 13px; color: #86efac; font-family: monospace;">${result.executed_query}</div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        // Clear SQL input
        function clearSQLInput() {
            document.getElementById('customSQLInput').value = '';
            closeSQLResults();
        }

        // Close SQL results
        function closeSQLResults() {
            document.getElementById('sqlResultsContainer').style.display = 'none';
        }

        // Show/Hide SQL examples
        function showSQLExamples() {
            const container = document.getElementById('sqlExamplesContainer');
            if (container.style.display === 'none' || !container.style.display) {
                container.style.display = 'block';
            } else {
                container.style.display = 'none';
            }
        }

        // Insert SQL example into textarea
        function insertSQLExample(example) {
            document.getElementById('customSQLInput').value = example;
            document.getElementById('sqlExamplesContainer').style.display = 'none';
        }

        // ========================================
        // VISUAL QUERY BUILDER
        // ========================================

        let queryBuilderColumns = [];
        let queryBuilderTableData = null;

        // Toggle Visual Builder
        function toggleVisualBuilder() {
            const builder = document.getElementById('visualQueryBuilder');
            const toggleText = document.getElementById('builderToggleText');
            
            if (builder.style.display === 'none' || !builder.style.display) {
                builder.style.display = 'block';
                toggleText.textContent = 'Hide Visual Builder';
                loadTablesForQueryBuilder();
            } else {
                builder.style.display = 'none';
                toggleText.textContent = 'Show Visual Builder';
            }
        }

        // Load tables for query builder
        async function loadTablesForQueryBuilder() {
            if (!selectedDatabaseId) {
                return;
            }

            const connId = selectedDatabaseId.replace('conn_', '');
            const connections = getHostingerConnections();
            const conn = connections.find(c => c.id === connId);
            
            if (!conn) return;

            const result = await apiRequest('list_tables', {
                db_host: conn.host,
                db_name: conn.dbName,
                db_user: conn.username,
                db_pass: conn.password,
                db_port: conn.port
            });

            if (result.success && result.tables.length > 0) {
                const select = document.getElementById('queryTable');
                select.innerHTML = '<option value="">-- Choose Table --</option>' + 
                    result.tables.map(t => `<option value="${t}">${t}</option>`).join('');
            }
        }

        // Load columns for selected table
        async function loadTableColumnsForQuery() {
            const tableName = document.getElementById('queryTable').value;
            
            if (!tableName || !selectedDatabaseId) {
                queryBuilderColumns = [];
                document.getElementById('tableRecordCount').textContent = '';
                updateQueryBuilder();
                return;
            }

            const connId = selectedDatabaseId.replace('conn_', '');
            const connections = getHostingerConnections();
            const conn = connections.find(c => c.id === connId);
            
            if (!conn) return;

            // Get table structure
            const structResult = await apiRequest('get_table_structure', {
                db_host: conn.host,
                db_name: conn.dbName,
                db_user: conn.username,
                db_pass: conn.password,
                db_port: conn.port,
                table_name: tableName
            });

            // Get record count
            const dataResult = await apiRequest('get_table_data', {
                db_host: conn.host,
                db_name: conn.dbName,
                db_user: conn.username,
                db_pass: conn.password,
                db_port: conn.port,
                table_name: tableName,
                page: 1,
                limit: 1
            });

            if (structResult.success) {
                queryBuilderColumns = structResult.columns;
                if (dataResult.success) {
                    queryBuilderTableData = dataResult;
                    document.getElementById('tableRecordCount').textContent = `üìä ${dataResult.pagination.total_rows.toLocaleString()} records in this table`;
                }
                updateQueryBuilder();
            }
        }

        // Update query builder based on operation
        function updateQueryBuilder() {
            const operation = document.getElementById('queryOperation').value;
            const tableName = document.getElementById('queryTable').value;
            const container = document.getElementById('queryOptionsContainer');

            if (!operation || !tableName || queryBuilderColumns.length === 0) {
                container.innerHTML = '';
                return;
            }

            let html = '';

            if (operation === 'SELECT') {
                html = buildSELECTOptions();
            } else if (operation === 'INSERT') {
                html = buildINSERTOptions();
            } else if (operation === 'UPDATE') {
                html = buildUPDATEOptions();
            } else if (operation === 'DELETE') {
                html = buildDELETEOptions();
            }

            container.innerHTML = html;
        }

        // Build SELECT options
        function buildSELECTOptions() {
            let html = '<div style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; margin-top: 15px;">';
            
            // Select columns
            html += '<div class="form-group">';
            html += '<label class="form-label">3Ô∏è‚É£ Select Columns</label>';
            html += '<div style="max-height: 200px; overflow-y: auto; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 6px;">';
            html += '<div class="checkbox-group" style="margin-bottom: 10px;"><input type="checkbox" id="selectAllCols" onchange="toggleAllColumns(this.checked)"><label for="selectAllCols" style="margin-left: 8px; color: #22c55e; font-weight: bold;">‚ú® SELECT * (All Columns)</label></div>';
            
            queryBuilderColumns.forEach((col, idx) => {
                html += `<div class="checkbox-group" style="margin-bottom: 8px;">`;
                html += `<input type="checkbox" id="col_${idx}" class="query-column-check" value="${col.Field}">`;
                html += `<label for="col_${idx}" style="margin-left: 8px;">${col.Field} <span style="color: rgba(254, 243, 199, 0.6); font-size: 12px;">(${col.Type})</span></label>`;
                html += `</div>`;
            });
            html += '</div></div>';

            // WHERE clause
            html += '<div class="form-group">';
            html += '<label class="form-label">4Ô∏è‚É£ WHERE Condition (Optional)</label>';
            html += '<div id="whereConditions"></div>';
            html += '<button type="button" class="btn btn-secondary" onclick="addWhereCondition()" style="padding: 8px 16px; font-size: 13px; margin-top: 10px;">‚ûï Add Condition</button>';
            html += '</div>';

            // ORDER BY
            html += '<div class="form-group">';
            html += '<label class="form-label">5Ô∏è‚É£ ORDER BY (Optional)</label>';
            html += '<div style="display: flex; gap: 10px;">';
            html += '<select id="orderByColumn" class="form-select" style="flex: 2;"><option value="">-- No sorting --</option>';
            queryBuilderColumns.forEach(col => {
                html += `<option value="${col.Field}">${col.Field}</option>`;
            });
            html += '</select>';
            html += '<select id="orderByDirection" class="form-select" style="flex: 1;"><option value="ASC">‚¨ÜÔ∏è ASC</option><option value="DESC">‚¨áÔ∏è DESC</option></select>';
            html += '</div></div>';

            // LIMIT
            html += '<div class="form-group">';
            html += '<label class="form-label">6Ô∏è‚É£ LIMIT (Optional)</label>';
            html += '<input type="number" id="queryLimit" class="form-input" placeholder="e.g., 10, 100, 1000" min="1">';
            html += '</div>';

            html += '</div>';
            
            // Auto-add first WHERE condition
            setTimeout(() => addWhereCondition(), 100);
            
            return html;
        }

        // Build INSERT options
        function buildINSERTOptions() {
            let html = '<div style="background: rgba(34, 197, 94, 0.1); padding: 15px; border-radius: 8px; margin-top: 15px;">';
            html += '<div class="form-group"><label class="form-label">3Ô∏è‚É£ Enter Values for Each Column</label></div>';
            
            queryBuilderColumns.forEach(col => {
                const isAutoIncrement = col.Extra && col.Extra.toLowerCase().includes('auto_increment');
                if (isAutoIncrement) return; // Skip auto-increment
                
                html += `<div class="form-group">`;
                html += `<label class="form-label">${col.Field} ${col.Null === 'NO' ? '<span style="color: #ef4444;">*</span>' : ''}</label>`;
                html += `<input type="text" id="insert_${col.Field}" class="form-input" placeholder="${col.Type}" ${col.Null === 'NO' ? 'required' : ''}>`;
                html += `<div class="helper-text">${col.Type}${col.Null === 'YES' ? ' (Optional - leave empty for NULL)' : ' (Required)'}</div>`;
                html += `</div>`;
            });
            
            html += '</div>';
            return html;
        }

        // Build UPDATE options
        function buildUPDATEOptions() {
            let html = '<div style="background: rgba(245, 158, 11, 0.1); padding: 15px; border-radius: 8px; margin-top: 15px;">';
            
            // SET clause
            html += '<div class="form-group">';
            html += '<label class="form-label">3Ô∏è‚É£ SET (Columns to Update)</label>';
            html += '<div id="updateSetFields"></div>';
            html += '<button type="button" class="btn btn-secondary" onclick="addUpdateField()" style="padding: 8px 16px; font-size: 13px; margin-top: 10px;">‚ûï Add Field to Update</button>';
            html += '</div>';

            // WHERE clause
            html += '<div class="form-group">';
            html += '<label class="form-label">4Ô∏è‚É£ WHERE Condition (Required for safety)</label>';
            html += '<div id="updateWhereConditions"></div>';
            html += '<button type="button" class="btn btn-secondary" onclick="addUpdateWhereCondition()" style="padding: 8px 16px; font-size: 13px; margin-top: 10px;">‚ûï Add Condition</button>';
            html += '</div>';

            html += '</div>';
            
            setTimeout(() => {
                addUpdateField();
                addUpdateWhereCondition();
            }, 100);
            
            return html;
        }

        // Build DELETE options  
        function buildDELETEOptions() {
            let html = '<div style="background: rgba(239, 68, 68, 0.1); padding: 15px; border-radius: 8px; margin-top: 15px;">';
            
            html += '<div style="background: rgba(245, 158, 11, 0.2); border: 1px solid #f59e0b; border-radius: 6px; padding: 10px; margin-bottom: 15px; font-size: 13px;">';
            html += '<strong>‚ö†Ô∏è Warning:</strong> DELETE is permanent! Always use WHERE condition to avoid deleting all records.';
            html += '</div>';

            // WHERE clause
            html += '<div class="form-group">';
            html += '<label class="form-label">3Ô∏è‚É£ WHERE Condition (REQUIRED)</label>';
            html += '<div id="deleteWhereConditions"></div>';
            html += '<button type="button" class="btn btn-secondary" onclick="addDeleteWhereCondition()" style="padding: 8px 16px; font-size: 13px; margin-top: 10px;">‚ûï Add Condition</button>';
            html += '</div>';

            // LIMIT (safety)
            html += '<div class="form-group">';
            html += '<label class="form-label">4Ô∏è‚É£ LIMIT (Safety limit)</label>';
            html += '<input type="number" id="deleteLimit" class="form-input" placeholder="e.g., 1, 10, 100" min="1" value="1">';
            html += '<div class="helper-text">‚ö†Ô∏è Recommended: Set a limit to prevent accidental mass deletion</div>';
            html += '</div>';

            html += '</div>';
            
            setTimeout(() => addDeleteWhereCondition(), 100);
            
            return html;
        }

        // Add WHERE condition for SELECT
        function addWhereCondition() {
            const container = document.getElementById('whereConditions');
            if (!container) return;

            const conditionId = 'where_' + Date.now();
            const html = `
                <div id="${conditionId}" style="display: flex; gap: 10px; margin-bottom: 10px; align-items: end;">
                    <select class="form-select where-column" style="flex: 2;">
                        <option value="">-- Column --</option>
                        ${queryBuilderColumns.map(c => `<option value="${c.Field}">${c.Field}</option>`).join('')}
                    </select>
                    <select class="form-select where-operator" style="flex: 1;">
                        <option value="=">=</option>
                        <option value="!=">!=</option>
                        <option value=">">></option>
                        <option value="<"><</option>
                        <option value=">=">>=</option>
                        <option value="<="><=</option>
                        <option value="LIKE">LIKE</option>
                        <option value="NOT LIKE">NOT LIKE</option>
                        <option value="IN">IN</option>
                        <option value="IS NULL">IS NULL</option>
                        <option value="IS NOT NULL">IS NOT NULL</option>
                    </select>
                    <input type="text" class="form-input where-value" placeholder="Value" style="flex: 2;">
                    <select class="form-select where-logic" style="flex: 1;">
                        <option value="AND">AND</option>
                        <option value="OR">OR</option>
                    </select>
                    <button type="button" class="btn btn-danger btn-icon" onclick="document.getElementById('${conditionId}').remove()">√ó</button>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', html);
        }

        // Add UPDATE field
        function addUpdateField() {
            const container = document.getElementById('updateSetFields');
            if (!container) return;

            const fieldId = 'update_' + Date.now();
            const html = `
                <div id="${fieldId}" style="display: flex; gap: 10px; margin-bottom: 10px; align-items: end;">
                    <select class="form-select update-column" style="flex: 1;">
                        <option value="">-- Column --</option>
                        ${queryBuilderColumns.map(c => `<option value="${c.Field}">${c.Field} (${c.Type})</option>`).join('')}
                    </select>
                    <input type="text" class="form-input update-value" placeholder="New Value" style="flex: 2;">
                    <button type="button" class="btn btn-danger btn-icon" onclick="document.getElementById('${fieldId}').remove()">√ó</button>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', html);
        }

        // Add UPDATE WHERE condition
        function addUpdateWhereCondition() {
            const container = document.getElementById('updateWhereConditions');
            if (!container) return;

            const conditionId = 'upwhere_' + Date.now();
            const html = `
                <div id="${conditionId}" style="display: flex; gap: 10px; margin-bottom: 10px; align-items: end;">
                    <select class="form-select update-where-column" style="flex: 2;">
                        <option value="">-- Column --</option>
                        ${queryBuilderColumns.map(c => `<option value="${c.Field}">${c.Field}</option>`).join('')}
                    </select>
                    <select class="form-select update-where-operator" style="flex: 1;">
                        <option value="=">=</option>
                        <option value="!=">!=</option>
                        <option value=">">></option>
                        <option value="<"><</option>
                        <option value="LIKE">LIKE</option>
                    </select>
                    <input type="text" class="form-input update-where-value" placeholder="Value" style="flex: 2;">
                    <select class="form-select update-where-logic" style="flex: 1;">
                        <option value="AND">AND</option>
                        <option value="OR">OR</option>
                    </select>
                    <button type="button" class="btn btn-danger btn-icon" onclick="document.getElementById('${conditionId}').remove()">√ó</button>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', html);
        }

        // Add DELETE WHERE condition
        function addDeleteWhereCondition() {
            const container = document.getElementById('deleteWhereConditions');
            if (!container) return;

            const conditionId = 'delwhere_' + Date.now();
            const html = `
                <div id="${conditionId}" style="display: flex; gap: 10px; margin-bottom: 10px; align-items: end;">
                    <select class="form-select delete-where-column" style="flex: 2;">
                        <option value="">-- Column --</option>
                        ${queryBuilderColumns.map(c => `<option value="${c.Field}">${c.Field}</option>`).join('')}
                    </select>
                    <select class="form-select delete-where-operator" style="flex: 1;">
                        <option value="=">=</option>
                        <option value="!=">!=</option>
                        <option value=">">></option>
                        <option value="<"><</option>
                        <option value="LIKE">LIKE</option>
                    </select>
                    <input type="text" class="form-input delete-where-value" placeholder="Value" style="flex: 2;">
                    <select class="form-select delete-where-logic" style="flex: 1;">
                        <option value="AND">AND</option>
                        <option value="OR">OR</option>
                    </select>
                    <button type="button" class="btn btn-danger btn-icon" onclick="document.getElementById('${conditionId}').remove()">√ó</button>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', html);
        }

        // Toggle all columns
        function toggleAllColumns(checked) {
            document.querySelectorAll('.query-column-check').forEach(cb => {
                cb.checked = checked;
            });
        }

        // Build SQL query from visual inputs
        function buildQueryFromVisual() {
            const operation = document.getElementById('queryOperation').value;
            const tableName = document.getElementById('queryTable').value;

            if (!operation || !tableName) {
                showMessage('generateDatabaseMessage', '‚ùå Please select operation and table', 'error');
                return;
            }

            let sql = '';

            if (operation === 'SELECT') {
                sql = buildSELECTQuery(tableName);
            } else if (operation === 'INSERT') {
                sql = buildINSERTQuery(tableName);
            } else if (operation === 'UPDATE') {
                sql = buildUPDATEQuery(tableName);
            } else if (operation === 'DELETE') {
                sql = buildDELETEQuery(tableName);
            }

            if (sql) {
                document.getElementById('customSQLInput').value = sql;
                showMessage('generateDatabaseMessage', '‚úÖ SQL query built successfully! Review and execute below.', 'success');
                // Scroll to SQL textarea
                document.getElementById('customSQLInput').scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        // Build SELECT query
        function buildSELECTQuery(tableName) {
            // Get selected columns
            const selectAll = document.getElementById('selectAllCols').checked;
            let columns = '*';
            
            if (!selectAll) {
                const selectedCols = Array.from(document.querySelectorAll('.query-column-check:checked')).map(cb => cb.value);
                if (selectedCols.length === 0) {
                    showMessage('generateDatabaseMessage', '‚ùå Please select at least one column or use SELECT *', 'error');
                    return null;
                }
                columns = selectedCols.map(c => `\`${c}\``).join(', ');
            }

            let sql = `SELECT ${columns} FROM \`${tableName}\``;

            // WHERE clause
            const whereClauses = buildWhereClause('.where-column', '.where-operator', '.where-value', '.where-logic');
            if (whereClauses) {
                sql += ` WHERE ${whereClauses}`;
            }

            // ORDER BY
            const orderBy = document.getElementById('orderByColumn').value;
            if (orderBy) {
                const direction = document.getElementById('orderByDirection').value;
                sql += ` ORDER BY \`${orderBy}\` ${direction}`;
            }

            // LIMIT
            const limit = document.getElementById('queryLimit').value;
            if (limit) {
                sql += ` LIMIT ${limit}`;
            }

            sql += ';';
            return sql;
        }

        // Build INSERT query
        function buildINSERTQuery(tableName) {
            const columns = [];
            const values = [];

            queryBuilderColumns.forEach(col => {
                const isAutoIncrement = col.Extra && col.Extra.toLowerCase().includes('auto_increment');
                if (isAutoIncrement) return;

                const input = document.getElementById(`insert_${col.Field}`);
                if (input) {
                    const value = input.value.trim();
                    if (value) {
                        columns.push(`\`${col.Field}\``);
                        values.push(`'${value.replace(/'/g, "\\'")}'`);
                    } else if (col.Null === 'NO') {
                        showMessage('generateDatabaseMessage', `‚ùå ${col.Field} is required (NOT NULL)`, 'error');
                        return null;
                    }
                }
            });

            if (columns.length === 0) {
                showMessage('generateDatabaseMessage', '‚ùå Please fill at least one field', 'error');
                return null;
            }

            return `INSERT INTO \`${tableName}\` (${columns.join(', ')}) VALUES (${values.join(', ')});`;
        }

        // Build UPDATE query
        function buildUPDATEQuery(tableName) {
            // Get SET fields
            const setColumns = document.querySelectorAll('.update-column');
            const setValues = document.querySelectorAll('.update-value');
            const setParts = [];

            for (let i = 0; i < setColumns.length; i++) {
                const col = setColumns[i].value;
                const val = setValues[i].value.trim();
                if (col && val) {
                    setParts.push(`\`${col}\` = '${val.replace(/'/g, "\\'")}'`);
                }
            }

            if (setParts.length === 0) {
                showMessage('generateDatabaseMessage', '‚ùå Please specify at least one field to update', 'error');
                return null;
            }

            let sql = `UPDATE \`${tableName}\` SET ${setParts.join(', ')}`;

            // WHERE clause
            const whereClauses = buildWhereClause('.update-where-column', '.update-where-operator', '.update-where-value', '.update-where-logic');
            if (whereClauses) {
                sql += ` WHERE ${whereClauses}`;
            } else {
                showMessage('generateDatabaseMessage', '‚ö†Ô∏è No WHERE clause! This will update ALL records. Add condition for safety.', 'error');
                return null;
            }

            sql += ';';
            return sql;
        }

        // Build DELETE query
        function buildDELETEQuery(tableName) {
            let sql = `DELETE FROM \`${tableName}\``;

            // WHERE clause
            const whereClauses = buildWhereClause('.delete-where-column', '.delete-where-operator', '.delete-where-value', '.delete-where-logic');
            if (whereClauses) {
                sql += ` WHERE ${whereClauses}`;
            } else {
                showMessage('generateDatabaseMessage', '‚ö†Ô∏è No WHERE clause! This will delete ALL records. Add condition for safety.', 'error');
                return null;
            }

            // LIMIT
            const limit = document.getElementById('deleteLimit').value;
            if (limit) {
                sql += ` LIMIT ${limit}`;
            }

            sql += ';';
            return sql;
        }

        // Build WHERE clause helper
        function buildWhereClause(colSelector, opSelector, valSelector, logicSelector) {
            const columns = document.querySelectorAll(colSelector);
            const operators = document.querySelectorAll(opSelector);
            const values = document.querySelectorAll(valSelector);
            const logics = document.querySelectorAll(logicSelector);

            const conditions = [];

            for (let i = 0; i < columns.length; i++) {
                const col = columns[i].value;
                const op = operators[i].value;
                const val = values[i].value.trim();

                if (col && op) {
                    let condition = `\`${col}\` ${op}`;
                    
                    if (op === 'IS NULL' || op === 'IS NOT NULL') {
                        // No value needed
                    } else if (op === 'IN') {
                        condition += ` (${val})`;
                    } else if (val) {
                        if (op === 'LIKE' || op === 'NOT LIKE') {
                            condition += ` '%${val.replace(/'/g, "\\'")}%'`;
                        } else {
                            condition += ` '${val.replace(/'/g, "\\'")}'`;
                        }
                    }

                    if (i < columns.length - 1 && logics[i]) {
                        condition += ` ${logics[i].value}`;
                    }

                    conditions.push(condition);
                }
            }

            return conditions.join(' ');
        }

        // Reset query builder
        function resetQueryBuilder() {
            document.getElementById('queryOperation').value = '';
            document.getElementById('queryTable').value = '';
            document.getElementById('queryOptionsContainer').innerHTML = '';
            document.getElementById('tableRecordCount').textContent = '';
            queryBuilderColumns = [];
            queryBuilderTableData = null;
        }

        // ========================================
        // SQL GHOST TEXT AUTOCOMPLETE
        // ========================================

        /*
         * SQL Autocomplete with Ghost Text (Inline suggestions like GitHub Copilot)
         * 
         * Configuration:
         * - window.WEBLLM_MODEL = "model-name" (optional, for WebLLM)
         * - window.AI_COMPLETE_ENDPOINT = "url" (optional, for remote LLM API)
         * - Set enableLLM: false to disable LLM features
         * 
         * Usage:
         * - Type SQL and ghost text appears automatically
         * - Press Tab to accept suggestion
         * - Press Esc to dismiss
         * - Press Ctrl+Space to manually request suggestion
         */

        let sqlACState = {
            currentSuggestion: '',
            debounceTimer: null,
            tablesCache: [],
            columnsCache: {},
            keywords: [
                'SELECT', 'FROM', 'WHERE', 'AND', 'OR', 'NOT', 'IN', 'BETWEEN', 'LIKE', 'IS', 'NULL',
                'INSERT', 'INTO', 'VALUES', 'UPDATE', 'SET', 'DELETE', 'JOIN', 'LEFT JOIN', 'RIGHT JOIN',
                'INNER JOIN', 'OUTER JOIN', 'CROSS JOIN', 'ON', 'USING', 'ORDER BY', 'GROUP BY', 
                'HAVING', 'LIMIT', 'OFFSET', 'AS', 'DISTINCT', 'COUNT', 'SUM', 'AVG', 'MAX', 'MIN', 
                'ASC', 'DESC', 'CREATE TABLE', 'ALTER TABLE', 'DROP TABLE', 'TRUNCATE', 'SHOW TABLES', 
                'DESCRIBE', 'DESC', 'EXPLAIN', 'UNION', 'UNION ALL', 'WITH', 'CASE', 'WHEN', 'THEN',
                'ELSE', 'END', 'IF', 'EXISTS', 'PRIMARY KEY', 'FOREIGN KEY', 'REFERENCES', 'INDEX',
                'AUTO_INCREMENT', 'DEFAULT', 'CASCADE', 'RESTRICT'
            ],
            templates: {
                'sel': 'SELECT * FROM table_name;',
                'select': 'SELECT column1, column2 FROM table_name WHERE condition;',
                'ins': 'INSERT INTO table_name (column1, column2) VALUES (value1, value2);',
                'insert': 'INSERT INTO table_name (column1, column2) VALUES (value1, value2);',
                'upd': 'UPDATE table_name SET column1 = value1 WHERE condition;',
                'update': 'UPDATE table_name SET column1 = value1 WHERE condition;',
                'del': 'DELETE FROM table_name WHERE condition LIMIT 1;',
                'delete': 'DELETE FROM table_name WHERE condition LIMIT 1;',
                'create': 'CREATE TABLE table_name (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  column_name VARCHAR(255)\n);',
                'alter': 'ALTER TABLE table_name ADD COLUMN column_name VARCHAR(255);',
                'drop': 'DROP TABLE IF EXISTS table_name;',
                'show': 'SHOW TABLES;',
                'desc': 'DESCRIBE table_name;'
            }
        };

        // Load schema data (tables and columns)
        async function loadSQLAutocompleteData() {
            if (!selectedDatabaseId) return;

            const connId = selectedDatabaseId.replace('conn_', '');
            const connections = getHostingerConnections();
            const conn = connections.find(c => c.id === connId);
            
            if (!conn) return;

            // Get tables
            const tablesResult = await apiRequest('list_tables', {
                db_host: conn.host,
                db_name: conn.dbName,
                db_user: conn.username,
                db_pass: conn.password,
                db_port: conn.port
            });

            if (tablesResult.success) {
                sqlACState.tablesCache = tablesResult.tables;
                
                // Get columns for each table
                for (const table of sqlACState.tablesCache.slice(0, 15)) {
                    const structResult = await apiRequest('get_table_structure', {
                        db_host: conn.host,
                        db_name: conn.dbName,
                        db_user: conn.username,
                        db_pass: conn.password,
                        db_port: conn.port,
                        table_name: table
                    });
                    
                    if (structResult.success) {
                        sqlACState.columnsCache[table] = structResult.columns.map(c => c.Field);
                    }
                }
            }
        }

        // Handle keyboard events for ghost autocomplete
        function handleSQLAutocompleteKeydown(event) {
            const textarea = document.getElementById('customSQLInput');
            const hasSuggestion = sqlACState.currentSuggestion.length > 0;

            // Tab - Accept ghost suggestion
            if (event.key === 'Tab' && hasSuggestion) {
                event.preventDefault();
                acceptGhostSuggestion();
                return;
            }

            // Esc - Clear ghost suggestion
            if (event.key === 'Escape' && hasSuggestion) {
                event.preventDefault();
                clearGhostSuggestion();
                return;
            }

            // Ctrl+Space - Force request suggestion
            if (event.ctrlKey && event.code === 'Space') {
                event.preventDefault();
                requestGhostSuggestion(true);
                return;
            }
        }

        // Handle input (debounced suggestion)
        function handleSQLAutocompleteInput() {
            if (sqlACState.debounceTimer) {
                clearTimeout(sqlACState.debounceTimer);
            }

            sqlACState.debounceTimer = setTimeout(() => {
                requestGhostSuggestion(false);
            }, 300);
        }

        // Handle focus
        function handleSQLAutocompleteFocus() {
            // Could re-enable ghost if needed
        }

        // Handle blur
        function handleSQLAutocompleteBlur() {
            // Hide ghost on blur
            setTimeout(() => clearGhostSuggestion(), 200);
        }

        // Sync ghost layer scroll with textarea
        function syncGhostScroll() {
            const textarea = document.getElementById('customSQLInput');
            const ghost = document.getElementById('sqlGhostLayer');
            if (ghost && textarea) {
                ghost.scrollTop = textarea.scrollTop;
                ghost.scrollLeft = textarea.scrollLeft;
            }
        }

        // Request ghost suggestion
        async function requestGhostSuggestion(forced) {
            const textarea = document.getElementById('customSQLInput');
            if (!textarea) return;

            const text = textarea.value;
            const cursorPos = textarea.selectionStart;
            const textBeforeCursor = text.substring(0, cursorPos);
            
            // Don't suggest if cursor is not at end of text
            if (cursorPos < text.length && !forced) {
                clearGhostSuggestion();
                return;
            }

            // Get current context
            const lines = textBeforeCursor.split('\n');
            const currentLine = lines[lines.length - 1];
            const words = currentLine.trim().split(/\s+/);
            const currentWord = words[words.length - 1].toLowerCase();
            const previousWord = words.length > 1 ? words[words.length - 2].toUpperCase() : '';

            let suggestion = '';

            // Template suggestions (at start of line)
            if (currentLine.trim() === currentWord && currentWord.length >= 2) {
                const template = sqlACState.templates[currentWord];
                if (template) {
                    suggestion = template.substring(currentWord.length);
                }
            }
            // After FROM/JOIN - suggest table names
            else if (previousWord === 'FROM' || previousWord === 'JOIN' || previousWord === 'INTO' || previousWord === 'UPDATE') {
                const matchingTable = sqlACState.tablesCache.find(t => 
                    t.toLowerCase().startsWith(currentWord) && t.toLowerCase() !== currentWord
                );
                if (matchingTable) {
                    suggestion = matchingTable.substring(currentWord.length);
                } else if (sqlACState.tablesCache.length > 0 && currentWord.length === 0) {
                    suggestion = sqlACState.tablesCache[0];
                }
            }
            // After table.column - suggest columns
            else if (currentLine.match(/\w+\.$/)) {
                const match = currentLine.match(/(\w+)\.$/);
                const tableName = match[1];
                if (sqlACState.columnsCache[tableName] && sqlACState.columnsCache[tableName].length > 0) {
                    suggestion = sqlACState.columnsCache[tableName][0];
                }
            }
            // Keyword completion
            else if (currentWord.length >= 2) {
                const matchingKeyword = sqlACState.keywords.find(kw => 
                    kw.toLowerCase().startsWith(currentWord) && kw.toLowerCase() !== currentWord
                );
                if (matchingKeyword) {
                    suggestion = matchingKeyword.substring(currentWord.length);
                }
            }

            // Update ghost suggestion
            if (suggestion) {
                sqlACState.currentSuggestion = suggestion;
                updateGhostLayer(textBeforeCursor, suggestion);
            } else {
                clearGhostSuggestion();
            }
        }

        // Update ghost layer
        function updateGhostLayer(prefix, suggestion) {
            const ghost = document.getElementById('sqlGhostLayer');
            if (!ghost) return;

            // Display: prefix (transparent) + suggestion (ghosted)
            ghost.innerHTML = prefix + `<span class="sql-ac-ghost-text">${suggestion}</span>`;
            ghost.style.display = 'block';
        }

        // Clear ghost suggestion
        function clearGhostSuggestion() {
            sqlACState.currentSuggestion = '';
            const ghost = document.getElementById('sqlGhostLayer');
            if (ghost) {
                ghost.innerHTML = '';
                ghost.style.display = 'none';
            }
        }

        // Accept ghost suggestion (Tab key)
        function acceptGhostSuggestion() {
            const textarea = document.getElementById('customSQLInput');
            if (!textarea || !sqlACState.currentSuggestion) return;

            const cursorPos = textarea.selectionStart;
            const text = textarea.value;
            
            // Insert suggestion at cursor
            const newText = text.substring(0, cursorPos) + sqlACState.currentSuggestion + text.substring(cursorPos);
            textarea.value = newText;
            
            // Move cursor to end of inserted text
            const newCursorPos = cursorPos + sqlACState.currentSuggestion.length;
            textarea.setSelectionRange(newCursorPos, newCursorPos);
            
            clearGhostSuggestion();
            textarea.focus();
        }

        // Initialize SQL autocomplete when entering SQL Executor tab
        function initSQLAutocomplete() {
            if (selectedDatabaseId) {
                loadSQLAutocompleteData();
            }
            
            // Initialize ghost layer on first load
            setTimeout(() => {
                const textarea = document.getElementById('customSQLInput');
                const ghost = document.getElementById('sqlGhostLayer');
                if (textarea && ghost) {
                    // Make sure ghost matches textarea styling
                    const styles = window.getComputedStyle(textarea);
                    ghost.style.fontFamily = styles.fontFamily;
                    ghost.style.fontSize = styles.fontSize;
                    ghost.style.lineHeight = styles.lineHeight;
                    ghost.style.padding = styles.padding;
                }
            }, 100);
        }

        // ========================================
        // DATABASE MIGRATION FUNCTIONS
        // ========================================

        // Initialize migration tab
        function initMigrationTab() {
            // Update source database display
            if (selectedDatabaseId) {
                const connId = selectedDatabaseId.replace('conn_', '');
                const connections = getHostingerConnections();
                const conn = connections.find(c => c.id === connId);
                
                if (conn) {
                    document.getElementById('migrationSourceDb').textContent = `${conn.name} (${conn.dbName})`;
                    document.getElementById('migrationSourceInfo').textContent = `Host: ${conn.host} | Type: ${conn.type}`;
                    
                    // Load destination options (all connections except source)
                    const destSelect = document.getElementById('migrationDestinationDb');
                    destSelect.innerHTML = '<option value="">-- Select Destination Database --</option>';
                    
                    connections.forEach(c => {
                        if (c.id !== connId) {
                            destSelect.innerHTML += `<option value="${c.id}">${c.name} (${c.dbName}) - ${c.host}</option>`;
                        }
                    });
                } else {
                    document.getElementById('migrationSourceDb').textContent = 'None selected';
                    document.getElementById('migrationSourceInfo').textContent = 'Please select a database from Dashboard';
                }
            } else {
                document.getElementById('migrationSourceDb').textContent = 'None selected';
                document.getElementById('migrationSourceInfo').textContent = 'Please select a database from Dashboard';
            }
        }

        // Update destination info
        function updateMigrationDestinationInfo() {
            const destId = document.getElementById('migrationDestinationDb').value;
            const infoEl = document.getElementById('migrationDestInfo');
            const startBtn = document.getElementById('startMigrationBtn');
            
            if (destId) {
                const connections = getHostingerConnections();
                const conn = connections.find(c => c.id === destId);
                if (conn) {
                    infoEl.textContent = `üì• Destination: ${conn.host} | ${conn.type} | ${conn.dbName}`;
                    infoEl.style.color = '#22c55e';
                    if (startBtn) startBtn.disabled = false;
                }
            } else {
                infoEl.textContent = 'Choose where to migrate the data';
                infoEl.style.color = '';
                if (startBtn) startBtn.disabled = true;
            }
        }

        // Select migration type
        function selectMigrationType(type) {
            document.getElementById('migrationOverwrite').checked = (type === 'overwrite');
            document.getElementById('migrationAppend').checked = (type === 'append');
            
            // Visual feedback
            const overwriteCard = document.getElementById('migrationType_overwrite');
            const appendCard = document.getElementById('migrationType_append');
            
            if (type === 'overwrite') {
                overwriteCard.style.borderColor = '#ef4444';
                overwriteCard.style.background = 'rgba(239, 68, 68, 0.2)';
                appendCard.style.borderColor = 'rgba(34, 197, 94, 0.3)';
                appendCard.style.background = 'rgba(34, 197, 94, 0.1)';
            } else {
                appendCard.style.borderColor = '#22c55e';
                appendCard.style.background = 'rgba(34, 197, 94, 0.2)';
                overwriteCard.style.borderColor = '#ef4444';
                overwriteCard.style.background = 'rgba(239, 68, 68, 0.1)';
            }
        }

        // Show/Hide migration options
        function showMigrationOptions() {
            const optionsDiv = document.getElementById('migrationOptions');
            if (optionsDiv.style.display === 'none' || !optionsDiv.style.display) {
                optionsDiv.style.display = 'block';
            } else {
                optionsDiv.style.display = 'none';
            }
        }

        // Migration state
        let migrationCancelled = false;

        // Cancel migration
        function cancelMigration() {
            if (confirm('‚õî Are you sure you want to cancel the migration?\n\nTables already migrated will remain in the destination.')) {
                migrationCancelled = true;
                document.getElementById('cancelMigrationBtn').disabled = true;
                showMessage('generateDatabaseMessage', '‚õî Migration cancellation requested...', 'info');
            }
        }

        // Start database migration
        async function startDatabaseMigration() {
            const sourceId = selectedDatabaseId;
            const destId = document.getElementById('migrationDestinationDb').value;
            const migrationType = document.querySelector('input[name="migrationType"]:checked')?.value;

            if (!sourceId || !destId) {
                showMessage('generateDatabaseMessage', '‚ùå Please select both source and destination databases', 'error');
                return;
            }

            if (!migrationType) {
                showMessage('generateDatabaseMessage', '‚ùå Please select migration type (Overwrite or Append)', 'error');
                return;
            }

            const sourceConnId = sourceId.replace('conn_', '');
            const connections = getHostingerConnections();
            const sourceConn = connections.find(c => c.id === sourceConnId);
            const destConn = connections.find(c => c.id === destId);

            if (!sourceConn || !destConn) {
                showMessage('generateDatabaseMessage', '‚ùå Connection not found', 'error');
                return;
            }

            // Confirmation
            const confirmMsg = migrationType === 'overwrite' 
                ? `‚ö†Ô∏è OVERWRITE Migration\n\nThis will DELETE ALL tables in:\n"${destConn.name} (${destConn.dbName})"\n\nAnd replace with tables from:\n"${sourceConn.name} (${sourceConn.dbName})"\n\nAll existing data in destination will be LOST!\n\nAre you absolutely sure?`
                : `‚úÖ APPEND Migration\n\nThis will ADD tables and data from:\n"${sourceConn.name} (${sourceConn.dbName})"\n\nTo:\n"${destConn.name} (${destConn.dbName})"\n\nExisting data will be preserved.\n\nContinue?`;

            if (!confirm(confirmMsg)) {
                return;
            }

            // Reset cancel flag
            migrationCancelled = false;

            // Show progress and cancel button
            document.getElementById('migrationProgress').style.display = 'block';
            document.getElementById('migrationResults').style.display = 'none';
            document.getElementById('startMigrationBtn').style.display = 'none';
            document.getElementById('cancelMigrationBtn').style.display = 'inline-flex';
            document.getElementById('cancelMigrationBtn').disabled = false;
            
            updateMigrationProgress(0, 'Starting migration...');

            const migrationLog = [];

            try {
                // Get source tables
                updateMigrationProgress(5, 'Fetching source tables...');
                const tablesResult = await apiRequest('list_tables', {
                    db_host: sourceConn.host,
                    db_name: sourceConn.dbName,
                    db_user: sourceConn.username,
                    db_pass: sourceConn.password,
                    db_port: sourceConn.port
                });

                if (!tablesResult.success) {
                    throw new Error(`Failed to get source tables: ${tablesResult.message}`);
                }

                const tables = tablesResult.tables;
                const totalTables = tables.length;
                
                if (totalTables === 0) {
                    throw new Error('Source database has no tables to migrate');
                }

                let migratedTables = 0;
                let totalRecords = 0;
                let failedTables = [];
                const includeData = document.getElementById('migrationIncludeData').checked;

                // Migrate each table
                for (let i = 0; i < tables.length; i++) {
                    // Check if migration was cancelled
                    if (migrationCancelled) {
                        migrationLog.push(`\n‚õî Migration cancelled by user at table ${i + 1}/${totalTables}`);
                        throw new Error(`Migration cancelled by user. ${migratedTables} tables migrated before cancellation.`);
                    }

                    const tableName = tables[i];
                    const progress = 5 + ((i + 1) / totalTables) * 90; // 5-95%
                    
                    updateMigrationProgress(progress, `Migrating table ${i + 1}/${totalTables}: ${tableName}`);
                    migrationLog.push(`\nüìã Processing: ${tableName}`);

                    try {
                        // Step 1: Get table SQL from source
                        migrationLog.push(`  - Generating SQL from source...`);
                        const sqlResult = await apiRequest('generate_table_sql', {
                            db_host: sourceConn.host,
                            db_name: sourceConn.dbName,
                            db_user: sourceConn.username,
                            db_pass: sourceConn.password,
                            db_port: sourceConn.port,
                            table_name: tableName,
                            include_data: includeData ? 'true' : 'false'
                        });

                        if (!sqlResult.success) {
                            migrationLog.push(`  ‚ùå Failed to generate SQL: ${sqlResult.message}`);
                            failedTables.push({ table: tableName, error: sqlResult.message });
                            continue;
                        }

                        migrationLog.push(`  ‚úÖ SQL generated (${sqlResult.row_count || 0} rows)`);
                        let sql = sqlResult.sql;

                        // Step 2: Modify SQL based on migration type
                        if (migrationType === 'append') {
                            // For append, comment out DROP and use IF NOT EXISTS
                            sql = sql.replace(/DROP TABLE IF EXISTS `\w+`;/gi, '-- $&');
                            sql = sql.replace(/CREATE TABLE `/gi, 'CREATE TABLE IF NOT EXISTS `');
                            migrationLog.push(`  - Modified for APPEND mode`);
                        } else {
                            migrationLog.push(`  - Using OVERWRITE mode (with DROP)`);
                        }

                        // Step 3: Execute complete SQL on destination
                        migrationLog.push(`  - Executing SQL on destination...`);

                        try {
                            // Try executing the complete SQL first
                            const execResult = await apiRequest('execute_sql', {
                                db_host: destConn.host,
                                db_name: destConn.dbName,
                                db_user: destConn.username,
                                db_pass: destConn.password,
                                db_port: destConn.port || '3306',
                                sql_query: sql
                            });

                            if (execResult.success) {
                                migrationLog.push(`  ‚úÖ SQL executed successfully`);
                            } else {
                                // If complete SQL fails, try splitting and executing individually
                                migrationLog.push(`  ‚ö†Ô∏è Complete SQL failed, trying statement by statement...`);
                                console.warn('Complete SQL failed:', execResult.message);
                                
                                // Split into individual statements
                                const statements = sql.split(/;\s*\n/).filter(s => {
                                    const trimmed = s.trim();
                                    return trimmed.length > 0 && 
                                           !trimmed.startsWith('--') && 
                                           !trimmed.match(/^--.*/);
                                });

                                migrationLog.push(`  - Found ${statements.length} statements to execute`);

                                for (let i = 0; i < statements.length; i++) {
                                    const statement = statements[i].trim();
                                    if (!statement) continue;

                                    const stmtResult = await apiRequest('execute_sql', {
                                        db_host: destConn.host,
                                        db_name: destConn.dbName,
                                        db_user: destConn.username,
                                        db_pass: destConn.password,
                                        db_port: destConn.port || '3306',
                                        sql_query: statement.endsWith(';') ? statement : statement + ';'
                                    });

                                    if (!stmtResult.success) {
                                        migrationLog.push(`  ‚ö†Ô∏è Statement ${i + 1} failed: ${stmtResult.message.substring(0, 80)}`);
                                        console.error(`Statement ${i + 1} error:`, stmtResult.message);
                                    } else {
                                        migrationLog.push(`  ‚úÖ Statement ${i + 1} executed`);
                                    }
                                }
                            }
                        } catch (execError) {
                            migrationLog.push(`  ‚ùå Execution error: ${execError.message}`);
                            throw execError;
                        }

                        // Table migrated successfully
                        migratedTables++;
                        if (sqlResult.row_count) {
                            totalRecords += sqlResult.row_count;
                        }
                        migrationLog.push(`  ‚úÖ Table migrated successfully!`);

                    } catch (tableError) {
                        migrationLog.push(`  ‚ùå Error: ${tableError.message}`);
                        failedTables.push({ table: tableName, error: tableError.message });
                    }
                }

                // Complete
                if (!migrationCancelled) {
                    updateMigrationProgress(100, 'Migration completed!');
                }
                
                // Show detailed results
                const resultsMsg = migrationLog.join('\n');
                console.log('Migration Log:\n', resultsMsg);
                
                showMigrationResults(true, migratedTables, totalTables, totalRecords, migrationType, failedTables, migrationCancelled);
                
            } catch (error) {
                const errorDetails = migrationLog.join('\n') + '\n\n‚ùå Fatal Error: ' + error.message;
                console.error('Migration Error:', errorDetails);
                showMigrationResults(false, 0, 0, 0, migrationType, [], false, errorDetails);
            } finally {
                // Reset buttons
                document.getElementById('startMigrationBtn').style.display = 'inline-flex';
                document.getElementById('startMigrationBtn').disabled = false;
                document.getElementById('cancelMigrationBtn').style.display = 'none';
                document.getElementById('cancelMigrationBtn').disabled = true;
            }
        }

        // Update migration progress
        function updateMigrationProgress(percentage, message) {
            document.getElementById('migrationProgressBar').style.width = percentage + '%';
            document.getElementById('migrationProgressText').textContent = Math.round(percentage) + '%';
            document.getElementById('migrationProgressDetails').innerHTML = `
                <div style="font-size: 14px; color: rgba(254, 243, 199, 0.9);">${message}</div>
            `;
        }

        // Show migration results
        function showMigrationResults(success, migratedTables, totalTables, totalRecords, type, failedTables = [], cancelled = false, errorDetails = '') {
            const container = document.getElementById('migrationResults');
            container.style.display = 'block';

            if (success && migratedTables > 0) {
                const statusIcon = cancelled ? '‚õî' : (migratedTables === totalTables ? '‚úÖ' : '‚ö†Ô∏è');
                const statusTitle = cancelled ? 'Migration Cancelled' : (migratedTables === totalTables ? 'Migration Completed' : 'Migration Partially Completed');
                const statusColor = cancelled ? '#f59e0b' : (migratedTables === totalTables ? '#86efac' : '#fbbf24');
                let failedSection = '';
                if (failedTables.length > 0) {
                    failedSection = `
                        <div style="background: rgba(245, 158, 11, 0.2); border: 1px solid #f59e0b; border-radius: 6px; padding: 15px; margin-top: 15px;">
                            <h4 style="color: #fbbf24; margin: 0 0 10px 0;">‚ö†Ô∏è ${failedTables.length} Table(s) Failed:</h4>
                            ${failedTables.map(f => `
                                <div style="font-size: 13px; color: rgba(254, 243, 199, 0.8); margin-bottom: 8px;">
                                    ‚ùå <strong>${f.table}</strong>: ${f.error.substring(0, 100)}
                                </div>
                            `).join('')}
                        </div>
                    `;
                }

                container.innerHTML = `
                    <div style="background: rgba(34, 197, 94, 0.2); border: 1px solid #22c55e; border-radius: 8px; padding: 20px;">
                        <div style="font-size: 48px; text-align: center; margin-bottom: 15px;">${statusIcon}</div>
                        <h3 style="color: ${statusColor}; text-align: center; margin: 0 0 20px 0;">${statusTitle}!</h3>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 6px;">
                                <div style="font-size: 12px; color: rgba(254, 243, 199, 0.7);">Migration Type</div>
                                <div style="font-size: 18px; color: #fbbf24; font-weight: bold;">${type === 'overwrite' ? '‚ö†Ô∏è Overwrite' : '‚úÖ Append'}</div>
                            </div>
                            <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 6px;">
                                <div style="font-size: 12px; color: rgba(254, 243, 199, 0.7);">Tables Migrated</div>
                                <div style="font-size: 18px; color: ${migratedTables === totalTables ? '#22c55e' : '#f59e0b'}; font-weight: bold;">${migratedTables} / ${totalTables}</div>
                            </div>
                            <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 6px;">
                                <div style="font-size: 12px; color: rgba(254, 243, 199, 0.7);">Records Migrated</div>
                                <div style="font-size: 18px; color: #fbbf24; font-weight: bold;">${totalRecords.toLocaleString()}</div>
                            </div>
                        </div>

                        <div style="margin-top: 20px; text-align: center; font-size: 14px; color: rgba(254, 243, 199, 0.9);">
                            ${cancelled 
                                ? `‚õî Migration was cancelled. ${migratedTables} tables were migrated before cancellation.`
                                : migratedTables === totalTables 
                                    ? `üéâ All data has been successfully ${type === 'overwrite' ? 'replaced' : 'merged'} in the destination database!`
                                    : `‚ö†Ô∏è ${migratedTables} of ${totalTables} tables migrated. Check console for details.`
                            }
                        </div>

                        ${failedSection}

                        <div style="margin-top: 15px; text-align: center;">
                            <button class="btn btn-secondary" onclick="showMigrationLog()" style="padding: 8px 16px; font-size: 13px;">
                                üìã View Migration Log
                            </button>
                        </div>
                    </div>
                `;
                
                const msgType = cancelled ? 'info' : (migratedTables === totalTables ? 'success' : 'info');
                const msgText = cancelled 
                    ? `‚õî Migration cancelled. ${migratedTables}/${totalTables} tables migrated.`
                    : `‚úÖ Migration completed! ${migratedTables}/${totalTables} tables migrated.`;
                showMessage('generateDatabaseMessage', msgText, msgType);
            } else {
                container.innerHTML = `
                    <div style="background: rgba(239, 68, 68, 0.2); border: 1px solid #ef4444; border-radius: 8px; padding: 20px;">
                        <div style="font-size: 48px; text-align: center; margin-bottom: 15px;">‚ùå</div>
                        <h3 style="color: #fca5a5; text-align: center; margin: 0 0 20px 0;">Migration Failed</h3>
                        <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 6px; font-family: monospace; font-size: 12px; color: #fef3c7; max-height: 300px; overflow-y: auto; white-space: pre-wrap;">
${errorDetails || 'Unknown error occurred'}
                        </div>
                        <div style="margin-top: 15px; text-align: center;">
                            <button class="btn btn-secondary" onclick="showMigrationLog()" style="padding: 8px 16px; font-size: 13px;">
                                üìã View Full Log
                            </button>
                        </div>
                    </div>
                `;
                showMessage('generateDatabaseMessage', `‚ùå Migration failed`, 'error');
            }

            setTimeout(() => {
                container.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);
        }

        // Show migration log in console
        function showMigrationLog() {
            alert('üìã Migration log has been written to browser console.\n\nPress F12 and check the Console tab for detailed migration log.');
            console.log('='.repeat(60));
            console.log('MIGRATION LOG - Check messages above');
            console.log('='.repeat(60));
        }

        // Test database connection (for repair/diagnostic)
        async function testDatabaseConnection() {
            const destId = document.getElementById('migrationDestinationDb').value;
            const diagnosticEl = document.getElementById('diagnosticResults');

            if (!destId) {
                diagnosticEl.innerHTML = '<div class="message error" style="display: block;">‚ùå Please select a destination database first</div>';
                return;
            }

            const connections = getHostingerConnections();
            const conn = connections.find(c => c.id === destId);

            if (!conn) {
                diagnosticEl.innerHTML = '<div class="message error" style="display: block;">‚ùå Connection not found</div>';
                return;
            }

            diagnosticEl.innerHTML = '<div class="message info" style="display: block;">üîç Testing connection...</div>';

            const result = await apiRequest('check_connection', {
                db_host: conn.host,
                db_name: conn.dbName,
                db_user: conn.username,
                db_pass: conn.password,
                db_port: conn.port
            });

            if (result.success) {
                diagnosticEl.innerHTML = `<div class="message success" style="display: block;">‚úÖ ${result.message}<br>Database is accessible and working!</div>`;
            } else {
                diagnosticEl.innerHTML = `<div class="message error" style="display: block;">‚ùå Connection failed: ${result.message}<br><br>Try updating the connection in Hostinger Connections.</div>`;
            }
        }

        // Check database tables
        async function checkDatabaseTables() {
            const destId = document.getElementById('migrationDestinationDb').value;
            const diagnosticEl = document.getElementById('diagnosticResults');

            if (!destId) {
                diagnosticEl.innerHTML = '<div class="message error" style="display: block;">‚ùå Please select a destination database first</div>';
                return;
            }

            const connections = getHostingerConnections();
            const conn = connections.find(c => c.id === destId);

            if (!conn) {
                diagnosticEl.innerHTML = '<div class="message error" style="display: block;">‚ùå Connection not found</div>';
                return;
            }

            diagnosticEl.innerHTML = '<div class="message info" style="display: block;">üîç Checking tables...</div>';

            const result = await apiRequest('list_tables', {
                db_host: conn.host,
                db_name: conn.dbName,
                db_user: conn.username,
                db_pass: conn.password,
                db_port: conn.port
            });

            if (result.success) {
                diagnosticEl.innerHTML = `
                    <div class="message success" style="display: block;">
                        ‚úÖ Found ${result.tables.length} table(s) in ${conn.dbName}<br>
                        Tables: ${result.tables.join(', ')}
                    </div>
                `;
            } else {
                diagnosticEl.innerHTML = `<div class="message error" style="display: block;">‚ùå Failed to list tables: ${result.message}</div>`;
            }
        }

        // Repair all tables (REPAIR TABLE command)
        async function repairAllTables() {
            const destId = document.getElementById('migrationDestinationDb').value;
            const diagnosticEl = document.getElementById('diagnosticResults');

            if (!destId) {
                diagnosticEl.innerHTML = '<div class="message error" style="display: block;">‚ùå Please select a destination database first</div>';
                return;
            }

            if (!confirm('üîß Repair All Tables?\n\nThis will run REPAIR TABLE on all tables in the destination database.\n\nContinue?')) {
                return;
            }

            const connections = getHostingerConnections();
            const conn = connections.find(c => c.id === destId);

            if (!conn) {
                diagnosticEl.innerHTML = '<div class="message error" style="display: block;">‚ùå Connection not found</div>';
                return;
            }

            diagnosticEl.innerHTML = '<div class="message info" style="display: block;">üîß Repairing tables...</div>';

            // Get tables
            const tablesResult = await apiRequest('list_tables', {
                db_host: conn.host,
                db_name: conn.dbName,
                db_user: conn.username,
                db_pass: conn.password,
                db_port: conn.port
            });

            if (!tablesResult.success) {
                diagnosticEl.innerHTML = `<div class="message error" style="display: block;">‚ùå Failed to get tables: ${tablesResult.message}</div>`;
                return;
            }

            let repairLog = [];
            for (const table of tablesResult.tables) {
                const repairResult = await apiRequest('execute_sql', {
                    db_host: conn.host,
                    db_name: conn.dbName,
                    db_user: conn.username,
                    db_pass: conn.password,
                    db_port: conn.port,
                    sql_query: `REPAIR TABLE \`${table}\`;`
                });

                if (repairResult.success) {
                    repairLog.push(`‚úÖ ${table}: Repaired`);
                } else {
                    repairLog.push(`‚ö†Ô∏è ${table}: ${repairResult.message}`);
                }
            }

            diagnosticEl.innerHTML = `
                <div class="message success" style="display: block;">
                    üîß Repair completed for ${tablesResult.tables.length} table(s)<br><br>
                    ${repairLog.join('<br>')}
                </div>
            `;
        }

        // Expandable section toggle
        function toggleExpandable(id) {
            const content = document.getElementById(id);
            const toggle = document.getElementById(id + 'Toggle');
            content.classList.toggle('expanded');
            toggle.textContent = content.classList.contains('expanded') ? '‚ñ≤' : '‚ñº';
        }

        // Show message
        function showMessage(elementId, message, type) {
            const messageEl = document.getElementById(elementId);
            messageEl.className = `message ${type}`;
            messageEl.textContent = message;
            messageEl.style.display = 'block';
            setTimeout(() => {
                messageEl.style.display = 'none';
            }, 5000);
        }

        // API request helper
        async function apiRequest(action, data = {}) {
            try {
                const formData = new FormData();
                formData.append('action', action);
                for (const key in data) {
                    formData.append(key, data[key]);
                }

                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: formData
                });

                return await response.json();
            } catch (error) {
                return { success: false, message: 'Network error: ' + error.message };
            }
        }

        // ========================================
        // DATABASE SELECTION & TABLE OPERATIONS
        // ========================================
        
        let selectedDatabaseId = null;

        // Load selected database from localStorage
        function loadSelectedDatabase() {
            const savedSelection = localStorage.getItem(SELECTED_DATABASE_KEY);
            if (savedSelection) {
                selectedDatabaseId = savedSelection;
                
                // Apply selection to card if it exists
                const card = document.getElementById(selectedDatabaseId);
                if (card) {
                    card.classList.add('selected');
                }

                // Show deselect button
                const deselectBtn = document.getElementById('deselectDatabaseBtn');
                if (deselectBtn) {
                    deselectBtn.classList.add('active');
                }

                // Update selected database badge
                updateSelectedDatabaseBadge();

                // Update selected database display in Generate Database section
                updateSelectedDatabaseDisplay();

                // Update selected database display in Create Table section
                updateCreateTableDatabaseDisplay();

                // Update selected database display in Edit Table section
                updateEditTableDatabaseDisplay();

                // Update selected database display in Delete Table section
                updateDeleteTableDatabaseDisplay();

                // Update selected database display in Rename Table section
                updateRenameTableDatabaseDisplay();

                // Update AI Prompt display
                updateAIPromptDisplay();

                // Show TABLE OPERATIONS in sidebar
                showTableOperations();
            }
        }

        // Update selected database badge with database name
        function updateSelectedDatabaseBadge() {
            if (!selectedDatabaseId) return;

            // Extract connection ID from selectedDatabaseId (format: conn_123456)
            const connId = selectedDatabaseId.replace('conn_', '');
            const connections = getHostingerConnections();
            const conn = connections.find(c => c.id === connId);

            if (conn) {
                const badgeNameEl = document.getElementById('selectedDatabaseName');
                if (badgeNameEl) {
                    badgeNameEl.textContent = conn.name;
                }
            }
        }

        // Select database
        function selectDatabase(connId) {
            // Deselect previous if any
            if (selectedDatabaseId) {
                const prevCard = document.getElementById(selectedDatabaseId);
                if (prevCard) {
                    prevCard.classList.remove('selected');
                }
            }

            // Select new database
            selectedDatabaseId = connId;
            const card = document.getElementById(connId);
            if (card) {
                card.classList.add('selected');
            }

            // Save to localStorage
            localStorage.setItem(SELECTED_DATABASE_KEY, connId);

            // Show deselect button
            const deselectBtn = document.getElementById('deselectDatabaseBtn');
            if (deselectBtn) {
                deselectBtn.classList.add('active');
            }

            // Update selected database badge
            updateSelectedDatabaseBadge();

            // Update selected database display in Generate Database section
            updateSelectedDatabaseDisplay();

            // Update selected database display in Create Table section
            updateCreateTableDatabaseDisplay();

            // Update selected database display in Edit Table section
            updateEditTableDatabaseDisplay();

            // Update selected database display in Delete Table section
            updateDeleteTableDatabaseDisplay();

            // Update selected database display in Rename Table section
            updateRenameTableDatabaseDisplay();

            // Update AI Prompt display
            updateAIPromptDisplay();

            // Update migration tables - load immediately when database is selected
            if (typeof loadMigrationTables === 'function') {
                console.log('Triggering migration tables load from selectDatabase');
                loadMigrationTables();
            }

            // Show TABLE OPERATIONS in sidebar
            showTableOperations();
        }

        // Deselect all databases
        function deselectAllDatabases() {
            // Remove selection from card
            if (selectedDatabaseId) {
                const card = document.getElementById(selectedDatabaseId);
                if (card) {
                    card.classList.remove('selected');
                }
            }

            selectedDatabaseId = null;

            // Remove from localStorage
            localStorage.removeItem(SELECTED_DATABASE_KEY);

            // Hide deselect button
            const deselectBtn = document.getElementById('deselectDatabaseBtn');
            if (deselectBtn) {
                deselectBtn.classList.remove('active');
            }

            // Update selected database display in Generate Database section
            updateSelectedDatabaseDisplay();

            // Hide TABLE OPERATIONS in sidebar
            hideTableOperations();
        }

        // Show TABLE OPERATIONS in sidebar
        function showTableOperations() {
            const tableOpsSections = document.querySelectorAll('.nav-item.hidden-section, .section.hidden-section');
            tableOpsSections.forEach(section => {
                section.classList.remove('hidden-section');
            });

            // Show selected database badge
            const badge = document.getElementById('selectedDatabaseAlert');
            if (badge) {
                badge.classList.remove('hidden-section');
            }
        }

        // Hide TABLE OPERATIONS in sidebar
        function hideTableOperations() {
            // Get all TABLE OPERATIONS nav items
            const navItems = document.querySelectorAll('.nav-item');
            let foundTableOpsHeader = false;
            
            navItems.forEach(item => {
                // Check if this is the TABLE OPERATIONS header or comes after it
                const text = item.textContent.trim();
                if (text.includes('TABLE OPERATIONS')) {
                    foundTableOpsHeader = true;
                    item.classList.add('hidden-section');
                } else if (foundTableOpsHeader && (text.includes('List Tables') || text.includes('Create Table') || text.includes('Edit Table') || text.includes('Delete Table') || text.includes('Rename Table'))) {
                    item.classList.add('hidden-section');
                }
            });

            // Hide selected database badge
            const badge = document.getElementById('selectedDatabaseAlert');
            if (badge) {
                badge.classList.add('hidden-section');
            }

            // Hide TABLE OPERATIONS sections
            const sections = ['listTables', 'createTable', 'editTable', 'deleteTable', 'renameTable'];
            sections.forEach(id => {
                const section = document.getElementById(id);
                if (section) {
                    section.classList.add('hidden-section');
                }
            });
        }

        // ========================================
        // HOSTINGER CONNECTIONS MANAGEMENT
        // ========================================

        // Get saved connections
        function getHostingerConnections() {
            const saved = localStorage.getItem(HOSTINGER_CONNECTIONS_KEY);
            return saved ? JSON.parse(saved) : [];
        }

        // Save connections
        function saveHostingerConnections(connections) {
            localStorage.setItem(HOSTINGER_CONNECTIONS_KEY, JSON.stringify(connections));
        }

        // Add new connection
        function addHostingerConnection(event) {
            event.preventDefault();
            
            const connection = {
                id: Date.now().toString(),
                name: document.getElementById('connName').value.trim(),
                type: document.getElementById('connType').value,
                host: document.getElementById('connHost').value.trim(),
                dbName: document.getElementById('connDbName').value.trim(),
                username: document.getElementById('connUsername').value.trim(),
                password: document.getElementById('connPassword').value,
                port: document.getElementById('connPort').value.trim() || '3306',
                createdAt: new Date().toISOString()
            };

            const connections = getHostingerConnections();
            connections.push(connection);
            saveHostingerConnections(connections);

            showMessage('settingsMessage', `‚úÖ Connection "${connection.name}" added successfully!`, 'success');
            
            // Reset form
            document.getElementById('connName').value = '';
            document.getElementById('connHost').value = '192.168.8.4';
            document.getElementById('connDbName').value = '';
            document.getElementById('connUsername').value = '';
            document.getElementById('connPassword').value = '';
            document.getElementById('connPort').value = '3306';
            
            // Reset password visibility
            const passwordInput = document.getElementById('connPassword');
            const toggleBtn = document.getElementById('togglePasswordBtn');
            passwordInput.type = 'password';
            toggleBtn.textContent = 'üëÅÔ∏è';
            toggleBtn.style.background = 'rgba(59, 130, 246, 0.2)';
            toggleBtn.style.borderColor = '#3b82f6';
            toggleBtn.style.color = '#93c5fd';
            
            loadHostingerConnectionsTable();
            loadDashboardConnections();
        }

        // Edit connection
        function editHostingerConnection(id) {
            const connections = getHostingerConnections();
            const conn = connections.find(c => c.id === id);
            
            if (!conn) return;

            // Fill form with connection data
            document.getElementById('connName').value = conn.name;
            document.getElementById('connType').value = conn.type;
            document.getElementById('connHost').value = conn.host;
            document.getElementById('connDbName').value = conn.dbName;
            document.getElementById('connUsername').value = conn.username;
            document.getElementById('connPassword').value = conn.password;
            document.getElementById('connPort').value = conn.port;

            // Delete old connection
            deleteHostingerConnection(id, true);
            
            // Scroll to form
            document.querySelector('#settings .card').scrollIntoView({ behavior: 'smooth' });
        }

        // Delete connection
        function deleteHostingerConnection(id, silent = false) {
            if (!silent && !confirm('Are you sure you want to delete this connection?')) {
                return;
            }

            // Check if deleted connection is the selected one
            const connId = `conn_${id}`;
            if (selectedDatabaseId === connId) {
                deselectAllDatabases();
            }

            let connections = getHostingerConnections();
            connections = connections.filter(c => c.id !== id);
            saveHostingerConnections(connections);

            if (!silent) {
                showMessage('settingsMessage', '‚úÖ Connection deleted successfully!', 'success');
            }
            
            loadHostingerConnectionsTable();
            loadDashboardConnections();
        }

        // Clear all connections
        function clearAllHostingerConnections() {
            if (!confirm('Are you sure you want to delete ALL connections? This action cannot be undone!')) {
                return;
            }

            // Deselect if any database was selected
            deselectAllDatabases();

            localStorage.removeItem(HOSTINGER_CONNECTIONS_KEY);
            showMessage('settingsMessage', '‚úÖ All connections cleared!', 'success');
            
            loadHostingerConnectionsTable();
            loadDashboardConnections();
        }

        // Toggle password visibility in Settings
        function togglePasswordVisibility() {
            const passwordInput = document.getElementById('connPassword');
            const toggleBtn = document.getElementById('togglePasswordBtn');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleBtn.textContent = 'üôà';
                toggleBtn.style.background = 'rgba(34, 197, 94, 0.2)';
                toggleBtn.style.borderColor = '#22c55e';
                toggleBtn.style.color = '#86efac';
            } else {
                passwordInput.type = 'password';
                toggleBtn.textContent = 'üëÅÔ∏è';
                toggleBtn.style.background = 'rgba(59, 130, 246, 0.2)';
                toggleBtn.style.borderColor = '#3b82f6';
                toggleBtn.style.color = '#93c5fd';
            }
        }

        // Populate autocomplete fields from previous connections
        function populateAutocompleteFields() {
            const connections = getHostingerConnections();
            
            // Get unique values
            const hosts = [...new Set(connections.map(c => c.host))];
            const dbNames = [...new Set(connections.map(c => c.dbName))];
            const usernames = [...new Set(connections.map(c => c.username))];

            // Populate Host datalist
            const hostList = document.getElementById('hostList');
            hostList.innerHTML = hosts.map(h => `<option value="${h}">`).join('');

            // Populate Database Name datalist
            const dbNameList = document.getElementById('dbNameList');
            dbNameList.innerHTML = dbNames.map(db => `<option value="${db}">`).join('');

            // Populate Username datalist
            const usernameList = document.getElementById('usernameList');
            usernameList.innerHTML = usernames.map(u => `<option value="${u}">`).join('');
        }

        // Toggle password visibility in table
        function toggleTablePassword(connId, password) {
            const pwdSpan = document.getElementById(`pwd_${connId}`);
            const pwdBtn = document.getElementById(`pwdBtn_${connId}`);
            
            if (pwdSpan.textContent.includes('‚Ä¢')) {
                // Show password
                pwdSpan.textContent = password;
                pwdBtn.textContent = 'üôà';
                pwdBtn.style.background = 'rgba(34, 197, 94, 0.2)';
                pwdBtn.style.borderColor = '#22c55e';
                pwdBtn.style.color = '#86efac';
            } else {
                // Hide password
                pwdSpan.textContent = '‚Ä¢'.repeat(password.length);
                pwdBtn.textContent = 'üëÅÔ∏è';
                pwdBtn.style.background = 'rgba(59, 130, 246, 0.2)';
                pwdBtn.style.borderColor = '#3b82f6';
                pwdBtn.style.color = '#93c5fd';
            }
        }

        // Load connections table in Settings
        function loadHostingerConnectionsTable() {
            const tableEl = document.getElementById('hostingerConnectionsTable');
            const connections = getHostingerConnections();

            // Populate autocomplete fields
            populateAutocompleteFields();

            if (connections.length === 0) {
                tableEl.innerHTML = '<p style="color: rgba(254, 243, 199, 0.6); text-align: center; padding: 20px;">No connections saved yet.</p>';
                return;
            }

            let html = `
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: rgba(251, 191, 36, 0.1); border-bottom: 2px solid rgba(251, 191, 36, 0.3);">
                                <th style="padding: 12px; text-align: left; color: #fbbf24;">Name</th>
                                <th style="padding: 12px; text-align: left; color: #fbbf24;">Type</th>
                                <th style="padding: 12px; text-align: left; color: #fbbf24;">Host</th>
                                <th style="padding: 12px; text-align: left; color: #fbbf24;">Database</th>
                                <th style="padding: 12px; text-align: left; color: #fbbf24;">Username</th>
                                <th style="padding: 12px; text-align: left; color: #fbbf24;">Password</th>
                                <th style="padding: 12px; text-align: center; color: #fbbf24;">Actions</th>
                            </tr>
                        </thead>
                        <tbody>`;

            connections.forEach(conn => {
                const typeIcon = conn.type === 'vps' ? 'üñ•Ô∏è' : 'üåê';
                const maskedPassword = '‚Ä¢'.repeat(conn.password.length);
                html += `
                    <tr style="border-bottom: 1px solid rgba(251, 191, 36, 0.1);">
                        <td style="padding: 12px; color: #fef3c7;"><strong>${conn.name}</strong></td>
                        <td style="padding: 12px; color: rgba(254, 243, 199, 0.7);">${typeIcon} ${conn.type.toUpperCase()}</td>
                        <td style="padding: 12px; color: rgba(254, 243, 199, 0.7); font-family: monospace; font-size: 13px;">${conn.host}</td>
                        <td style="padding: 12px; color: rgba(254, 243, 199, 0.7); font-family: monospace; font-size: 13px;">${conn.dbName}</td>
                        <td style="padding: 12px; color: rgba(254, 243, 199, 0.7);">${conn.username}</td>
                        <td style="padding: 12px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span id="pwd_${conn.id}" style="font-family: monospace; color: rgba(254, 243, 199, 0.7); font-size: 13px;">${maskedPassword}</span>
                                <button onclick="toggleTablePassword('${conn.id}', '${conn.password.replace(/'/g, "\\'")}')" style="background: rgba(59, 130, 246, 0.2); border: 1px solid #3b82f6; color: #93c5fd; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 14px; transition: all 0.3s;" id="pwdBtn_${conn.id}">
                                    üëÅÔ∏è
                                </button>
                            </div>
                        </td>
                        <td style="padding: 12px; text-align: center;">
                            <button class="btn btn-secondary" style="padding: 6px 12px; margin-right: 5px; font-size: 12px;" onclick="editHostingerConnection('${conn.id}')">‚úèÔ∏è Edit</button>
                            <button class="btn btn-danger" style="padding: 6px 12px; font-size: 12px;" onclick="deleteHostingerConnection('${conn.id}')">üóëÔ∏è Delete</button>
                        </td>
                    </tr>`;
            });

            html += `
                        </tbody>
                    </table>
                </div>`;

            tableEl.innerHTML = html;
        }

        // Load connections in Dashboard with Test Connection
        async function loadDashboardConnections() {
            const listEl = document.getElementById('configuredConnectionsList');
            const connections = getHostingerConnections();

            if (connections.length === 0) {
                listEl.innerHTML = `
                    <p style="color: rgba(254, 243, 199, 0.6); text-align: center; padding: 40px;">
                        No Hostinger connections configured.<br>
                        <span style="font-size: 14px;">Go to <strong>Hostinger Connections</strong> in the sidebar to add your first connection.</span>
                    </p>`;
                return;
            }

            let html = '';
            connections.forEach(conn => {
                const typeIcon = conn.type === 'vps' ? 'üñ•Ô∏è' : 'üåê';
                const connId = `conn_${conn.id}`;
                html += `
                    <div class="database-item" id="${connId}" onclick="selectDatabase('${connId}')">
                        <!-- Row 1: Logo/Icon -->
                        <div class="database-icon-row">
                            <span class="database-icon">${typeIcon}</span>
                        </div>
                        
                        <!-- Row 2: Text Content -->
                        <div class="database-text-row">
                            <div class="database-name">${conn.name}</div>
                            <div class="database-info-item">üìÅ ${conn.dbName}</div>
                            <div class="database-info-item">üñ•Ô∏è ${conn.host}</div>
                        </div>
                        
                        <!-- Row 3: Status + Button -->
                        <div class="database-actions-row">
                            <div id="${connId}_status" class="database-status testing">
                                <span class="spinner"></span>
                                <span>Testing connection...</span>
                            </div>
                            <button class="btn btn-primary database-button" onclick="event.stopPropagation(); testConnectionManual('${conn.id}')">
                                <span>üîÑ</span> Test Again
                            </button>
                        </div>
                    </div>`;
            });

            listEl.innerHTML = html;

            // Auto-test all connections
            connections.forEach(conn => {
                testConnection(conn.id);
            });

            // Restore selected database if exists
            setTimeout(() => {
                loadSelectedDatabase();
            }, 50);
        }

        // Test connection (automatic on load)
        async function testConnection(connId) {
            const connections = getHostingerConnections();
            const conn = connections.find(c => c.id === connId);
            
            if (!conn) return;

            const statusEl = document.getElementById(`conn_${connId}_status`);
            
            try {
                const result = await apiRequest('check_connection', {
                    db_host: conn.host,
                    db_name: conn.dbName,
                    db_user: conn.username,
                    db_pass: conn.password,
                    db_port: conn.port
                });

                if (result.success) {
                    statusEl.className = 'database-status success';
                    statusEl.innerHTML = '‚úÖ Connected successfully!';
                } else {
                    statusEl.className = 'database-status error';
                    statusEl.innerHTML = `‚ùå Connection failed: ${result.message}`;
                }
            } catch (error) {
                statusEl.className = 'database-status error';
                statusEl.innerHTML = `‚ùå Error: ${error.message}`;
            }
        }

        // Test connection manually (when clicking Test Again button)
        function testConnectionManual(connId) {
            const statusEl = document.getElementById(`conn_${connId}_status`);
            statusEl.className = 'database-status testing';
            statusEl.innerHTML = '<span class="spinner"></span><span>Testing connection...</span>';
            
            testConnection(connId);
        }

        // ========================================
        // NOTE: Old database operations functions below
        // These will need to be updated for Hostinger connections
        // ========================================

        // Load databases
        async function loadDatabases() {
            const listEl = document.getElementById('databaseList');
            listEl.innerHTML = '<div class="spinner"></div> Loading databases...';
            
            const result = await apiRequest('list_databases');
            
            if (result.success) {
                const credentials = getSavedCredentials();
                if (result.databases.length === 0) {
                    listEl.innerHTML = '<p style="color: rgba(254, 243, 199, 0.6); text-align: center; padding: 20px;">No databases found</p>';
                } else {
                    listEl.innerHTML = result.databases.map(db => {
                        const hasCredentials = credentials.some(c => c.dbName === db);
                        return `
                            <div class="database-item" onclick="connectToDatabase('${db}')">
                                ${hasCredentials ? '<span class="lock-icon">üîí</span>' : ''}
                                <div class="database-name">
                                    <span class="database-icon">üóÑÔ∏è</span>
                                    <span>${db}</span>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
                showMessage('listMessage', `‚úÖ Found ${result.databases.length} database(s)`, 'success');
            } else {
                listEl.innerHTML = '';
                showMessage('listMessage', '‚ùå ' + result.message, 'error');
            }
        }

        // Load databases for dropdowns
        async function loadDatabasesForDropdowns() {
            const result = await apiRequest('list_databases');
            
            if (result.success) {
                const options = result.databases.map(db => 
                    `<option value="${db}">${db}</option>`
                ).join('');
                
                document.getElementById('deleteDbSelect').innerHTML = '<option value="">-- Select Database --</option>' + options;
                document.getElementById('renameOldSelect').innerHTML = '<option value="">-- Select Database --</option>' + options;
                document.getElementById('credentialsDbSelect').innerHTML = '<option value="">-- Select Database --</option>' + options;
            }
        }

        // Connect to database
        async function connectToDatabase(dbName) {
            currentDatabase = dbName;
            const savedCreds = getCredentialsForDatabase(dbName);
            
            // Try connection with saved credentials first
            let username = savedCreds ? savedCreds.username : '';
            let password = savedCreds ? savedCreds.password : '';
            
            showMessage('listMessage', `üîÑ Connecting to ${dbName}...`, 'info');
            
            const result = await apiRequest('connect_database', {
                db_name: dbName,
                db_username: username,
                db_password: password
            });
            
            if (result.success) {
                showMessage('listMessage', `‚úÖ ${result.message}`, 'success');
                updateConnectionStatus(dbName);
            } else if (result.requiresCredentials) {
                // Show credentials modal
                openConnectionModal(dbName, result.message);
            } else {
                showMessage('listMessage', `‚ùå ${result.message}`, 'error');
            }
        }

        // Open connection modal
        function openConnectionModal(dbName, message) {
            document.getElementById('modalTitle').textContent = `Connect to ${dbName}`;
            document.getElementById('modalMessage').textContent = message || 'This database requires authentication';
            document.getElementById('modalUsername').value = '';
            document.getElementById('modalPassword').value = '';
            populateSavedUsernames();
            document.getElementById('connectionModal').classList.add('active');
        }

        // Close connection modal
        function closeConnectionModal() {
            document.getElementById('connectionModal').classList.remove('active');
            currentDatabase = null;
        }

        // Submit connection
        async function submitConnection() {
            const username = document.getElementById('modalUsername').value;
            const password = document.getElementById('modalPassword').value;
            
            if (!username || !password) {
                alert('Please enter both username and password');
                return;
            }
            
            const result = await apiRequest('connect_database', {
                db_name: currentDatabase,
                db_username: username,
                db_password: password
            });
            
            if (result.success) {
                // Save credentials
                saveCredentials(currentDatabase, username, password);
                showMessage('listMessage', `‚úÖ ${result.message} (Credentials saved)`, 'success');
                closeConnectionModal();
                loadDatabases(); // Refresh to show lock icon
                updateConnectionStatus(currentDatabase);
            } else {
                document.getElementById('modalMessage').textContent = '‚ùå ' + result.message;
            }
        }

        // Create database
        async function createDatabase(event) {
            event.preventDefault();
            
            const dbName = document.getElementById('newDbName').value.trim();
            const username = document.getElementById('newDbUsername').value.trim();
            const password = document.getElementById('newDbPassword').value.trim();
            
            if (!dbName) {
                showMessage('createMessage', '‚ùå Please enter a database name', 'error');
                return;
            }
            
            showMessage('createMessage', 'üîÑ Creating database...', 'info');
            
            const result = await apiRequest('create_database', {
                db_name: dbName,
                db_username: username,
                db_password: password
            });
            
            if (result.success) {
                showMessage('createMessage', `‚úÖ ${result.message}`, 'success');
                document.getElementById('newDbName').value = '';
                document.getElementById('newDbUsername').value = '';
                document.getElementById('newDbPassword').value = '';
                
                // Save credentials if provided
                if (username && password) {
                    saveCredentials(dbName, username, password);
                    showMessage('createMessage', `‚úÖ ${result.message} (Credentials saved for future use)`, 'success');
                }
                
                loadDatabasesForDropdowns();
                loadDatabases();
            } else {
                showMessage('createMessage', `‚ùå ${result.message}`, 'error');
            }
        }

        // Delete database
        async function deleteDatabase(event) {
            event.preventDefault();
            
            const dbName = document.getElementById('deleteDbSelect').value;
            
            if (!dbName) {
                showMessage('deleteMessage', '‚ùå Please select a database', 'error');
                return;
            }
            
            if (!confirm(`Are you sure you want to delete the database "${dbName}"?\n\nThis action cannot be undone!`)) {
                return;
            }
            
            showMessage('deleteMessage', 'üîÑ Deleting database...', 'info');
            
            const result = await apiRequest('delete_database', { db_name: dbName });
            
            if (result.success) {
                showMessage('deleteMessage', `‚úÖ ${result.message}`, 'success');
                document.getElementById('deleteDbSelect').value = '';
                loadDatabasesForDropdowns();
                loadDatabases();
                
                // Remove saved credentials
                let credentials = getSavedCredentials();
                credentials = credentials.filter(c => c.dbName !== dbName);
                localStorage.setItem(CREDENTIALS_KEY, JSON.stringify(credentials));
            } else {
                showMessage('deleteMessage', `‚ùå ${result.message}`, 'error');
            }
        }

        // Rename database
        async function renameDatabase(event) {
            event.preventDefault();
            
            const oldName = document.getElementById('renameOldSelect').value;
            const newName = document.getElementById('renameNewName').value.trim();
            
            if (!oldName || !newName) {
                showMessage('renameMessage', '‚ùå Please provide both old and new database names', 'error');
                return;
            }
            
            if (oldName === newName) {
                showMessage('renameMessage', '‚ùå New name must be different from old name', 'error');
                return;
            }
            
            showMessage('renameMessage', 'üîÑ Renaming database...', 'info');
            
            const result = await apiRequest('rename_database', {
                old_name: oldName,
                new_name: newName
            });
            
            if (result.success) {
                showMessage('renameMessage', `‚úÖ ${result.message}`, 'success');
                document.getElementById('renameOldSelect').value = '';
                document.getElementById('renameNewName').value = '';
                loadDatabasesForDropdowns();
                loadDatabases();
                
                // Update saved credentials
                let credentials = getSavedCredentials();
                const cred = credentials.find(c => c.dbName === oldName);
                if (cred) {
                    cred.dbName = newName;
                    localStorage.setItem(CREDENTIALS_KEY, JSON.stringify(credentials));
                }
            } else {
                showMessage('renameMessage', `‚ùå ${result.message}`, 'error');
            }
        }

        // Check existing credentials
        function checkExistingCredentials() {
            const dbName = document.getElementById('credentialsDbSelect').value;
            const statusEl = document.getElementById('credentialStatus');
            
            if (!dbName) {
                statusEl.innerHTML = '';
                return;
            }
            
            const savedCreds = getCredentialsForDatabase(dbName);
            
            if (savedCreds) {
                statusEl.innerHTML = `<div class="message info" style="display: block;">‚ÑπÔ∏è This database already has saved credentials (User: ${savedCreds.username}). You can update them below.</div>`;
            } else {
                statusEl.innerHTML = `<div class="message info" style="display: block;">‚ÑπÔ∏è This database has no saved credentials. Add username and password to secure it.</div>`;
            }
        }

        // Set database credentials
        async function setDatabaseCredentials(event) {
            event.preventDefault();
            
            const dbName = document.getElementById('credentialsDbSelect').value;
            const username = document.getElementById('credentialsUsername').value.trim();
            const password = document.getElementById('credentialsPassword').value;
            const confirmPassword = document.getElementById('credentialsConfirmPassword').value;
            
            if (!dbName || !username || !password) {
                showMessage('credentialsMessage', '‚ùå Please fill in all fields', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showMessage('credentialsMessage', '‚ùå Passwords do not match', 'error');
                return;
            }
            
            showMessage('credentialsMessage', 'üîÑ Setting credentials...', 'info');
            
            const result = await apiRequest('set_database_credentials', {
                db_name: dbName,
                db_username: username,
                db_password: password
            });
            
            if (result.success) {
                showMessage('credentialsMessage', `‚úÖ ${result.message}`, 'success');
                
                // Save credentials
                saveCredentials(dbName, username, password);
                
                // Reset form
                document.getElementById('credentialsDbSelect').value = '';
                document.getElementById('credentialsUsername').value = '';
                document.getElementById('credentialsPassword').value = '';
                document.getElementById('credentialsConfirmPassword').value = '';
                document.getElementById('credentialStatus').innerHTML = '';
                
                loadDatabases(); // Refresh to show lock icon
            } else {
                showMessage('credentialsMessage', `‚ùå ${result.message}`, 'error');
            }
        }

        // ========================================
        // TABLE OPERATIONS FUNCTIONS
        // ========================================

        // Update connection status display
        function updateConnectionStatus(dbName) {
            const statusElements = [
                'tableConnectionStatus',
                'createTableConnectionStatus',
                'editTableConnectionStatus',
                'deleteTableConnectionStatus',
                'renameTableConnectionStatus'
            ];
            
            statusElements.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.textContent = `‚úÖ Connected to database: ${dbName}`;
                    el.classList.add('active');
                }
            });

            // Load tables for dropdowns when database is connected
            loadTablesForDropdowns();
        }

        // Tab switching for create table
        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            if (tabName === 'manual') {
                document.querySelector('.tab-btn:nth-child(1)').classList.add('active');
                document.getElementById('manualTab').classList.add('active');
            } else if (tabName === 'template') {
                document.querySelector('.tab-btn:nth-child(2)').classList.add('active');
                document.getElementById('templateTab').classList.add('active');
                loadTemplates();
            } else if (tabName === 'migration') {
                document.querySelector('.tab-btn:nth-child(3)').classList.add('active');
                document.getElementById('migrationTab').classList.add('active');
                loadMigrationTables();
                loadDestinationDropdown();
            }
        }

        // Migration: Get emoji based on table name
        function getTableEmoji(tableName) {
            const name = tableName.toLowerCase();
            
            // Common patterns
            if (name.includes('user') || name.includes('account') || name.includes('member')) return 'üë§';
            if (name.includes('product') || name.includes('item')) return 'üì¶';
            if (name.includes('order') || name.includes('purchase')) return 'üõí';
            if (name.includes('payment') || name.includes('transaction')) return 'üí≥';
            if (name.includes('category') || name.includes('categor')) return 'üìÇ';
            if (name.includes('post') || name.includes('article') || name.includes('blog')) return 'üìù';
            if (name.includes('comment')) return 'üí¨';
            if (name.includes('message') || name.includes('mail') || name.includes('email')) return '‚úâÔ∏è';
            if (name.includes('image') || name.includes('photo') || name.includes('picture')) return 'üñºÔ∏è';
            if (name.includes('file') || name.includes('document')) return 'üìÑ';
            if (name.includes('video')) return 'üé•';
            if (name.includes('audio') || name.includes('music')) return 'üéµ';
            if (name.includes('setting') || name.includes('config')) return '‚öôÔ∏è';
            if (name.includes('log') || name.includes('history')) return 'üìã';
            if (name.includes('notification') || name.includes('alert')) return 'üîî';
            if (name.includes('tag')) return 'üè∑Ô∏è';
            if (name.includes('session')) return 'üîê';
            if (name.includes('token') || name.includes('api')) return 'üîë';
            if (name.includes('report')) return 'üìä';
            if (name.includes('analytics') || name.includes('statistic')) return 'üìà';
            if (name.includes('invoice')) return 'üßæ';
            if (name.includes('cart') || name.includes('basket')) return 'üõçÔ∏è';
            if (name.includes('review') || name.includes('rating')) return '‚≠ê';
            if (name.includes('wishlist') || name.includes('favorite')) return '‚ù§Ô∏è';
            if (name.includes('address') || name.includes('location')) return 'üìç';
            if (name.includes('country') || name.includes('city') || name.includes('region')) return 'üåç';
            if (name.includes('language')) return 'üåê';
            if (name.includes('permission') || name.includes('role')) return 'üõ°Ô∏è';
            if (name.includes('backup')) return 'üíæ';
            if (name.includes('cache')) return '‚ö°';
            if (name.includes('queue') || name.includes('job')) return 'üìÆ';
            if (name.includes('event')) return 'üìÖ';
            if (name.includes('customer') || name.includes('client')) return 'üë•';
            if (name.includes('supplier') || name.includes('vendor')) return 'üè™';
            if (name.includes('employee') || name.includes('staff')) return 'üëî';
            if (name.includes('department')) return 'üè¢';
            if (name.includes('project')) return 'üìÅ';
            if (name.includes('task') || name.includes('todo')) return '‚úÖ';
            if (name.includes('ticket') || name.includes('support')) return 'üé´';
            if (name.includes('feedback')) return 'üì£';
            if (name.includes('contact')) return 'üìû';
            if (name.includes('subscription')) return 'üì¨';
            if (name.includes('coupon') || name.includes('discount') || name.includes('promo')) return 'üéüÔ∏è';
            if (name.includes('shipping') || name.includes('delivery')) return 'üöö';
            if (name.includes('inventory') || name.includes('stock')) return 'üì¶';
            if (name.includes('warehouse')) return 'üè≠';
            
            // Default
            return 'üìä';
        }

        // Migration: Load tables from selected database
        let migrationTables = [];
        let migrationTablesRowCount = {};  // Store row counts
        let selectedMigrationTables = new Set();
        let destinationTables = [];
        let destinationTablesRowCount = {};  // Store row counts
        let selectedDestinationTables = new Set();
        let selectedDestinationId = null;

        // Load row counts for tables (parallel for speed)
        async function loadTableRowCounts(conn, tables, rowCountObject) {
            console.log('Loading row counts for', tables.length, 'tables...');
            
            // Load all row counts in parallel for better performance
            const promises = tables.map(async (tableName) => {
                try {
                    const result = await apiRequest('get_table_data', {
                        db_host: conn.host,
                        db_name: conn.dbName,
                        db_user: conn.username,
                        db_pass: conn.password,
                        db_port: conn.port || '3306',
                        table_name: tableName,
                        page: 1,
                        limit: 1
                    });
                    
                    if (result.success && result.pagination) {
                        rowCountObject[tableName] = result.pagination.total_rows;
                        console.log(`  ‚úÖ ${tableName}: ${result.pagination.total_rows.toLocaleString()} rows`);
                    } else {
                        rowCountObject[tableName] = 0;
                        console.log(`  ‚ö†Ô∏è ${tableName}: 0 rows (or error)`);
                    }
                } catch (error) {
                    console.error(`  ‚ùå Failed to get row count for ${tableName}:`, error);
                    rowCountObject[tableName] = 0;
                }
            });
            
            await Promise.all(promises);
            console.log('‚úÖ Row counts loaded for all tables');
        }

        async function loadMigrationTables() {
            console.log('Loading migration tables...', selectedDatabaseId);
            
            if (!selectedDatabaseId) {
                document.getElementById('migrationSourceDbName').textContent = 'No database selected';
                document.getElementById('migrationTablesContainer').innerHTML = `
                    <div style="width: 100%; text-align: center; padding: 40px 20px; color: rgba(254, 243, 199, 0.5);">
                        <div style="font-size: 48px; margin-bottom: 15px;">‚ö†Ô∏è</div>
                        <p style="font-size: 14px;">Please select a database first from Dashboard</p>
                    </div>
                `;
                updateMigrationCounts();
                return;
            }

            // Get all connections
            const allConnections = getHostingerConnections();
            console.log('All connections:', allConnections);
            
            // Extract the actual ID from selectedDatabaseId (remove 'conn_' prefix if present)
            const actualId = selectedDatabaseId.replace('conn_', '');
            console.log('Looking for connection with ID:', actualId);
            
            // Find the selected connection
            const conn = allConnections.find(c => c.id === actualId);
            console.log('Selected connection:', conn);
            
            if (!conn) {
                console.error('Connection not found for ID:', actualId);
                document.getElementById('migrationSourceDbName').textContent = 'Connection not found';
                document.getElementById('migrationTablesContainer').innerHTML = `
                    <div style="width: 100%; text-align: center; padding: 40px 20px; color: rgba(254, 243, 199, 0.5);">
                        <div style="font-size: 48px; margin-bottom: 15px;">‚ùå</div>
                        <p style="font-size: 14px;">Connection not found</p>
                        <p style="font-size: 12px; margin-top: 10px;">ID: ${actualId}</p>
                    </div>
                `;
                return;
            }

            document.getElementById('migrationSourceDbName').textContent = `Database: ${conn.name}`;

            // Show loading state
            document.getElementById('migrationTablesContainer').innerHTML = `
                <div style="width: 100%; text-align: center; padding: 40px 20px; color: rgba(254, 243, 199, 0.5);">
                    <div style="font-size: 48px; margin-bottom: 15px;">‚è≥</div>
                    <p style="font-size: 14px;">Loading tables...</p>
                </div>
            `;

            try {
                const result = await apiRequest('list_tables', {
                    db_host: conn.host,
                    db_name: conn.dbName,
                    db_user: conn.username,
                    db_pass: conn.password,
                    db_port: conn.port
                });
                
                console.log('API Result:', result);
                
                if (result.success && result.tables) {
                    migrationTables = result.tables;
                    selectedMigrationTables.clear(); // Clear selections when loading new tables
                    console.log('Tables loaded:', migrationTables);
                    
                    // Load row counts for each table
                    await loadTableRowCounts(conn, migrationTables, migrationTablesRowCount);
                    
                    renderMigrationTables();
                    updateMigrationCounts();
                    
                    // Update destination dropdown to exclude current source
                    loadDestinationDropdown();
                } else {
                    console.warn('No tables found or error:', result);
                    document.getElementById('migrationTablesContainer').innerHTML = `
                        <div style="width: 100%; text-align: center; padding: 40px 20px; color: rgba(254, 243, 199, 0.5);">
                            <div style="font-size: 48px; margin-bottom: 15px;">üì≠</div>
                            <p style="font-size: 14px;">No tables found in this database</p>
                            <p style="font-size: 12px; margin-top: 10px;">${result.message || ''}</p>
                        </div>
                    `;
                    migrationTables = [];
                    updateMigrationCounts();
                }
            } catch (error) {
                console.error('Error loading migration tables:', error);
                document.getElementById('migrationTablesContainer').innerHTML = `
                    <div style="width: 100%; text-align: center; padding: 40px 20px; color: rgba(254, 243, 199, 0.5);">
                        <div style="font-size: 48px; margin-bottom: 15px;">‚ùå</div>
                        <p style="font-size: 14px;">Error loading tables</p>
                        <p style="font-size: 12px; margin-top: 10px;">${error.message || 'Unknown error'}</p>
                    </div>
                `;
                migrationTables = [];
            }
        }

        // Migration: Render table boxes
        function renderMigrationTables() {
            const container = document.getElementById('migrationTablesContainer');
            
            console.log('Rendering migration tables:', migrationTables);
            
            if (!container) {
                console.error('Migration tables container not found!');
                return;
            }
            
            if (migrationTables.length === 0) {
                container.innerHTML = `
                    <div style="width: 100%; text-align: center; padding: 40px 20px; color: rgba(254, 243, 199, 0.5);">
                        <div style="font-size: 48px; margin-bottom: 15px;">üì≠</div>
                        <p style="font-size: 14px;">No tables found in this database</p>
                    </div>
                `;
                return;
            }

            const html = migrationTables.map(tableName => {
                const emoji = getTableEmoji(tableName);
                const isSelected = selectedMigrationTables.has(tableName);
                const rowCount = migrationTablesRowCount[tableName] !== undefined ? migrationTablesRowCount[tableName] : '...';
                
                return `
                    <div class="migration-table-box ${isSelected ? 'selected' : ''}" 
                         data-table="${tableName}"
                         draggable="true"
                         ondragstart="handleDragStart(event, '${tableName}', false)"
                         ondragend="handleDragEnd(event)"
                         style="cursor: grab; position: relative; padding-bottom: 35px;">
                        
                        <!-- Row Count Badge (Top Left) -->
                        <div style="position: absolute; top: 3px; left: 3px; background: linear-gradient(135deg, rgba(59, 130, 246, 0.8) 0%, rgba(29, 78, 216, 0.8) 100%); padding: 3px 8px; border-radius: 6px; font-size: 10px; font-weight: bold; color: white; border: 1px solid rgba(59, 130, 246, 0.6); box-shadow: 0 2px 6px rgba(59, 130, 246, 0.3); z-index: 5;">
                            <span style="font-size: 11px;">üìä</span> ${typeof rowCount === 'number' ? rowCount.toLocaleString() : rowCount}
                        </div>
                        
                        <span class="migration-check-icon" onclick="toggleMigrationTable('${tableName}')">‚úì</span>
                        <span class="migration-table-emoji" onclick="toggleMigrationTable('${tableName}')">${emoji}</span>
                        <div class="migration-table-name" 
                             oncontextmenu="startRenameTable('${tableName}', this); event.preventDefault(); event.stopPropagation(); return false;"
                             onclick="event.stopPropagation(); toggleMigrationTable('${tableName}')"
                             onmouseover="this.style.cursor='context-menu'; this.style.background='rgba(251, 191, 36, 0.15)'; this.style.borderRadius='4px'; this.style.padding='2px 4px';"
                             onmouseout="this.style.cursor='pointer'; this.style.background=''; this.style.borderRadius=''; this.style.padding='';"
                             title="Right-click to rename | Left-click to select"
                             style="cursor: pointer; user-select: none; transition: all 0.2s;">
                            ${tableName}
                        </div>
                        
                        <!-- Action Buttons Grid (Top Right) -->
                        <div style="position: absolute; top: 3px; right: 3px; display: grid; grid-template-columns: repeat(4, auto); gap: 5px; z-index: 10;">
                            
                            <!-- Inject Random Button -->
                            <button class="action-btn"
                                    onclick="injectRandomIntoTable('${tableName}'); event.stopPropagation();"
                                    title="üé≤ Inject 10 random records"
                                    style="background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%); padding: 5px 9px; border-radius: 6px; border: 1px solid rgba(59, 130, 246, 0.6); cursor: pointer; box-shadow: 0 2px 6px rgba(59, 130, 246, 0.3); transition: all 0.2s;"
                                    onmouseover="this.style.background='linear-gradient(135deg, #60a5fa 0%, #2563eb 100%)'; this.style.transform='scale(1.15) translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(59, 130, 246, 0.5)';"
                                    onmouseout="this.style.background='linear-gradient(135deg, #3b82f6 0%, #1e40af 100%)'; this.style.transform='scale(1)'; this.style.boxShadow='0 2px 6px rgba(59, 130, 246, 0.3)';">
                                <span style="font-size: 13px; filter: drop-shadow(0 1px 2px rgba(0,0,0,0.3));">üé≤</span>
                            </button>
                            
                            <!-- Copy Button -->
                            <button class="action-btn"
                                    onclick="duplicateTable('${tableName}'); event.stopPropagation();"
                                    title="üìã Duplicate table with data"
                                    style="background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%); padding: 5px 9px; border-radius: 6px; border: 1px solid rgba(139, 92, 246, 0.6); cursor: pointer; box-shadow: 0 2px 6px rgba(139, 92, 246, 0.3); transition: all 0.2s;"
                                    onmouseover="this.style.background='linear-gradient(135deg, #a78bfa 0%, #7c3aed 100%)'; this.style.transform='scale(1.15) translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(139, 92, 246, 0.5)';"
                                    onmouseout="this.style.background='linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%)'; this.style.transform='scale(1)'; this.style.boxShadow='0 2px 6px rgba(139, 92, 246, 0.3)';">
                                <span style="font-size: 13px; filter: drop-shadow(0 1px 2px rgba(0,0,0,0.3));">üìã</span>
                            </button>
                            
                            <!-- Empty Button -->
                            <button class="action-btn"
                                    onclick="emptyTableData('${tableName}'); event.stopPropagation();"
                                    title="üßπ Empty table (delete all data)"
                                    style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); padding: 5px 9px; border-radius: 6px; border: 1px solid rgba(245, 158, 11, 0.6); cursor: pointer; box-shadow: 0 2px 6px rgba(245, 158, 11, 0.3); transition: all 0.2s;"
                                    onmouseover="this.style.background='linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%)'; this.style.transform='scale(1.15) translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(245, 158, 11, 0.5)';"
                                    onmouseout="this.style.background='linear-gradient(135deg, #f59e0b 0%, #d97706 100%)'; this.style.transform='scale(1)'; this.style.boxShadow='0 2px 6px rgba(245, 158, 11, 0.3)';">
                                <span style="font-size: 13px; filter: drop-shadow(0 1px 2px rgba(0,0,0,0.3));">üßπ</span>
                            </button>
                            
                            <!-- Delete Button -->
                            <button class="action-btn"
                                    onclick="deleteTableFromMigration('${tableName}'); event.stopPropagation();"
                                    title="üóëÔ∏è Delete table permanently"
                                    style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); padding: 5px 9px; border-radius: 6px; border: 1px solid rgba(239, 68, 68, 0.6); cursor: pointer; box-shadow: 0 2px 6px rgba(239, 68, 68, 0.3); transition: all 0.2s;"
                                    onmouseover="this.style.background='linear-gradient(135deg, #f87171 0%, #ef4444 100%)'; this.style.transform='scale(1.15) translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(239, 68, 68, 0.5)';"
                                    onmouseout="this.style.background='linear-gradient(135deg, #ef4444 0%, #dc2626 100%)'; this.style.transform='scale(1)'; this.style.boxShadow='0 2px 6px rgba(239, 68, 68, 0.3)';">
                                <span style="font-size: 13px; filter: drop-shadow(0 1px 2px rgba(0,0,0,0.3));">üóëÔ∏è</span>
                            </button>
                        </div>
                        
                        <!-- Hand Holder for Structure + Data -->
                        <div class="data-hand-holder" 
                             draggable="true"
                             ondragstart="handleDragStart(event, '${tableName}', true); event.stopPropagation();"
                             ondragend="handleDragEnd(event)"
                             onclick="event.stopPropagation();"
                             onmouseover="this.style.background='linear-gradient(135deg, #22c55e 0%, #15803d 100%)'; this.style.transform='scale(1.15)'; this.style.cursor='grab'; this.style.boxShadow='0 5px 15px rgba(34, 197, 94, 0.6)';"
                             onmouseout="this.style.background='linear-gradient(135deg, #10b981 0%, #059669 100%)'; this.style.transform='scale(1)'; this.style.boxShadow='0 3px 10px rgba(16, 185, 129, 0.4)';"
                             onmousedown="this.style.cursor='grabbing'; this.style.transform='scale(1.05)';"
                             title="‚úã Drag from here to transfer Structure + Data"
                             style="position: absolute; bottom: 3px; right: 3px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); padding: 5px 10px; border-radius: 8px; cursor: grab; display: flex; align-items: center; gap: 5px; border: 2px solid rgba(16, 185, 129, 0.6); box-shadow: 0 3px 10px rgba(16, 185, 129, 0.4); transition: all 0.2s; z-index: 10;">
                            <span style="font-size: 14px; filter: drop-shadow(0 1px 2px rgba(0,0,0,0.3));">‚úã</span>
                            <span style="font-size: 11px; font-weight: bold; color: white; text-shadow: 0 1px 2px rgba(0,0,0,0.3);">Data</span>
                        </div>
                        
                        <span style="position: absolute; bottom: 4px; left: 6px; font-size: 10px; opacity: 0.5; color: #fbbf24; background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px;">üèóÔ∏è Structure</span>
                    </div>
                `;
            }).join('');
            
            console.log('Generated HTML length:', html.length);
            container.innerHTML = html;
        }

        // Migration: Toggle table selection
        function toggleMigrationTable(tableName) {
            if (selectedMigrationTables.has(tableName)) {
                selectedMigrationTables.delete(tableName);
            } else {
                selectedMigrationTables.add(tableName);
            }
            renderMigrationTables();
            updateMigrationCounts();
        }

        // Migration: Select all tables
        function selectAllMigrationTables() {
            selectedMigrationTables = new Set(migrationTables);
            renderMigrationTables();
            updateMigrationCounts();
        }

        // Migration: Deselect all tables
        function deselectAllMigrationTables() {
            selectedMigrationTables.clear();
            renderMigrationTables();
            updateMigrationCounts();
        }

        // Migration: Refresh tables
        function refreshMigrationTables() {
            selectedMigrationTables.clear();
            loadMigrationTables();
        }

        // Migration: Update counts
        function updateMigrationCounts() {
            document.getElementById('migrationSelectedCount').textContent = 
                `${selectedMigrationTables.size} table${selectedMigrationTables.size !== 1 ? 's' : ''} selected`;
            document.getElementById('migrationTotalCount').textContent = 
                `${migrationTables.length} table${migrationTables.length !== 1 ? 's' : ''} total`;
        }

        // ========================================
        // MIGRATION: DESTINATION DATABASE
        // ========================================

        // Load destination database dropdown
        function loadDestinationDropdown() {
            const select = document.getElementById('migrationDestinationSelect');
            if (!select) return;

            // Save current selection
            const currentSelection = select.value;
            console.log('Current destination selection before reload:', currentSelection);

            const allConnections = getHostingerConnections();
            const sourceId = selectedDatabaseId ? selectedDatabaseId.replace('conn_', '') : null;

            // Clear and rebuild dropdown
            select.innerHTML = '<option value="">-- Select Destination --</option>';

            allConnections.forEach(conn => {
                // Skip source database
                if (sourceId && conn.id === sourceId) {
                    return;
                }

                const option = document.createElement('option');
                option.value = conn.id;
                option.textContent = `${conn.name} (${conn.dbName})`;
                option.style.background = 'rgba(0, 0, 0, 0.8)';
                option.style.color = '#fef3c7';
                select.appendChild(option);
            });

            // Restore previous selection if it still exists
            if (currentSelection && currentSelection !== '') {
                const optionExists = Array.from(select.options).some(opt => opt.value === currentSelection);
                if (optionExists) {
                    select.value = currentSelection;
                    console.log('Restored destination selection:', currentSelection);
                } else {
                    console.log('Previous selection no longer available:', currentSelection);
                }
            }

            console.log('Destination dropdown loaded, excluded source:', sourceId);
        }

        // Load destination tables
        async function loadDestinationTables() {
            const select = document.getElementById('migrationDestinationSelect');
            const destId = select ? select.value : null;

            console.log('Loading destination tables for:', destId);
            console.log('Current selectedDestinationId:', selectedDestinationId);

            if (!destId) {
                // Reset destination display
                document.getElementById('migrationDestinationInfo').style.display = 'none';
                document.getElementById('migrationDestinationTablesContainer').innerHTML = `
                    <div style="width: 100%; text-align: center; padding: 40px 20px; color: rgba(254, 243, 199, 0.5);">
                        <div style="font-size: 48px; margin-bottom: 15px;">üéØ</div>
                        <p style="font-size: 14px;">Select a destination database</p>
                    </div>
                `;
                selectedDestinationId = null;
                destinationTables = [];
                selectedDestinationTables.clear();
                updateDestinationCount();
                return;
            }

            selectedDestinationId = destId;
            console.log('Set selectedDestinationId to:', selectedDestinationId);
            selectedDestinationTables.clear(); // Clear selections when loading new destination

            const allConnections = getHostingerConnections();
            const conn = allConnections.find(c => c.id === destId);

            if (!conn) {
                console.error('Destination connection not found:', destId);
                return;
            }

            // Show destination info
            document.getElementById('migrationDestinationInfo').style.display = 'block';
            document.getElementById('migrationDestDbName').textContent = conn.name;
            document.getElementById('migrationDestHost').textContent = `Host: ${conn.host} | DB: ${conn.dbName}`;

            // Show loading state
            document.getElementById('migrationDestinationTablesContainer').innerHTML = `
                <div style="width: 100%; text-align: center; padding: 40px 20px; color: rgba(254, 243, 199, 0.5);">
                    <div style="font-size: 48px; margin-bottom: 15px;">‚è≥</div>
                    <p style="font-size: 14px;">Loading destination tables...</p>
                </div>
            `;

            try {
                const result = await apiRequest('list_tables', {
                    db_host: conn.host,
                    db_name: conn.dbName,
                    db_user: conn.username,
                    db_pass: conn.password,
                    db_port: conn.port
                });

                console.log('Destination tables result:', result);

                if (result.success && result.tables) {
                    destinationTables = result.tables;
                    
                    // Load row counts for destination tables
                    await loadTableRowCounts(conn, destinationTables, destinationTablesRowCount);
                    
                    renderDestinationTables();
                    updateDestinationCount();
                } else {
                    document.getElementById('migrationDestinationTablesContainer').innerHTML = `
                        <div style="width: 100%; text-align: center; padding: 40px 20px; color: rgba(254, 243, 199, 0.5);">
                            <div style="font-size: 48px; margin-bottom: 15px;">üì≠</div>
                            <p style="font-size: 14px;">No tables in destination database</p>
                            <p style="font-size: 12px; margin-top: 10px; color: rgba(34, 197, 94, 0.7);">‚úì Empty database - perfect for migration!</p>
                        </div>
                    `;
                    destinationTables = [];
                    updateDestinationCount();
                }
            } catch (error) {
                console.error('Error loading destination tables:', error);
                document.getElementById('migrationDestinationTablesContainer').innerHTML = `
                    <div style="width: 100%; text-align: center; padding: 40px 20px; color: rgba(254, 243, 199, 0.5);">
                        <div style="font-size: 48px; margin-bottom: 15px;">‚ùå</div>
                        <p style="font-size: 14px;">Error loading destination tables</p>
                    </div>
                `;
                destinationTables = [];
            }
        }

        // Render destination tables
        function renderDestinationTables() {
            const container = document.getElementById('migrationDestinationTablesContainer');

            if (!container) {
                console.error('Destination tables container not found!');
                return;
            }

            if (destinationTables.length === 0) {
                container.innerHTML = `
                    <div style="width: 100%; text-align: center; padding: 40px 20px; color: rgba(254, 243, 199, 0.5);">
                        <div style="font-size: 48px; margin-bottom: 15px;">üì≠</div>
                        <p style="font-size: 14px;">No tables in destination database</p>
                        <p style="font-size: 12px; margin-top: 10px; color: rgba(34, 197, 94, 0.7);">‚úì Empty database - perfect for migration!</p>
                    </div>
                `;
                return;
            }

            const html = destinationTables.map(tableName => {
                const emoji = getTableEmoji(tableName);
                const rowCount = destinationTablesRowCount[tableName] !== undefined ? destinationTablesRowCount[tableName] : '...';

                return `
                    <div class="migration-table-box ${selectedDestinationTables.has(tableName) ? 'selected' : ''}" 
                         style="border-color: rgba(34, 197, 94, 0.4); background: linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(34, 197, 94, 0.05) 100%);"
                         onclick="toggleDestinationTable('${tableName}')"
                         data-table="${tableName}">
                        
                        <!-- Row Count Badge (Top Left) -->
                        <div style="position: absolute; top: 3px; left: 3px; background: linear-gradient(135deg, rgba(34, 197, 94, 0.8) 0%, rgba(21, 128, 61, 0.8) 100%); padding: 3px 8px; border-radius: 6px; font-size: 10px; font-weight: bold; color: white; border: 1px solid rgba(34, 197, 94, 0.6); box-shadow: 0 2px 6px rgba(34, 197, 94, 0.3); z-index: 5;">
                            <span style="font-size: 11px;">üìä</span> ${typeof rowCount === 'number' ? rowCount.toLocaleString() : rowCount}
                        </div>
                        
                        <span class="migration-table-emoji">${emoji}</span>
                        <div class="migration-table-name" style="color: #86efac;">${tableName}</div>
                        ${selectedDestinationTables.has(tableName) ? '<span style="position: absolute; top: 5px; right: 5px; font-size: 12px;">‚úÖ</span>' : ''}
                    </div>
                `;
            }).join('');

            container.innerHTML = html;
        }

        // Update destination count
        function updateDestinationCount() {
            const selectedCount = selectedDestinationTables.size;
            const totalCount = destinationTables.length;
            
            document.getElementById('migrationDestinationSelectedCount').textContent = 
                `${selectedCount} table${selectedCount !== 1 ? 's' : ''} selected`;
            document.getElementById('migrationDestinationCount').textContent = 
                `${totalCount} table${totalCount !== 1 ? 's' : ''} total`;
        }

        // Toggle destination table selection
        function toggleDestinationTable(tableName) {
            if (selectedDestinationTables.has(tableName)) {
                selectedDestinationTables.delete(tableName);
            } else {
                selectedDestinationTables.add(tableName);
            }
            renderDestinationTables();
            updateDestinationCount();
        }

        // Select all destination tables
        function selectAllDestinationTables() {
            selectedDestinationTables.clear();
            destinationTables.forEach(tableName => {
                selectedDestinationTables.add(tableName);
            });
            renderDestinationTables();
            updateDestinationCount();
        }

        // Deselect all destination tables
        function deselectAllDestinationTables() {
            selectedDestinationTables.clear();
            renderDestinationTables();
            updateDestinationCount();
        }

        // Refresh destination tables
        function refreshDestinationTables() {
            loadDestinationTables();
        }

        // Start inline rename for table
        function startRenameTable(oldName, element) {
            console.log('‚úèÔ∏è Starting rename for:', oldName);
            console.log('Element:', element);
            
            // Prevent if already renaming
            if (element.querySelector('input')) {
                console.log('Already renaming, ignoring');
                return;
            }
            
            // Store original content
            const originalContent = element.innerHTML;
            console.log('Original content:', originalContent);
            
            // Create input element using innerHTML (more reliable)
            element.innerHTML = `
                <input type="text" 
                       value="${oldName}" 
                       placeholder="${oldName}"
                       class="rename-input"
                       style="width: 100%; padding: 6px 10px; background: linear-gradient(135deg, rgba(251, 191, 36, 0.3) 0%, rgba(245, 158, 11, 0.2) 100%); border: 2px solid #fbbf24; border-radius: 6px; color: #fef3c7; font-size: 14px; font-weight: 600; text-align: center; outline: none; box-shadow: 0 0 15px rgba(251, 191, 36, 0.5);">
            `;
            
            // Get the input element that was just created
            const input = element.querySelector('input');
            
            console.log('‚úÖ Input created via innerHTML');
            console.log('Input value:', input.value);
            console.log('Input element:', input);
            
            // Focus and select
            setTimeout(() => {
                input.focus();
                input.select();
                console.log('‚úÖ Input focused and selected');
                console.log('Input is focused:', document.activeElement === input);
                console.log('Input current value:', input.value);
            }, 50);
            
            // Handle Enter key (save)
            input.addEventListener('keydown', async function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const newName = input.value.trim();
                    
                    if (!newName) {
                        alert('‚ùå Table name cannot be empty!');
                        input.focus();
                        return;
                    }
                    
                    if (newName === oldName) {
                        // No change, just restore
                        element.innerHTML = originalContent;
                        return;
                    }
                    
                    // Validate table name
                    if (!/^[a-zA-Z0-9_]+$/.test(newName)) {
                        alert('‚ùå Table name can only contain letters, numbers, and underscores!');
                        input.focus();
                        return;
                    }
                    
                    // Check if new name already exists
                    if (migrationTables.includes(newName)) {
                        alert(`‚ùå Table "${newName}" already exists!`);
                        input.focus();
                        return;
                    }
                    
                    // Perform rename
                    await performTableRename(oldName, newName, element, originalContent);
                } else if (e.key === 'Escape') {
                    // Cancel rename
                    element.innerHTML = originalContent;
                }
            });
            
            // Handle blur (clicking outside)
            input.addEventListener('blur', function() {
                setTimeout(() => {
                    if (element.contains(input)) {
                        element.innerHTML = originalContent;
                    }
                }, 200);
            });
        }

        // Perform table rename
        async function performTableRename(oldName, newName, element, originalContent) {
            if (!selectedDatabaseId) {
                alert('‚ùå No database selected');
                element.innerHTML = originalContent;
                return;
            }

            const connId = selectedDatabaseId.replace('conn_', '');
            const connections = getHostingerConnections();
            const sourceConn = connections.find(c => c.id === connId);

            if (!sourceConn) {
                alert('‚ùå Connection not found');
                element.innerHTML = originalContent;
                return;
            }

            // Show loading in element
            element.innerHTML = '<div style="font-size: 11px; color: #93c5fd;">Renaming...</div>';

            try {
                console.log('Renaming table:', oldName, '‚Üí', newName);
                
                const result = await apiRequest('rename_table', {
                    db_host: sourceConn.host,
                    db_name: sourceConn.dbName,
                    db_user: sourceConn.username,
                    db_pass: sourceConn.password,
                    db_port: sourceConn.port || '3306',
                    old_table_name: oldName,
                    new_table_name: newName
                });

                if (!result.success) {
                    throw new Error(result.message || 'Failed to rename table');
                }

                console.log('‚úÖ Table renamed successfully');

                // Show brief success indicator
                element.innerHTML = `<div style="color: #22c55e; font-size: 12px;">‚úÖ Renamed!</div>`;
                
                // Refresh tables after short delay
                setTimeout(async () => {
                    await loadMigrationTables();
                    
                    // Show success toast
                    const toast = document.createElement('div');
                    toast.style.cssText = 'position: fixed; bottom: 30px; right: 30px; background: linear-gradient(135deg, #22c55e 0%, #15803d 100%); color: white; padding: 15px 25px; border-radius: 10px; border: 2px solid #86efac; z-index: 10000; box-shadow: 0 5px 20px rgba(34, 197, 94, 0.5); animation: slideInRight 0.3s ease-out;';
                    toast.innerHTML = `
                        <div style="font-size: 14px; font-weight: bold;">‚úÖ Table Renamed!</div>
                        <div style="font-size: 12px; margin-top: 5px; opacity: 0.9;">${oldName} ‚Üí ${newName}</div>
                        <style>
                            @keyframes slideInRight {
                                from { transform: translateX(400px); opacity: 0; }
                                to { transform: translateX(0); opacity: 1; }
                            }
                        </style>
                    `;
                    document.body.appendChild(toast);
                    
                    setTimeout(() => {
                        toast.style.animation = 'slideOutRight 0.3s ease-out forwards';
                        toast.innerHTML += '<style>@keyframes slideOutRight { from { transform: translateX(0); opacity: 1; } to { transform: translateX(400px); opacity: 0; } }</style>';
                        setTimeout(() => {
                            if (toast.parentNode) {
                                document.body.removeChild(toast);
                            }
                        }, 300);
                    }, 2500);
                }, 500);

            } catch (error) {
                console.error('‚ùå Rename error:', error);
                element.innerHTML = originalContent;
                alert(`‚ùå Rename Failed!\n\n${error.message}`);
            }
        }

        // Inject random records into specific table (called from button in card)
        async function injectRandomIntoTable(tableName) {
            if (!selectedDatabaseId) {
                alert('‚ùå No database selected');
                return;
            }

            console.log('üé≤ Injecting random data into:', tableName);

            const connId = selectedDatabaseId.replace('conn_', '');
            const connections = getHostingerConnections();
            const conn = connections.find(c => c.id === connId);

            if (!conn) {
                alert('‚ùå Connection not found');
                return;
            }

            // Show loading toast
            const loadingToast = document.createElement('div');
            loadingToast.id = 'injectLoadingToast';
            loadingToast.style.cssText = 'position: fixed; bottom: 30px; right: 30px; background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%); color: white; padding: 15px 25px; border-radius: 10px; border: 2px solid #60a5fa; z-index: 10000; box-shadow: 0 5px 20px rgba(59, 130, 246, 0.5);';
            loadingToast.innerHTML = `
                <div style="font-size: 14px; font-weight: bold;">üé≤ Generating random data...</div>
                <div style="font-size: 12px; margin-top: 5px; opacity: 0.9;">${tableName}</div>
            `;
            document.body.appendChild(loadingToast);

            try {
                // Get table structure
                const structResult = await apiRequest('get_table_structure', {
                    db_host: conn.host,
                    db_name: conn.dbName,
                    db_user: conn.username,
                    db_pass: conn.password,
                    db_port: conn.port || '3306',
                    table_name: tableName
                });

                if (!structResult.success) {
                    throw new Error(structResult.message || 'Failed to get table structure');
                }

                // Generate random records (use existing function)
                const randomRecords = generateRandomRecords(structResult.columns, 10);

                if (randomRecords.length === 0) {
                    throw new Error('Could not generate records (table has only auto-increment columns?)');
                }

                // Insert records
                const result = await apiRequest('insert_random_data', {
                    db_host: conn.host,
                    db_name: conn.dbName,
                    db_user: conn.username,
                    db_pass: conn.password,
                    db_port: conn.port || '3306',
                    table_name: tableName,
                    records_data: JSON.stringify(randomRecords),
                    record_count: 10
                });

                document.body.removeChild(loadingToast);

                if (result.success) {
                    // Show success toast
                    const successToast = document.createElement('div');
                    successToast.style.cssText = 'position: fixed; bottom: 30px; right: 30px; background: linear-gradient(135deg, #22c55e 0%, #15803d 100%); color: white; padding: 15px 25px; border-radius: 10px; border: 2px solid #86efac; z-index: 10000; box-shadow: 0 5px 20px rgba(34, 197, 94, 0.5);';
                    successToast.innerHTML = `
                        <div style="font-size: 14px; font-weight: bold;">‚úÖ ${result.message}</div>
                        <div style="font-size: 12px; margin-top: 5px; opacity: 0.9;">${tableName}</div>
                    `;
                    document.body.appendChild(successToast);

                    setTimeout(() => {
                        document.body.removeChild(successToast);
                    }, 3000);

                    // Refresh tables to update row count
                    await loadMigrationTables();

                    console.log('‚úÖ Random data injected successfully');
                } else {
                    alert(`‚ùå Failed to inject data:\n\n${result.message}`);
                }

            } catch (error) {
                if (document.getElementById('injectLoadingToast')) {
                    document.body.removeChild(loadingToast);
                }
                console.error('‚ùå Inject error:', error);
                alert(`‚ùå Inject Failed!\n\n${error.message}`);
            }
        }

        // Empty table data (keep structure)
        async function emptyTableData(tableName) {
            if (!selectedDatabaseId) {
                alert('‚ùå No database selected');
                return;
            }

            console.log('=== EMPTY TABLE DATA ===');
            console.log('Table to empty:', tableName);

            const connId = selectedDatabaseId.replace('conn_', '');
            const connections = getHostingerConnections();
            const sourceConn = connections.find(c => c.id === connId);

            if (!sourceConn) {
                alert('‚ùå Connection not found');
                return;
            }

            // Get current row count
            const currentRows = migrationTablesRowCount[tableName] || 0;

            // Confirmation
            if (!confirm(`üßπ Empty Table: ${tableName}\n\n‚ö†Ô∏è This will DELETE ALL ${currentRows.toLocaleString()} RECORD(S) from this table!\n\nTable structure will be preserved.\n\nAre you sure?`)) {
                console.log('User cancelled empty');
                return;
            }

            // Show loading
            const loadingDiv = document.createElement('div');
            loadingDiv.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(245, 158, 11, 0.95); color: white; padding: 30px 50px; border-radius: 12px; border: 2px solid #fbbf24; z-index: 10000; text-align: center; box-shadow: 0 0 40px rgba(245, 158, 11, 0.6);';
            loadingDiv.innerHTML = `
                <div style="font-size: 48px; margin-bottom: 15px; animation: sweep 1s ease-in-out infinite;">üßπ</div>
                <div style="font-size: 18px; font-weight: bold;">Emptying Table...</div>
                <div style="font-size: 14px; margin-top: 8px; opacity: 0.9;">${tableName}</div>
                <div style="font-size: 12px; margin-top: 8px; opacity: 0.7;">Deleting ${currentRows.toLocaleString()} record(s)...</div>
                <style>
                    @keyframes sweep {
                        0%, 100% { transform: translateX(0); }
                        25% { transform: translateX(-10px); }
                        75% { transform: translateX(10px); }
                    }
                </style>
            `;
            document.body.appendChild(loadingDiv);

            try {
                // Use TRUNCATE TABLE (faster) or DELETE FROM
                console.log('Emptying table data:', tableName);
                
                // Try TRUNCATE first (faster and resets auto-increment)
                let sql = `TRUNCATE TABLE \`${tableName}\`;`;
                
                const result = await apiRequest('execute_sql', {
                    db_host: sourceConn.host,
                    db_name: sourceConn.dbName,
                    db_user: sourceConn.username,
                    db_pass: sourceConn.password,
                    db_port: sourceConn.port || '3306',
                    sql_query: sql
                });

                if (!result.success) {
                    // If TRUNCATE fails, try DELETE FROM
                    console.log('TRUNCATE failed, trying DELETE FROM...');
                    sql = `DELETE FROM \`${tableName}\`;`;
                    
                    const deleteResult = await apiRequest('execute_sql', {
                        db_host: sourceConn.host,
                        db_name: sourceConn.dbName,
                        db_user: sourceConn.username,
                        db_pass: sourceConn.password,
                        db_port: sourceConn.port || '3306',
                        sql_query: sql
                    });
                    
                    if (!deleteResult.success) {
                        throw new Error(deleteResult.message || 'Failed to empty table');
                    }
                }

                console.log('‚úÖ Table data emptied successfully');

                // Success!
                document.body.removeChild(loadingDiv);

                // Show success message
                const successDiv = document.createElement('div');
                successDiv.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; padding: 35px 55px; border-radius: 12px; border: 2px solid #fbbf24; z-index: 10000; text-align: center; box-shadow: 0 0 40px rgba(245, 158, 11, 0.7);';
                successDiv.innerHTML = `
                    <div style="font-size: 56px; margin-bottom: 15px;">‚úÖ</div>
                    <div style="font-size: 20px; margin-bottom: 10px; font-weight: bold;">Table Emptied!</div>
                    <div style="font-size: 14px; background: rgba(0,0,0,0.3); padding: 8px 14px; border-radius: 6px; display: inline-block;">
                        ${tableName}
                    </div>
                    <div style="font-size: 12px; opacity: 0.8; margin-top: 10px;">All ${currentRows.toLocaleString()} record(s) deleted</div>
                    <div style="font-size: 11px; opacity: 0.7; margin-top: 8px;">üìã Table structure preserved</div>
                `;
                document.body.appendChild(successDiv);

                setTimeout(() => {
                    document.body.removeChild(successDiv);
                }, 3000);

                // Refresh source tables to update row count
                await loadMigrationTables();

                console.log('‚úÖ Table emptying completed!');

            } catch (error) {
                console.error('‚ùå Empty error:', error);
                document.body.removeChild(loadingDiv);

                alert(`‚ùå Empty Failed!\n\n${error.message}`);
            }
        }

        // Delete table from source database
        async function deleteTableFromMigration(tableName) {
            if (!selectedDatabaseId) {
                alert('‚ùå No database selected');
                return;
            }

            console.log('=== DELETE TABLE ===');
            console.log('Table to delete:', tableName);

            const connId = selectedDatabaseId.replace('conn_', '');
            const connections = getHostingerConnections();
            const sourceConn = connections.find(c => c.id === connId);

            if (!sourceConn) {
                alert('‚ùå Connection not found');
                return;
            }

            // Confirmation
            if (!confirm(`üóëÔ∏è Delete Table: ${tableName}\n\n‚ö†Ô∏è This will PERMANENTLY delete this table and ALL its data!\n\nAre you absolutely sure?`)) {
                console.log('User cancelled delete');
                return;
            }

            // Double confirmation for safety
            if (!confirm(`‚ö†Ô∏è FINAL WARNING!\n\nDelete "${tableName}" permanently?\n\nThis action CANNOT be undone!`)) {
                console.log('User cancelled on second confirmation');
                return;
            }

            // Show loading
            const loadingDiv = document.createElement('div');
            loadingDiv.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(239, 68, 68, 0.95); color: white; padding: 30px 50px; border-radius: 12px; border: 2px solid #f87171; z-index: 10000; text-align: center; box-shadow: 0 0 40px rgba(239, 68, 68, 0.6);';
            loadingDiv.innerHTML = `
                <div style="font-size: 48px; margin-bottom: 15px; animation: shake 0.5s ease-in-out infinite;">üóëÔ∏è</div>
                <div style="font-size: 18px; font-weight: bold;">Deleting Table...</div>
                <div style="font-size: 14px; margin-top: 8px; opacity: 0.9;">${tableName}</div>
                <style>
                    @keyframes shake {
                        0%, 100% { transform: translateX(0); }
                        25% { transform: translateX(-5px); }
                        75% { transform: translateX(5px); }
                    }
                </style>
            `;
            document.body.appendChild(loadingDiv);

            try {
                // Delete table
                console.log('Deleting table:', tableName);
                const deleteResult = await apiRequest('delete_table', {
                    db_host: sourceConn.host,
                    db_name: sourceConn.dbName,
                    db_user: sourceConn.username,
                    db_pass: sourceConn.password,
                    db_port: sourceConn.port || '3306',
                    table_name: tableName
                });

                if (!deleteResult.success) {
                    throw new Error(deleteResult.message || 'Failed to delete table');
                }

                console.log('‚úÖ Table deleted successfully');

                // Success!
                document.body.removeChild(loadingDiv);

                // Show success message
                const successDiv = document.createElement('div');
                successDiv.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; padding: 35px 55px; border-radius: 12px; border: 2px solid #f87171; z-index: 10000; text-align: center; box-shadow: 0 0 40px rgba(239, 68, 68, 0.7);';
                successDiv.innerHTML = `
                    <div style="font-size: 56px; margin-bottom: 15px;">‚úÖ</div>
                    <div style="font-size: 20px; margin-bottom: 10px; font-weight: bold;">Table Deleted!</div>
                    <div style="font-size: 14px; background: rgba(0,0,0,0.3); padding: 8px 14px; border-radius: 6px; display: inline-block;">
                        ${tableName}
                    </div>
                    <div style="font-size: 12px; opacity: 0.8; margin-top: 10px;">Table and all data permanently removed</div>
                `;
                document.body.appendChild(successDiv);

                setTimeout(() => {
                    document.body.removeChild(successDiv);
                }, 3000);

                // Refresh source tables
                await loadMigrationTables();

                console.log('‚úÖ Table deletion completed!');

            } catch (error) {
                console.error('‚ùå Delete error:', error);
                document.body.removeChild(loadingDiv);

                alert(`‚ùå Deletion Failed!\n\n${error.message}`);
            }
        }

        // Duplicate table in source database
        async function duplicateTable(tableName) {
            if (!selectedDatabaseId) {
                alert('‚ùå No database selected');
                return;
            }

            console.log('=== DUPLICATE TABLE ===');
            console.log('Original table:', tableName);

            const connId = selectedDatabaseId.replace('conn_', '');
            const connections = getHostingerConnections();
            const sourceConn = connections.find(c => c.id === connId);

            if (!sourceConn) {
                alert('‚ùå Connection not found');
                return;
            }

            // Prompt for new table name
            const newName = prompt(`üìã Duplicate Table: ${tableName}\n\nEnter name for the copy:`, `${tableName}_copy`);
            
            if (!newName) {
                console.log('User cancelled duplicate');
                return;
            }

            if (newName === tableName) {
                alert('‚ùå New name must be different from original table!');
                return;
            }

            // Check if new name already exists
            if (migrationTables.includes(newName)) {
                if (!confirm(`‚ö†Ô∏è Table "${newName}" already exists!\n\nOverwrite it?`)) {
                    return;
                }
            }

            // Show loading
            const loadingDiv = document.createElement('div');
            loadingDiv.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(139, 92, 246, 0.95); color: white; padding: 30px 50px; border-radius: 12px; border: 2px solid #a78bfa; z-index: 10000; text-align: center; box-shadow: 0 0 40px rgba(139, 92, 246, 0.6);';
            loadingDiv.innerHTML = `
                <div style="font-size: 48px; margin-bottom: 15px; animation: spin 1.5s linear infinite;">üìã</div>
                <div style="font-size: 18px; font-weight: bold;">Duplicating Table...</div>
                <div style="font-size: 14px; margin-top: 8px; opacity: 0.9;">${tableName} ‚Üí ${newName}</div>
                <style>@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }</style>
            `;
            document.body.appendChild(loadingDiv);

            try {
                // Step 1: Generate SQL with data
                console.log('Step 1: Generating SQL with data for:', tableName);
                const sqlResult = await apiRequest('generate_table_sql', {
                    db_host: sourceConn.host,
                    db_name: sourceConn.dbName,
                    db_user: sourceConn.username,
                    db_pass: sourceConn.password,
                    db_port: sourceConn.port || '3306',
                    table_name: tableName,
                    include_data: 'true'
                });

                if (!sqlResult.success || !sqlResult.sql) {
                    throw new Error(sqlResult.message || 'Failed to generate SQL');
                }

                console.log(`‚úÖ SQL generated (${sqlResult.row_count || 0} rows)`);

                // Step 2: Modify SQL to use new table name
                let modifiedSQL = sqlResult.sql;
                
                // Replace table name in all occurrences
                modifiedSQL = modifiedSQL.replace(new RegExp(`\`${tableName}\``, 'g'), `\`${newName}\``);
                modifiedSQL = modifiedSQL.replace(new RegExp(`DROP TABLE IF EXISTS \`${tableName}\``, 'g'), `DROP TABLE IF EXISTS \`${newName}\``);
                
                console.log('‚úÖ SQL modified for new table name:', newName);

                // Step 3: Execute SQL in same database
                console.log('Step 3: Creating duplicate table:', newName);
                
                // Split and execute statements
                const statements = modifiedSQL.split(/;\s*\n/).filter(s => {
                    const trimmed = s.trim();
                    return trimmed.length > 0 && !trimmed.startsWith('--');
                });

                console.log(`Found ${statements.length} statements to execute`);

                for (const statement of statements) {
                    const trimmed = statement.trim();
                    if (!trimmed) continue;

                    const execResult = await apiRequest('execute_sql', {
                        db_host: sourceConn.host,
                        db_name: sourceConn.dbName,
                        db_user: sourceConn.username,
                        db_pass: sourceConn.password,
                        db_port: sourceConn.port || '3306',
                        sql_query: trimmed.endsWith(';') ? trimmed : trimmed + ';'
                    });

                    if (!execResult.success) {
                        console.error('Statement failed:', execResult.message);
                    }
                }

                // Success!
                document.body.removeChild(loadingDiv);

                // Show success message
                const successDiv = document.createElement('div');
                successDiv.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%); color: white; padding: 35px 55px; border-radius: 12px; border: 2px solid #a78bfa; z-index: 10000; text-align: center; box-shadow: 0 0 40px rgba(139, 92, 246, 0.7);';
                successDiv.innerHTML = `
                    <div style="font-size: 56px; margin-bottom: 15px;">‚úÖ</div>
                    <div style="font-size: 20px; margin-bottom: 10px; font-weight: bold;">Table Duplicated!</div>
                    <div style="font-size: 14px; background: rgba(0,0,0,0.2); padding: 8px 14px; border-radius: 6px; display: inline-block;">
                        ${tableName} ‚Üí ${newName}
                    </div>
                    ${sqlResult.row_count > 0 ? `<div style="font-size: 12px; opacity: 0.8; margin-top: 10px;">üìä ${sqlResult.row_count.toLocaleString()} record(s) copied</div>` : ''}
                `;
                document.body.appendChild(successDiv);

                setTimeout(() => {
                    document.body.removeChild(successDiv);
                }, 3000);

                // Refresh source tables to show the duplicate
                await loadMigrationTables();

                console.log('‚úÖ Table duplicated successfully!');

            } catch (error) {
                console.error('‚ùå Duplicate error:', error);
                document.body.removeChild(loadingDiv);

                alert(`‚ùå Duplication Failed!\n\n${error.message}`);
            }
        }


        // Start table migration
        function startTableMigration() {
            if (!selectedDatabaseId) {
                alert('‚ö†Ô∏è Please select a source database first!');
                return;
            }

            if (!selectedDestinationId) {
                alert('‚ö†Ô∏è Please select a destination database!');
                return;
            }

            if (selectedMigrationTables.size === 0) {
                alert('‚ö†Ô∏è Please select at least one table to migrate!');
                return;
            }

            // TODO: Implement migration logic
            const selectedTablesList = Array.from(selectedMigrationTables).join(', ');
            console.log('Starting migration...', {
                source: selectedDatabaseId,
                destination: selectedDestinationId,
                tables: selectedTablesList,
                count: selectedMigrationTables.size
            });

            alert(`üöÄ Migration Ready!\n\nüì§ Source: ${selectedDatabaseId}\nüì• Destination: ${selectedDestinationId}\nüìä Tables: ${selectedMigrationTables.size}\n\n‚úì Feature will be implemented next!`);
        }

        // ========================================
        // Drag and Drop Functions
        // ========================================
        
        let draggedTableName = null;
        let draggedElement = null;
        let dragIncludeData = false; // Track if dragging with data or structure only

        // Handle drag start
        function handleDragStart(event, tableName, includeData = false) {
            console.log('=== DRAG START ===');
            console.log('Table:', tableName);
            console.log('Include Data:', includeData);
            
            draggedTableName = tableName;
            draggedElement = event.target;
            dragIncludeData = includeData; // Store whether to include data
            
            // Store in event.target as well for persistence
            event.target.setAttribute('data-include-data', includeData ? 'true' : 'false');
            
            console.log('‚úÖ Set dragIncludeData to:', dragIncludeData);
            console.log('‚úÖ Set data-include-data attribute to:', includeData ? 'true' : 'false');
            
            event.target.classList.add('dragging');
            event.dataTransfer.effectAllowed = 'move';
            event.dataTransfer.setData('text/plain', JSON.stringify({
                table: tableName,
                includeData: includeData
            }));
            
            // Also set a simple text for debugging
            event.dataTransfer.setData('application/x-include-data', includeData ? 'true' : 'false');
            
            // Create custom drag image (ghost element)
            const dragImage = event.target.cloneNode(true);
            dragImage.style.cssText = `
                position: absolute;
                top: -1000px;
                transform: rotate(5deg) scale(1.1);
                opacity: 0.9;
                box-shadow: 0 15px 40px rgba(251, 191, 36, 0.6);
                border-color: #fbbf24;
            `;
            document.body.appendChild(dragImage);
            event.dataTransfer.setDragImage(dragImage, 60, 30);
            setTimeout(() => document.body.removeChild(dragImage), 0);
            
            // Visual feedback
            console.log('üñ±Ô∏è Started dragging table:', tableName);
            
            // Show hint message with mode indicator
            const hint = document.createElement('div');
            hint.id = 'dragHint';
            const bgColor = includeData ? 'rgba(16, 185, 129, 0.95)' : 'rgba(251, 191, 36, 0.95)';
            const modeText = includeData ? 'üì¶ Structure + Data' : 'üèóÔ∏è Structure Only';
            const modeColor = 'white';
            const borderColor = includeData ? '#22c55e' : '#fbbf24';
            
            hint.style.cssText = `position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: ${bgColor}; color: ${modeColor}; padding: 12px 25px; border-radius: 10px; font-size: 14px; font-weight: bold; z-index: 9999; box-shadow: 0 5px 20px rgba(0,0,0,0.5); border: 2px solid ${borderColor}; animation: slideDown 0.3s ease-out;`;
            hint.innerHTML = `üñ±Ô∏è Dragging: <strong>${tableName}</strong><br><span style="font-size: 12px; opacity: 0.9;">${modeText}</span>`;
            hint.innerHTML += '<style>@keyframes slideDown { from { top: -50px; opacity: 0; } to { top: 20px; opacity: 1; } }</style>';
            document.body.appendChild(hint);
        }

        // Handle drag end
        function handleDragEnd(event) {
            event.target.classList.remove('dragging');
            
            // Remove hint message
            const hint = document.getElementById('dragHint');
            if (hint) {
                hint.style.animation = 'slideUp 0.3s ease-out forwards';
                hint.innerHTML += '<style>@keyframes slideUp { from { top: 20px; opacity: 1; } to { top: -50px; opacity: 0; } }</style>';
                setTimeout(() => {
                    if (hint.parentNode) {
                        document.body.removeChild(hint);
                    }
                }, 300);
            }
            
            console.log('üñ±Ô∏è Finished dragging');
        }

        // Handle drag over (allow drop)
        function handleDragOver(event) {
            if (!selectedDestinationId) {
                event.dataTransfer.dropEffect = 'none';
                return;
            }

            event.preventDefault(); // Must prevent default to allow drop
            event.dataTransfer.dropEffect = 'move';
            
            // Add visual feedback
            const dropZone = document.getElementById('migrationDestinationTablesContainer');
            if (dropZone && !dropZone.classList.contains('drag-over')) {
                dropZone.classList.add('drag-over');
            }
        }

        // Handle drag leave
        function handleDragLeave(event) {
            // Only remove class if leaving the drop zone itself, not child elements
            if (event.target.id === 'migrationDestinationTablesContainer') {
                event.target.classList.remove('drag-over');
            }
        }

        // Handle drop
        async function handleDrop(event) {
            event.preventDefault();
            
            const dropZone = document.getElementById('migrationDestinationTablesContainer');
            if (dropZone) {
                dropZone.classList.remove('drag-over');
            }

            if (!draggedTableName) {
                console.error('‚ùå No table being dragged');
                return;
            }

            if (!selectedDestinationId) {
                alert('‚ö†Ô∏è Please select a destination database first!');
                return;
            }

            console.log('üì• Dropped table:', draggedTableName);

            // Show loading indicator immediately (no confirmation for better UX)
            const loadingDiv = document.createElement('div');
            loadingDiv.id = 'dragMigrationLoading';
            loadingDiv.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: linear-gradient(135deg, rgba(0, 0, 0, 0.95) 0%, rgba(34, 197, 94, 0.2) 100%); color: #22c55e; padding: 40px 60px; border-radius: 15px; border: 3px solid #22c55e; z-index: 10000; text-align: center; box-shadow: 0 0 50px rgba(34, 197, 94, 0.5); animation: fadeInScale 0.3s ease-out;';
            loadingDiv.innerHTML = `
                <div style="font-size: 56px; margin-bottom: 20px; animation: spin 2s linear infinite;">üîÑ</div>
                <div style="font-size: 20px; margin-bottom: 12px; font-weight: bold;">Moving Table...</div>
                <div style="font-size: 16px; opacity: 0.8; color: #fbbf24;">${draggedTableName}</div>
                <div style="font-size: 12px; opacity: 0.6; margin-top: 15px;">From Source ‚Üí To Destination</div>
                <style>
                    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
                </style>
            `;
            document.body.appendChild(loadingDiv);

            try {
                // Get source connection
                const allConnections = getHostingerConnections();
                const sourceId = selectedDatabaseId.replace('conn_', '');
                const sourceConn = allConnections.find(c => c.id === sourceId);
                const destConn = allConnections.find(c => c.id === selectedDestinationId);

                console.log('üîç Debug Info:', {
                    selectedDatabaseId,
                    sourceId,
                    selectedDestinationId,
                    allConnectionsCount: allConnections.length,
                    sourceConn: sourceConn ? 'Found' : 'NOT FOUND',
                    destConn: destConn ? 'Found' : 'NOT FOUND'
                });

                if (!sourceConn) {
                    throw new Error('Source connection not found. Selected ID: ' + sourceId);
                }

                if (!destConn) {
                    throw new Error('Destination connection not found. Selected ID: ' + selectedDestinationId);
                }

                console.log('üìã Source Connection:', {
                    host: sourceConn.host,
                    dbName: sourceConn.dbName,
                    user: sourceConn.username,
                    port: sourceConn.port
                });

                console.log('üì• Destination Connection:', {
                    host: destConn.host,
                    dbName: destConn.dbName,
                    user: destConn.username,
                    port: destConn.port
                });

                // Step 1: Get table structure (with or without data based on drag mode)
                console.log('=== INSIDE handleDrop ===');
                console.log('üîç Current dragIncludeData value:', dragIncludeData);
                console.log('üîç Type of dragIncludeData:', typeof dragIncludeData);
                
                // Force to true for testing - REMOVE THIS AFTER DEBUGGING
                // dragIncludeData = true;
                
                const includeDataMode = dragIncludeData ? 'true' : 'false';
                const modeText = dragIncludeData ? 'structure & data' : 'structure only';
                
                console.log(`üìã Step 1: Generating SQL for table (${modeText}):`, draggedTableName);
                console.log(`üìä include_data parameter will be:`, includeDataMode);
                console.log(`üìä Will send to Backend: include_data = "${includeDataMode}"`);
                
                loadingDiv.querySelector('div:nth-child(2)').textContent = `Step 1: Copying table ${modeText}...`;
                
                const sqlRequestData = {
                    db_host: sourceConn.host,
                    db_name: sourceConn.dbName,
                    db_user: sourceConn.username,
                    db_pass: sourceConn.password,
                    db_port: sourceConn.port || '3306',
                    table_name: draggedTableName,
                    include_data: includeDataMode
                };

                console.log('üì§ Sending SQL generation request:', {
                    ...sqlRequestData,
                    db_pass: '***hidden***',
                    include_data: includeDataMode  // Show this clearly
                });

                const sqlResult = await apiRequest('generate_table_sql', sqlRequestData);

                console.log('üì• SQL generation result:', {
                    success: sqlResult.success,
                    message: sqlResult.message,
                    hasSql: !!sqlResult.sql,
                    hasData: sqlResult.has_data,
                    rowCount: sqlResult.row_count,
                    sqlLength: sqlResult.sql_length
                });

                console.log('üîç VERIFICATION:');
                console.log('  - Requested include_data:', includeDataMode);
                console.log('  - Backend returned has_data:', sqlResult.has_data);
                console.log('  - Backend returned row_count:', sqlResult.row_count);

                if (!sqlResult.success || !sqlResult.sql) {
                    throw new Error(sqlResult.message || 'Failed to generate SQL');
                }

                // Verify data was included
                if (dragIncludeData && sqlResult.row_count === 0) {
                    console.warn('‚ö†Ô∏è Warning: Data requested but table appears to be empty (0 rows)');
                    // Show alert for debugging
                    if (confirm('‚ö†Ô∏è Table appears to be EMPTY (0 rows).\n\nContinue with structure only?')) {
                        console.log('User chose to continue with structure only');
                    } else {
                        throw new Error('Migration cancelled - table is empty');
                    }
                } else if (dragIncludeData && sqlResult.row_count > 0) {
                    console.log(`‚úÖ Confirmed: SQL includes ${sqlResult.row_count} rows of data`);
                    console.log(`‚úÖ SQL length: ${sqlResult.sql_length} bytes`);
                } else if (!dragIncludeData) {
                    console.log('‚úÖ Structure only mode - no data included (as intended)');
                }
                
                // Additional check - does SQL contain INSERT?
                const hasInsertStatements = sqlResult.sql.includes('INSERT INTO');
                console.log('üîç SQL contains INSERT statements:', hasInsertStatements);
                
                if (dragIncludeData && !hasInsertStatements) {
                    console.error('‚ùå ERROR: Data was requested but SQL has NO INSERT statements!');
                    console.error('This means Backend did not include data even though include_data=true was sent');
                }

                // Step 2: Execute SQL on destination
                console.log('üì• Step 2: Executing SQL on destination database');
                loadingDiv.querySelector('div:nth-child(2)').textContent = 'Step 2: Creating table in destination...';
                
                // Split SQL into individual statements (DROP, CREATE, INSERT)
                const sqlStatements = sqlResult.sql.split(/;\s*\n/).filter(s => {
                    const trimmed = s.trim();
                    return trimmed.length > 0 && 
                           !trimmed.startsWith('--') &&
                           !trimmed.match(/^--/);
                });

                console.log(`Found ${sqlStatements.length} SQL statements to execute`);

                // Execute each statement individually
                let executedStatements = 0;
                for (let i = 0; i < sqlStatements.length; i++) {
                    const statement = sqlStatements[i].trim();
                    if (!statement) continue;

                    const finalStatement = statement.endsWith(';') ? statement : statement + ';';
                    
                    console.log(`Executing statement ${i + 1}/${sqlStatements.length}...`);

                    const executeResult = await apiRequest('execute_sql', {
                        db_host: destConn.host,
                        db_name: destConn.dbName,
                        db_user: destConn.username,
                        db_pass: destConn.password,
                        db_port: destConn.port || '3306',
                        sql_query: finalStatement
                    });

                    if (!executeResult.success) {
                        console.error(`Statement ${i + 1} failed:`, executeResult.message);
                        // Continue with other statements, log but don't fail completely
                    } else {
                        executedStatements++;
                        console.log(`‚úÖ Statement ${i + 1} executed successfully`);
                    }
                }

                if (executedStatements === 0) {
                    throw new Error('All SQL statements failed to execute');
                }

                console.log(`‚úÖ Successfully executed ${executedStatements}/${sqlStatements.length} statements`);

                // Step 3: Delete table from source
                console.log('üóëÔ∏è Step 3: Deleting table from source database');
                loadingDiv.querySelector('div:nth-child(2)').textContent = 'Step 3: Removing from source...';
                
                const deleteRequestData = {
                    db_host: sourceConn.host,
                    db_name: sourceConn.dbName,
                    db_user: sourceConn.username,
                    db_pass: sourceConn.password,
                    db_port: sourceConn.port || '3306',
                    table_name: draggedTableName
                };

                console.log('üì§ Sending delete table request');

                const deleteResult = await apiRequest('delete_table', deleteRequestData);

                console.log('üì• Delete table result:', {
                    success: deleteResult.success,
                    message: deleteResult.message
                });

                if (!deleteResult.success) {
                    console.warn('‚ö†Ô∏è Warning: Table copied but not deleted from source:', deleteResult.message);
                }

                // Success!
                document.body.removeChild(loadingDiv);
                
                // Show success message with animation
                const successDiv = document.createElement('div');
                const modeIcon = dragIncludeData ? 'üì¶' : 'üèóÔ∏è';
                const modeLabel = dragIncludeData ? 'Structure + Data' : 'Structure Only';
                const modeColor = dragIncludeData ? '#22c55e' : '#fbbf24';
                const recordsInfo = (dragIncludeData && sqlResult.row_count > 0) 
                    ? `<div style="font-size: 12px; opacity: 0.8; margin-top: 8px;">üìä ${sqlResult.row_count.toLocaleString()} record(s) copied</div>` 
                    : '';
                
                successDiv.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: linear-gradient(135deg, rgba(34, 197, 94, 0.98) 0%, rgba(16, 185, 129, 0.98) 100%); color: white; padding: 40px 60px; border-radius: 15px; border: 3px solid #86efac; z-index: 10000; text-align: center; box-shadow: 0 0 50px rgba(34, 197, 94, 0.7); animation: bounceIn 0.5s ease-out;';
                successDiv.innerHTML = `
                    <div style="font-size: 64px; margin-bottom: 20px;">‚úÖ</div>
                    <div style="font-size: 22px; margin-bottom: 12px; font-weight: bold;">Table Moved Successfully!</div>
                    <div style="font-size: 16px; opacity: 0.95; background: rgba(255,255,255,0.2); padding: 8px 16px; border-radius: 8px; display: inline-block;">${draggedTableName}</div>
                    <div style="font-size: 13px; opacity: 0.9; margin-top: 10px; background: rgba(0,0,0,0.3); padding: 8px 14px; border-radius: 6px; display: inline-block; border: 1px solid ${modeColor};">
                        <span style="color: ${modeColor}; font-size: 16px;">${modeIcon}</span> <strong>${modeLabel}</strong>
                    </div>
                    ${recordsInfo}
                    <div style="font-size: 13px; opacity: 0.8; margin-top: 15px;">üì§ Removed from source ‚Ä¢ üì• Added to destination</div>
                    <style>
                        @keyframes bounceIn {
                            0% { transform: translate(-50%, -50%) scale(0.3); opacity: 0; }
                            50% { transform: translate(-50%, -50%) scale(1.05); }
                            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
                        }
                    </style>
                `;
                document.body.appendChild(successDiv);

                setTimeout(() => {
                    document.body.removeChild(successDiv);
                }, 3000);

                // Refresh both source and destination tables
                // Note: loadMigrationTables() will preserve destination dropdown selection
                await loadMigrationTables();
                
                // Only reload destination if it's still selected
                if (selectedDestinationId) {
                    await loadDestinationTables();
                }

                console.log('‚úÖ Migration completed successfully!');

            } catch (error) {
                console.error('‚ùå Migration error:', error);
                console.error('‚ùå Full error details:', {
                    message: error.message,
                    stack: error.stack,
                    error: error
                });
                
                // Remove loading indicator
                const loading = document.getElementById('dragMigrationLoading');
                if (loading && loading.parentNode) {
                    document.body.removeChild(loading);
                }

                // Show detailed error message
                const errorDiv = document.createElement('div');
                errorDiv.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(239, 68, 68, 0.98); color: white; padding: 40px 60px; border-radius: 15px; border: 3px solid #fca5a5; z-index: 10000; text-align: center; box-shadow: 0 0 50px rgba(239, 68, 68, 0.7); max-width: 600px;';
                errorDiv.innerHTML = `
                    <div style="font-size: 64px; margin-bottom: 20px;">‚ùå</div>
                    <div style="font-size: 22px; margin-bottom: 15px; font-weight: bold;">Migration Failed!</div>
                    <div style="font-size: 14px; opacity: 0.95; background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; text-align: left; margin: 15px 0;">
                        <strong>Error:</strong><br>
                        ${error.message || error}
                    </div>
                    <div style="font-size: 12px; opacity: 0.8; margin-top: 15px;">Check browser console (F12) for more details</div>
                    <button onclick="this.parentElement.remove()" style="margin-top: 20px; padding: 10px 25px; background: white; color: #dc2626; border: none; border-radius: 8px; font-size: 14px; font-weight: bold; cursor: pointer;">Close</button>
                `;
                document.body.appendChild(errorDiv);

                // Auto-remove after 10 seconds
                setTimeout(() => {
                    if (errorDiv.parentNode) {
                        document.body.removeChild(errorDiv);
                    }
                }, 10000);
            } finally {
                draggedTableName = null;
            }
        }

        // Load table templates
        function loadTemplates() {
            const templates = [
                { name: 'Users', icon: 'üë§', desc: 'User accounts', columns: [
                    { name: 'id', type: 'INT', length: '11', nullable: 'no', autoIncrement: 'yes', primaryKey: 'yes' },
                    { name: 'username', type: 'VARCHAR', length: '50', nullable: 'no', unique: 'yes' },
                    { name: 'email', type: 'VARCHAR', length: '100', nullable: 'no', unique: 'yes' },
                    { name: 'password', type: 'VARCHAR', length: '255', nullable: 'no' },
                    { name: 'created_at', type: 'TIMESTAMP', defaultValue: 'CURRENT_TIMESTAMP', nullable: 'no' }
                ]},
                { name: 'Products', icon: 'üì¶', desc: 'Product catalog', columns: [
                    { name: 'id', type: 'INT', length: '11', nullable: 'no', autoIncrement: 'yes', primaryKey: 'yes' },
                    { name: 'name', type: 'VARCHAR', length: '200', nullable: 'no' },
                    { name: 'description', type: 'TEXT', nullable: 'yes' },
                    { name: 'price', type: 'DECIMAL', length: '10,2', nullable: 'no' },
                    { name: 'stock', type: 'INT', length: '11', nullable: 'no', defaultValue: '0' },
                    { name: 'created_at', type: 'TIMESTAMP', defaultValue: 'CURRENT_TIMESTAMP', nullable: 'no' }
                ]},
                { name: 'Blog Posts', icon: 'üìù', desc: 'Blog articles', columns: [
                    { name: 'id', type: 'INT', length: '11', nullable: 'no', autoIncrement: 'yes', primaryKey: 'yes' },
                    { name: 'title', type: 'VARCHAR', length: '255', nullable: 'no' },
                    { name: 'slug', type: 'VARCHAR', length: '255', nullable: 'no', unique: 'yes' },
                    { name: 'content', type: 'TEXT', nullable: 'no' },
                    { name: 'author_id', type: 'INT', length: '11', nullable: 'no' },
                    { name: 'published_at', type: 'DATETIME', nullable: 'yes' },
                    { name: 'created_at', type: 'TIMESTAMP', defaultValue: 'CURRENT_TIMESTAMP', nullable: 'no' }
                ]},
                { name: 'Orders', icon: 'üõí', desc: 'Customer orders', columns: [
                    { name: 'id', type: 'INT', length: '11', nullable: 'no', autoIncrement: 'yes', primaryKey: 'yes' },
                    { name: 'user_id', type: 'INT', length: '11', nullable: 'no' },
                    { name: 'total_amount', type: 'DECIMAL', length: '10,2', nullable: 'no' },
                    { name: 'status', type: 'VARCHAR', length: '50', nullable: 'no', defaultValue: 'pending' },
                    { name: 'created_at', type: 'TIMESTAMP', defaultValue: 'CURRENT_TIMESTAMP', nullable: 'no' }
                ]},
                { name: 'Categories', icon: 'üìÅ', desc: 'Content categories', columns: [
                    { name: 'id', type: 'INT', length: '11', nullable: 'no', autoIncrement: 'yes', primaryKey: 'yes' },
                    { name: 'name', type: 'VARCHAR', length: '100', nullable: 'no' },
                    { name: 'slug', type: 'VARCHAR', length: '100', nullable: 'no', unique: 'yes' },
                    { name: 'parent_id', type: 'INT', length: '11', nullable: 'yes' },
                    { name: 'created_at', type: 'TIMESTAMP', defaultValue: 'CURRENT_TIMESTAMP', nullable: 'no' }
                ]},
                { name: 'Comments', icon: 'üí¨', desc: 'User comments', columns: [
                    { name: 'id', type: 'INT', length: '11', nullable: 'no', autoIncrement: 'yes', primaryKey: 'yes' },
                    { name: 'user_id', type: 'INT', length: '11', nullable: 'no' },
                    { name: 'post_id', type: 'INT', length: '11', nullable: 'no' },
                    { name: 'content', type: 'TEXT', nullable: 'no' },
                    { name: 'created_at', type: 'TIMESTAMP', defaultValue: 'CURRENT_TIMESTAMP', nullable: 'no' }
                ]},
                { name: 'Media', icon: 'üñºÔ∏è', desc: 'Media files', columns: [
                    { name: 'id', type: 'INT', length: '11', nullable: 'no', autoIncrement: 'yes', primaryKey: 'yes' },
                    { name: 'filename', type: 'VARCHAR', length: '255', nullable: 'no' },
                    { name: 'filepath', type: 'VARCHAR', length: '500', nullable: 'no' },
                    { name: 'filetype', type: 'VARCHAR', length: '50', nullable: 'no' },
                    { name: 'filesize', type: 'INT', length: '11', nullable: 'no' },
                    { name: 'uploaded_at', type: 'TIMESTAMP', defaultValue: 'CURRENT_TIMESTAMP', nullable: 'no' }
                ]},
                { name: 'Settings', icon: '‚öôÔ∏è', desc: 'App settings', columns: [
                    { name: 'id', type: 'INT', length: '11', nullable: 'no', autoIncrement: 'yes', primaryKey: 'yes' },
                    { name: 'key', type: 'VARCHAR', length: '100', nullable: 'no', unique: 'yes' },
                    { name: 'value', type: 'TEXT', nullable: 'yes' },
                    { name: 'updated_at', type: 'TIMESTAMP', defaultValue: 'CURRENT_TIMESTAMP', nullable: 'no' }
                ]},
                { name: 'Logs', icon: 'üìã', desc: 'Activity logs', columns: [
                    { name: 'id', type: 'INT', length: '11', nullable: 'no', autoIncrement: 'yes', primaryKey: 'yes' },
                    { name: 'user_id', type: 'INT', length: '11', nullable: 'yes' },
                    { name: 'action', type: 'VARCHAR', length: '100', nullable: 'no' },
                    { name: 'description', type: 'TEXT', nullable: 'yes' },
                    { name: 'ip_address', type: 'VARCHAR', length: '45', nullable: 'yes' },
                    { name: 'created_at', type: 'TIMESTAMP', defaultValue: 'CURRENT_TIMESTAMP', nullable: 'no' }
                ]},
                { name: 'Sessions', icon: 'üîê', desc: 'User sessions', columns: [
                    { name: 'id', type: 'INT', length: '11', nullable: 'no', autoIncrement: 'yes', primaryKey: 'yes' },
                    { name: 'user_id', type: 'INT', length: '11', nullable: 'no' },
                    { name: 'token', type: 'VARCHAR', length: '255', nullable: 'no', unique: 'yes' },
                    { name: 'ip_address', type: 'VARCHAR', length: '45', nullable: 'yes' },
                    { name: 'user_agent', type: 'TEXT', nullable: 'yes' },
                    { name: 'expires_at', type: 'DATETIME', nullable: 'no' },
                    { name: 'created_at', type: 'TIMESTAMP', defaultValue: 'CURRENT_TIMESTAMP', nullable: 'no' }
                ]}
            ];

            const grid = document.getElementById('templateGrid');
            grid.innerHTML = templates.map(t => `
                <div class="template-card" onclick="selectTemplate('${t.name}')">
                    <div class="template-icon">${t.icon}</div>
                    <div class="template-name">${t.name}</div>
                    <div class="template-desc">${t.desc}</div>
                </div>
            `).join('');

            window.tableTemplates = templates;
        }

        // Suggested names for each template
        const templateSuggestedNames = {
            'Users': ['users', 'my_users', 'customers', 'members', 'accounts', 'profiles', 'user_accounts'],
            'Products': ['products', 'items', 'catalog', 'inventory', 'goods', 'articles', 'merchandise'],
            'Blog Posts': ['posts', 'blog_posts', 'articles', 'content', 'publications', 'entries'],
            'Orders': ['orders', 'purchases', 'transactions', 'sales', 'checkouts', 'invoices'],
            'Categories': ['categories', 'types', 'groups', 'sections', 'tags', 'classifications'],
            'Comments': ['comments', 'reviews', 'feedback', 'replies', 'notes', 'discussions'],
            'Media': ['media', 'files', 'uploads', 'attachments', 'images', 'documents', 'assets'],
            'Settings': ['settings', 'config', 'preferences', 'options', 'configuration'],
            'Logs': ['logs', 'activity_logs', 'audit_logs', 'system_logs', 'event_logs'],
            'Sessions': ['sessions', 'user_sessions', 'auth_sessions', 'login_sessions']
        };

        // Select template
        function selectTemplate(templateName) {
            selectedTemplate = window.tableTemplates.find(t => t.name === templateName);
            
            // Update UI
            document.querySelectorAll('.template-card').forEach(card => card.classList.remove('selected'));
            event.target.closest('.template-card').classList.add('selected');
            
            // Show template name section
            document.getElementById('templateNameSection').style.display = 'block';
            
            // Populate suggested names
            const suggestedSelect = document.getElementById('templateSuggestedNames');
            suggestedSelect.innerHTML = '<option value="">-- Choose Suggested Name --</option>';
            
            const suggestions = templateSuggestedNames[templateName] || [];
            suggestions.forEach(name => {
                suggestedSelect.innerHTML += `<option value="${name}">${name}</option>`;
            });
            
            // Auto-fill first suggestion in input placeholder
            const firstSuggestion = suggestions[0] || templateName.toLowerCase().replace(/\s+/g, '_');
            document.getElementById('templateTableName').placeholder = `e.g., ${firstSuggestion}`;
            
            // Show template columns
            const container = document.getElementById('templateColumns');
            container.innerHTML = '';
            
            selectedTemplate.columns.forEach((col, index) => {
                container.innerHTML += createColumnRow(col, index, true);
            });
            
            document.getElementById('templateColumnBuilder').style.display = 'block';
        }

        // Use suggested name
        function useSuggestedName() {
            const select = document.getElementById('templateSuggestedNames');
            const input = document.getElementById('templateTableName');
            
            if (select.value) {
                input.value = select.value;
                input.focus();
            }
        }

        // Clear template name
        function clearTemplateName() {
            document.getElementById('templateTableName').value = '';
            document.getElementById('templateSuggestedNames').value = '';
            document.getElementById('templateTableName').focus();
        }

        // Create column row HTML
        function createColumnRow(col = {}, index = columnCounter++, isTemplate = false) {
            const prefix = isTemplate ? 'template' : 'col';
            const id = `${prefix}_${index}`;
            
            return `
                <div class="column-row" id="${id}">
                    <div class="form-group" style="margin: 0;">
                        <input type="text" class="form-input col-name" placeholder="Column name" value="${col.name || ''}" required>
                    </div>
                    <div class="form-group" style="margin: 0;">
                        <select class="form-select col-type">
                            <option value="INT" ${col.type === 'INT' ? 'selected' : ''}>INT</option>
                            <option value="VARCHAR" ${col.type === 'VARCHAR' ? 'selected' : ''}>VARCHAR</option>
                            <option value="TEXT" ${col.type === 'TEXT' ? 'selected' : ''}>TEXT</option>
                            <option value="DATE" ${col.type === 'DATE' ? 'selected' : ''}>DATE</option>
                            <option value="DATETIME" ${col.type === 'DATETIME' ? 'selected' : ''}>DATETIME</option>
                            <option value="TIMESTAMP" ${col.type === 'TIMESTAMP' ? 'selected' : ''}>TIMESTAMP</option>
                            <option value="BOOLEAN" ${col.type === 'BOOLEAN' ? 'selected' : ''}>BOOLEAN</option>
                            <option value="DECIMAL" ${col.type === 'DECIMAL' ? 'selected' : ''}>DECIMAL</option>
                            <option value="FLOAT" ${col.type === 'FLOAT' ? 'selected' : ''}>FLOAT</option>
                            <option value="DOUBLE" ${col.type === 'DOUBLE' ? 'selected' : ''}>DOUBLE</option>
                            <option value="BLOB" ${col.type === 'BLOB' ? 'selected' : ''}>BLOB</option>
                        </select>
                    </div>
                    <div class="form-group" style="margin: 0;">
                        <input type="text" class="form-input col-length" placeholder="Length" value="${col.length || ''}">
                    </div>
                    <div class="form-group" style="margin: 0;">
                        <select class="form-select col-nullable">
                            <option value="yes" ${col.nullable === 'yes' ? 'selected' : ''}>NULL</option>
                            <option value="no" ${col.nullable === 'no' ? 'selected' : ''}>NOT NULL</option>
                        </select>
                    </div>
                    <div class="form-group" style="margin: 0;">
                        <input type="text" class="form-input col-default" placeholder="Default" value="${col.defaultValue || ''}">
                    </div>
                    <button type="button" class="btn btn-danger btn-icon" onclick="removeColumnRow('${id}')">√ó</button>
                </div>
                <div class="column-options">
                    <div class="checkbox-group">
                        <input type="checkbox" id="${id}_auto" class="col-auto" ${col.autoIncrement === 'yes' ? 'checked' : ''}>
                        <label for="${id}_auto">Auto Increment</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="${id}_pk" class="col-pk" ${col.primaryKey === 'yes' ? 'checked' : ''}>
                        <label for="${id}_pk">Primary Key</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="${id}_unique" class="col-unique" ${col.unique === 'yes' ? 'checked' : ''}>
                        <label for="${id}_unique">Unique</label>
                    </div>
                </div>
            `;
        }

        // Add column row
        function addColumnRow() {
            const builder = document.getElementById('columnBuilder');
            const div = document.createElement('div');
            div.innerHTML = createColumnRow();
            builder.appendChild(div);
        }

        // Remove column row
        function removeColumnRow(id) {
            document.getElementById(id).nextElementSibling.remove();
            document.getElementById(id).remove();
        }

        // Get columns data from form
        function getColumnsData(containerId) {
            const container = document.getElementById(containerId);
            const rows = container.querySelectorAll('.column-row');
            const columns = [];
            
            rows.forEach(row => {
                const col = {
                    name: row.querySelector('.col-name').value.trim(),
                    type: row.querySelector('.col-type').value,
                    length: row.querySelector('.col-length').value.trim(),
                    nullable: row.querySelector('.col-nullable').value,
                    defaultValue: row.querySelector('.col-default').value.trim(),
                    autoIncrement: row.querySelector('.col-auto')?.checked ? 'yes' : 'no',
                    primaryKey: row.querySelector('.col-pk')?.checked ? 'yes' : 'no',
                    unique: row.querySelector('.col-unique')?.checked ? 'yes' : 'no'
                };
                
                if (col.name) {
                    columns.push(col);
                }
            });
            
            return columns;
        }

        // Preview SQL
        function previewSQL() {
            const tableName = document.getElementById('newTableName').value.trim();
            const columns = getColumnsData('columnBuilder');
            
            if (!tableName || columns.length === 0) {
                alert('Please enter table name and add at least one column');
                return;
            }
            
            const sql = generateCreateTableSQL(tableName, columns);
            document.getElementById('sqlPreview').textContent = sql;
            document.getElementById('sqlPreview').style.display = 'block';
        }

        // Preview template SQL
        function previewTemplateSQL() {
            const tableName = document.getElementById('templateTableName').value.trim();
            const columns = getColumnsData('templateColumns');
            
            if (!tableName || columns.length === 0) {
                alert('Please enter table name and select a template');
                return;
            }
            
            const sql = generateCreateTableSQL(tableName, columns);
            document.getElementById('templateSqlPreview').textContent = sql;
            document.getElementById('templateSqlPreview').style.display = 'block';
        }

        // Generate CREATE TABLE SQL
        function generateCreateTableSQL(tableName, columns) {
            let sql = `CREATE TABLE \`${tableName}\` (\n`;
            const columnDefs = [];
            const primaryKeys = [];
            
            columns.forEach(col => {
                let def = `  \`${col.name}\` ${col.type}`;
                
                if (col.length && ['VARCHAR', 'CHAR', 'INT', 'DECIMAL', 'FLOAT', 'DOUBLE'].includes(col.type)) {
                    def += `(${col.length})`;
                }
                
                if (col.nullable === 'no') {
                    def += ' NOT NULL';
                }
                
                if (col.autoIncrement === 'yes') {
                    def += ' AUTO_INCREMENT';
                }
                
                if (col.defaultValue) {
                    if (col.defaultValue.toUpperCase() === 'NULL') {
                        def += ' DEFAULT NULL';
                    } else if (col.defaultValue.toUpperCase() === 'CURRENT_TIMESTAMP') {
                        def += ' DEFAULT CURRENT_TIMESTAMP';
                    } else {
                        def += ` DEFAULT '${col.defaultValue}'`;
                    }
                }
                
                if (col.unique === 'yes') {
                    def += ' UNIQUE';
                }
                
                columnDefs.push(def);
                
                if (col.primaryKey === 'yes') {
                    primaryKeys.push(`\`${col.name}\``);
                }
            });
            
            sql += columnDefs.join(',\n');
            
            if (primaryKeys.length > 0) {
                sql += ',\n  PRIMARY KEY (' + primaryKeys.join(', ') + ')';
            }
            
            sql += '\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;';
            
            return sql;
        }

        // Create table (manual)
        async function createTableManual(event) {
            event.preventDefault();
            
            if (!selectedDatabaseId) {
                showMessage('createTableMessage', '‚ùå Please select a database from Dashboard first', 'error');
                return;
            }

            const connId = selectedDatabaseId.replace('conn_', '');
            const connections = getHostingerConnections();
            const conn = connections.find(c => c.id === connId);
            
            if (!conn) {
                showMessage('createTableMessage', '‚ùå Selected database connection not found', 'error');
                return;
            }
            
            const tableName = document.getElementById('newTableName').value.trim();
            const columns = getColumnsData('columnBuilder');
            
            if (!tableName) {
                showMessage('createTableMessage', '‚ùå Please enter a table name', 'error');
                return;
            }
            
            if (columns.length === 0) {
                showMessage('createTableMessage', '‚ùå Please add at least one column', 'error');
                return;
            }
            
            showMessage('createTableMessage', 'üîÑ Creating table...', 'info');
            
            const result = await apiRequest('create_table', {
                db_host: conn.host,
                db_name: conn.dbName,
                db_user: conn.username,
                db_pass: conn.password,
                db_port: conn.port,
                table_name: tableName,
                columns: JSON.stringify(columns)
            });
            
            if (result.success) {
                showMessage('createTableMessage', `‚úÖ ${result.message}`, 'success');
                document.getElementById('newTableName').value = '';
                document.getElementById('columnBuilder').innerHTML = '';
                document.getElementById('sqlPreview').style.display = 'none';
                addColumnRow(); // Re-add one empty column row
                loadTablesForDropdowns();
                // Refresh table list if we're in that section
                if (document.getElementById('listTables').classList.contains('active')) {
                    loadTables();
                }
            } else {
                showMessage('createTableMessage', `‚ùå ${result.message}`, 'error');
            }
        }

        // Create table from template
        async function createTableFromTemplate(event) {
            event.preventDefault();
            
            if (!selectedDatabaseId) {
                showMessage('createTableMessage', '‚ùå Please select a database from Dashboard first', 'error');
                return;
            }

            const connId = selectedDatabaseId.replace('conn_', '');
            const connections = getHostingerConnections();
            const conn = connections.find(c => c.id === connId);
            
            if (!conn) {
                showMessage('createTableMessage', '‚ùå Selected database connection not found', 'error');
                return;
            }
            
            const tableName = document.getElementById('templateTableName').value.trim();
            const columns = getColumnsData('templateColumns');
            
            if (!tableName) {
                showMessage('createTableMessage', '‚ùå Please enter a table name', 'error');
                return;
            }
            
            if (columns.length === 0) {
                showMessage('createTableMessage', '‚ùå Please select a template', 'error');
                return;
            }
            
            showMessage('createTableMessage', 'üîÑ Creating table from template...', 'info');
            
            const result = await apiRequest('create_table', {
                db_host: conn.host,
                db_name: conn.dbName,
                db_user: conn.username,
                db_pass: conn.password,
                db_port: conn.port,
                table_name: tableName,
                columns: JSON.stringify(columns)
            });
            
            if (result.success) {
                showMessage('createTableMessage', `‚úÖ ${result.message}`, 'success');
                document.getElementById('templateTableName').value = '';
                document.getElementById('templateColumns').innerHTML = '';
                document.getElementById('templateColumnBuilder').style.display = 'none';
                document.getElementById('templateSqlPreview').style.display = 'none';
                selectedTemplate = null;
                document.querySelectorAll('.template-card').forEach(card => card.classList.remove('selected'));
                loadTablesForDropdowns();
                // Refresh table list if we're in that section
                if (document.getElementById('listTables').classList.contains('active')) {
                    loadTables();
                }
            } else {
                showMessage('createTableMessage', `‚ùå ${result.message}`, 'error');
            }
        }

        // Global variable for current table view
        let currentTableName = null;
        let currentTablePage = 1;

        // Load tables from selected database
        async function loadTables() {
            // Check if database is selected
            if (!selectedDatabaseId) {
                showMessage('listTablesMessage', '‚ùå Please select a database first', 'error');
                const listEl = document.getElementById('tableList');
                listEl.innerHTML = '<p style="color: rgba(254, 243, 199, 0.6); text-align: center; padding: 20px;">No database selected. Please select a database from the Dashboard.</p>';
                return;
            }
            
            // Get connection info from selected database
            const connId = selectedDatabaseId.replace('conn_', '');
            const connections = getHostingerConnections();
            const conn = connections.find(c => c.id === connId);
            
            if (!conn) {
                showMessage('listTablesMessage', '‚ùå Selected database connection not found', 'error');
                return;
            }
            
            const listEl = document.getElementById('tableList');
            listEl.innerHTML = '<div class="spinner"></div> Loading tables...';
            
            // Call API with Hostinger credentials
            const result = await apiRequest('list_tables', {
                db_host: conn.host,
                db_name: conn.dbName,
                db_user: conn.username,
                db_pass: conn.password,
                db_port: conn.port
            });
            
            if (result.success) {
                if (result.tables.length === 0) {
                    listEl.innerHTML = '<p style="color: rgba(254, 243, 199, 0.6); text-align: center; padding: 20px;">No tables found in this database</p>';
                } else {
                    listEl.innerHTML = result.tables.map(table => `
                        <div class="table-item">
                            <div class="table-name" onclick="viewTableData('${table}')" style="cursor: pointer;">
                                <span class="table-icon">üìÑ</span>
                                <span>${table}</span>
                            </div>
                            <div class="table-actions">
                                <button class="btn btn-primary" onclick="event.stopPropagation(); generateSQLFromList('${table}', false)" title="Generate CREATE TABLE only">
                                    <span>üèóÔ∏è</span> Structure
                                </button>
                                <button class="btn btn-primary" onclick="event.stopPropagation(); generateSQLFromList('${table}', true)" title="Generate CREATE TABLE + INSERT data">
                                    <span>üì¶</span> + Data
                                </button>
                            </div>
                        </div>
                    `).join('');
                }
                showMessage('listTablesMessage', `‚úÖ Found ${result.tables.length} table(s) in ${conn.name}`, 'success');
            } else {
                listEl.innerHTML = '';
                showMessage('listTablesMessage', '‚ùå ' + result.message, 'error');
            }
        }

        // View table data
        async function viewTableData(tableName, page = 1) {
            if (!selectedDatabaseId) {
                showMessage('tableDataMessage', '‚ùå No database selected', 'error');
                return;
            }

            const connId = selectedDatabaseId.replace('conn_', '');
            const connections = getHostingerConnections();
            const conn = connections.find(c => c.id === connId);
            
            if (!conn) {
                showMessage('tableDataMessage', '‚ùå Connection not found', 'error');
                return;
            }

            currentTableName = tableName;
            currentTablePage = page;

            // Show table data view, hide tables list
            document.getElementById('tablesListView').style.display = 'none';
            document.getElementById('tableDataView').style.display = 'block';
            document.getElementById('currentTableName').textContent = tableName;

            // Show loading
            document.getElementById('tableDataContainer').innerHTML = '<div style="text-align: center; padding: 40px;"><div class="spinner"></div><div style="margin-top: 15px;">Loading table data...</div></div>';
            document.getElementById('tableInfoStats').innerHTML = '';
            document.getElementById('paginationTop').innerHTML = '';
            document.getElementById('paginationBottom').innerHTML = '';

            // Fetch table data
            const result = await apiRequest('get_table_data', {
                db_host: conn.host,
                db_name: conn.dbName,
                db_user: conn.username,
                db_pass: conn.password,
                db_port: conn.port,
                table_name: tableName,
                page: page,
                limit: 50
            });

            if (result.success) {
                // Render table info stats
                renderTableStats(result.table_info, result.pagination);
                
                // Render table data
                renderTableData(result.columns, result.data);
                
                // Render pagination
                renderPagination(result.pagination);
                
                showMessage('tableDataMessage', `‚úÖ Showing ${result.pagination.showing_from} - ${result.pagination.showing_to} of ${result.pagination.total_rows} rows`, 'success');
            } else {
                document.getElementById('tableDataContainer').innerHTML = `<div style="text-align: center; padding: 40px; color: #fca5a5;">‚ùå ${result.message}</div>`;
                showMessage('tableDataMessage', `‚ùå ${result.message}`, 'error');
            }
        }

        // Render table statistics
        function renderTableStats(info, pagination) {
            const statsHtml = `
                <div class="stat-box">
                    <div class="stat-label">üìä Total Rows</div>
                    <div class="stat-value">${pagination.total_rows.toLocaleString()}</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">‚öôÔ∏è Engine</div>
                    <div class="stat-value">${info.engine}</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">üíæ Data Size</div>
                    <div class="stat-value">${formatBytes(info.data_length)}</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">üî§ Collation</div>
                    <div class="stat-value" style="font-size: 12px;">${info.collation}</div>
                </div>
                ${info.created ? `
                <div class="stat-box">
                    <div class="stat-label">üìÖ Created</div>
                    <div class="stat-value" style="font-size: 12px;">${new Date(info.created).toLocaleDateString()}</div>
                </div>` : ''}
                ${info.updated ? `
                <div class="stat-box">
                    <div class="stat-label">üîÑ Updated</div>
                    <div class="stat-value" style="font-size: 12px;">${new Date(info.updated).toLocaleDateString()}</div>
                </div>` : ''}
            `;
            document.getElementById('tableInfoStats').innerHTML = statsHtml;
        }

        // Render table data
        function renderTableData(columns, data) {
            if (data.length === 0) {
                document.getElementById('tableDataContainer').innerHTML = '<div style="text-align: center; padding: 40px; color: rgba(254, 243, 199, 0.6);">üì≠ No data in this table</div>';
                return;
            }

            const tableHtml = `
                <table class="data-table">
                    <thead>
                        <tr>
                            ${columns.map(col => `<th title="${col.Type}">${col.Field}${col.Key === 'PRI' ? ' üîë' : ''}${col.Key === 'UNI' ? ' ‚≠ê' : ''}</th>`).join('')}
                        </tr>
                    </thead>
                    <tbody>
                        ${data.map(row => `
                            <tr>
                                ${columns.map(col => {
                                    const value = row[col.Field];
                                    const displayValue = value === null ? '<span style="color: #fca5a5; font-style: italic;">NULL</span>' : 
                                                       typeof value === 'string' && value.length > 100 ? value.substring(0, 100) + '...' : 
                                                       value;
                                    return `<td title="${value}">${displayValue}</td>`;
                                }).join('')}
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            document.getElementById('tableDataContainer').innerHTML = tableHtml;
        }

        // Render pagination controls
        function renderPagination(pagination) {
            const paginationHtml = `
                <div class="pagination-info">
                    Showing <strong>${pagination.showing_from}</strong> - <strong>${pagination.showing_to}</strong> of <strong>${pagination.total_rows.toLocaleString()}</strong> rows
                    (Page <strong>${pagination.current_page}</strong> of <strong>${pagination.total_pages}</strong>)
                </div>
                <div class="pagination-buttons">
                    <button class="btn btn-secondary" onclick="viewTableData('${currentTableName}', 1)" ${pagination.current_page === 1 ? 'disabled' : ''}>
                        ‚èÆÔ∏è First
                    </button>
                    <button class="btn btn-secondary" onclick="viewTableData('${currentTableName}', ${pagination.current_page - 1})" ${pagination.current_page === 1 ? 'disabled' : ''}>
                        ‚óÄÔ∏è Prev
                    </button>
                    <input type="number" class="page-input" value="${pagination.current_page}" min="1" max="${pagination.total_pages}" onchange="viewTableData('${currentTableName}', parseInt(this.value))">
                    <button class="btn btn-secondary" onclick="viewTableData('${currentTableName}', ${pagination.current_page + 1})" ${pagination.current_page === pagination.total_pages ? 'disabled' : ''}>
                        Next ‚ñ∂Ô∏è
                    </button>
                    <button class="btn btn-secondary" onclick="viewTableData('${currentTableName}', ${pagination.total_pages})" ${pagination.current_page === pagination.total_pages ? 'disabled' : ''}>
                        Last ‚è≠Ô∏è
                    </button>
                </div>
            `;
            document.getElementById('paginationTop').innerHTML = paginationHtml;
            document.getElementById('paginationBottom').innerHTML = paginationHtml;
        }

        // Back to tables list
        function backToTablesList() {
            document.getElementById('tablesListView').style.display = 'block';
            document.getElementById('tableDataView').style.display = 'none';
            currentTableName = null;
            currentTablePage = 1;
        }

        // Format bytes helper
        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round((bytes / Math.pow(k, i)) * 100) / 100 + ' ' + sizes[i];
        }

        // ========================================
        // RANDOM DATA GENERATOR
        // ========================================

        // Sample data pools for realistic generation
        const SAMPLE_DATA = {
            firstNames: ['John', 'Jane', 'Michael', 'Sarah', 'David', 'Emma', 'James', 'Emily', 'Robert', 'Lisa', 'William', 'Mary', 'Richard', 'Jennifer', 'Thomas', 'Linda', 'Charles', 'Patricia', 'Daniel', 'Elizabeth', 'Matthew', 'Susan', 'Anthony', 'Jessica', 'Donald', 'Karen', 'Mark', 'Nancy', 'Paul', 'Betty', 'Steven', 'Helen', 'Andrew', 'Sandra', 'Kenneth', 'Donna', 'Joshua', 'Carol', 'Kevin', 'Ruth', 'Brian', 'Sharon', 'George', 'Michelle', 'Edward', 'Laura', 'Ronald', 'Sarah', 'Timothy', 'Kimberly'],
            lastNames: ['Smith', 'Johnson', 'Williams', 'Brown', 'Jones', 'Garcia', 'Miller', 'Davis', 'Rodriguez', 'Martinez', 'Hernandez', 'Lopez', 'Gonzalez', 'Wilson', 'Anderson', 'Thomas', 'Taylor', 'Moore', 'Jackson', 'Martin', 'Lee', 'Thompson', 'White', 'Harris', 'Sanchez', 'Clark', 'Ramirez', 'Lewis', 'Robinson', 'Walker'],
            companies: ['TechCorp', 'DataSoft', 'CloudSys', 'WebFlow', 'AppWorks', 'NetCore', 'CodeBase', 'DevHub', 'InfoTech', 'SoftWare Inc', 'Digital Solutions', 'Smart Systems', 'Tech Innovators', 'Global Tech', 'Future Labs'],
            domains: ['gmail.com', 'yahoo.com', 'outlook.com', 'hotmail.com', 'company.com', 'business.net', 'email.com', 'mail.com'],
            cities: ['New York', 'Los Angeles', 'Chicago', 'Houston', 'Phoenix', 'Philadelphia', 'San Antonio', 'San Diego', 'Dallas', 'San Jose', 'Austin', 'Jacksonville', 'London', 'Paris', 'Tokyo', 'Berlin', 'Sydney', 'Toronto', 'Dubai', 'Singapore'],
            countries: ['USA', 'UK', 'Canada', 'Australia', 'Germany', 'France', 'Japan', 'China', 'India', 'Brazil', 'Mexico', 'Italy', 'Spain', 'South Korea', 'Netherlands'],
            statuses: ['active', 'inactive', 'pending', 'completed', 'cancelled', 'processing', 'approved', 'rejected', 'on_hold', 'verified'],
            categories: ['General', 'Technology', 'Business', 'Finance', 'Health', 'Education', 'Entertainment', 'Sports', 'News', 'Science'],
            products: ['Laptop', 'Smartphone', 'Tablet', 'Monitor', 'Keyboard', 'Mouse', 'Headphones', 'Camera', 'Printer', 'Scanner', 'Speaker', 'Router', 'Hard Drive', 'SSD', 'RAM'],
            descriptions: [
                'High quality product with excellent features',
                'Premium service for modern businesses',
                'Innovative solution for your needs',
                'Professional grade equipment',
                'Best value for money',
                'Industry leading performance',
                'Cutting-edge technology',
                'User-friendly interface',
                'Reliable and efficient',
                'Perfect for everyday use'
            ]
        };

        // Generate random data based on column name and type
        function generateRandomValue(columnName, columnType, isAutoIncrement, isPrimaryKey) {
            const colNameLower = columnName.toLowerCase();
            const typeUpper = columnType.toUpperCase();
            
            // Skip auto increment and primary key (will be auto-generated)
            if (isAutoIncrement || (isPrimaryKey && typeUpper.includes('INT'))) {
                return null; // Will be excluded from INSERT
            }
            
            // Name fields
            if (colNameLower.includes('first') && colNameLower.includes('name')) {
                return SAMPLE_DATA.firstNames[Math.floor(Math.random() * SAMPLE_DATA.firstNames.length)];
            }
            if (colNameLower.includes('last') && colNameLower.includes('name')) {
                return SAMPLE_DATA.lastNames[Math.floor(Math.random() * SAMPLE_DATA.lastNames.length)];
            }
            if (colNameLower === 'name' || colNameLower === 'username' || colNameLower === 'user_name' || colNameLower === 'full_name' || colNameLower === 'fullname') {
                const first = SAMPLE_DATA.firstNames[Math.floor(Math.random() * SAMPLE_DATA.firstNames.length)];
                const last = SAMPLE_DATA.lastNames[Math.floor(Math.random() * SAMPLE_DATA.lastNames.length)];
                return colNameLower.includes('user') ? first.toLowerCase() + last.toLowerCase() : first + ' ' + last;
            }
            
            // Email
            if (colNameLower.includes('email') || colNameLower.includes('mail')) {
                const name = SAMPLE_DATA.firstNames[Math.floor(Math.random() * SAMPLE_DATA.firstNames.length)].toLowerCase();
                const num = Math.floor(Math.random() * 999);
                const domain = SAMPLE_DATA.domains[Math.floor(Math.random() * SAMPLE_DATA.domains.length)];
                return `${name}${num}@${domain}`;
            }
            
            // Phone
            if (colNameLower.includes('phone') || colNameLower.includes('mobile') || colNameLower.includes('tel')) {
                return '+1' + Math.floor(Math.random() * 9000000000 + 1000000000);
            }
            
            // Address
            if (colNameLower.includes('address') || colNameLower.includes('street')) {
                return Math.floor(Math.random() * 9999 + 1) + ' ' + SAMPLE_DATA.lastNames[Math.floor(Math.random() * SAMPLE_DATA.lastNames.length)] + ' Street';
            }
            
            // City
            if (colNameLower.includes('city')) {
                return SAMPLE_DATA.cities[Math.floor(Math.random() * SAMPLE_DATA.cities.length)];
            }
            
            // Country
            if (colNameLower.includes('country')) {
                return SAMPLE_DATA.countries[Math.floor(Math.random() * SAMPLE_DATA.countries.length)];
            }
            
            // Company
            if (colNameLower.includes('company') || colNameLower.includes('organization')) {
                return SAMPLE_DATA.companies[Math.floor(Math.random() * SAMPLE_DATA.companies.length)];
            }
            
            // Title
            if (colNameLower.includes('title') && !colNameLower.includes('job')) {
                return 'Sample Title ' + Math.floor(Math.random() * 1000);
            }
            
            // Description
            if (colNameLower.includes('desc') || colNameLower.includes('content') || colNameLower.includes('comment') || colNameLower.includes('note')) {
                return SAMPLE_DATA.descriptions[Math.floor(Math.random() * SAMPLE_DATA.descriptions.length)];
            }
            
            // Status
            if (colNameLower.includes('status') || colNameLower === 'state') {
                return SAMPLE_DATA.statuses[Math.floor(Math.random() * SAMPLE_DATA.statuses.length)];
            }
            
            // Category
            if (colNameLower.includes('category') || colNameLower.includes('type') && !typeUpper.includes('INT')) {
                return SAMPLE_DATA.categories[Math.floor(Math.random() * SAMPLE_DATA.categories.length)];
            }
            
            // Product
            if (colNameLower.includes('product')) {
                return SAMPLE_DATA.products[Math.floor(Math.random() * SAMPLE_DATA.products.length)];
            }
            
            // Price/Amount/Cost
            if (colNameLower.includes('price') || colNameLower.includes('amount') || colNameLower.includes('cost') || colNameLower.includes('total')) {
                return (Math.random() * 999 + 1).toFixed(2);
            }
            
            // Quantity/Stock/Count
            if (colNameLower.includes('quantity') || colNameLower.includes('stock') || colNameLower.includes('count') || colNameLower.includes('qty')) {
                return Math.floor(Math.random() * 100);
            }
            
            // Age
            if (colNameLower === 'age') {
                return Math.floor(Math.random() * 60 + 18);
            }
            
            // Password/Hash
            if (colNameLower.includes('password') || colNameLower.includes('hash')) {
                return '$2y$10$' + Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
            }
            
            // Token
            if (colNameLower.includes('token') || colNameLower.includes('key') && typeUpper.includes('VARCHAR')) {
                return Math.random().toString(36).substring(2) + Math.random().toString(36).substring(2);
            }
            
            // URL/Link
            if (colNameLower.includes('url') || colNameLower.includes('link') || colNameLower.includes('website')) {
                return 'https://example.com/' + Math.random().toString(36).substring(7);
            }
            
            // Slug
            if (colNameLower.includes('slug')) {
                return 'sample-slug-' + Math.floor(Math.random() * 10000);
            }
            
            // IP Address
            if (colNameLower.includes('ip')) {
                return Math.floor(Math.random() * 255) + '.' + Math.floor(Math.random() * 255) + '.' + Math.floor(Math.random() * 255) + '.' + Math.floor(Math.random() * 255);
            }
            
            // Based on data type
            if (typeUpper.includes('INT') || typeUpper.includes('INTEGER')) {
                if (typeUpper.includes('TINYINT')) {
                    return Math.floor(Math.random() * 2); // 0 or 1 for boolean
                }
                return Math.floor(Math.random() * 10000);
            }
            
            if (typeUpper.includes('DECIMAL') || typeUpper.includes('FLOAT') || typeUpper.includes('DOUBLE')) {
                return (Math.random() * 1000).toFixed(2);
            }
            
            if (typeUpper.includes('DATE')) {
                const start = new Date(2020, 0, 1);
                const end = new Date();
                const randomDate = new Date(start.getTime() + Math.random() * (end.getTime() - start.getTime()));
                return randomDate.toISOString().split('T')[0];
            }
            
            if (typeUpper.includes('DATETIME') || typeUpper.includes('TIMESTAMP')) {
                const start = new Date(2020, 0, 1);
                const end = new Date();
                const randomDate = new Date(start.getTime() + Math.random() * (end.getTime() - start.getTime()));
                return randomDate.toISOString().slice(0, 19).replace('T', ' ');
            }
            
            if (typeUpper.includes('TIME') && !typeUpper.includes('DATETIME')) {
                const h = Math.floor(Math.random() * 24).toString().padStart(2, '0');
                const m = Math.floor(Math.random() * 60).toString().padStart(2, '0');
                const s = Math.floor(Math.random() * 60).toString().padStart(2, '0');
                return `${h}:${m}:${s}`;
            }
            
            if (typeUpper.includes('BOOL')) {
                return Math.random() > 0.5 ? 1 : 0;
            }
            
            if (typeUpper.includes('TEXT') || typeUpper.includes('VARCHAR') || typeUpper.includes('CHAR')) {
                // Generic text
                if (colNameLower.includes('desc') || colNameLower.includes('content')) {
                    return 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. ' + Math.random().toString(36).substring(7);
                }
                return 'Sample ' + columnName + ' ' + Math.floor(Math.random() * 1000);
            }
            
            // Default
            return 'Data_' + Math.floor(Math.random() * 10000);
        }

        // Generate random records for table
        function generateRandomRecords(columns, count = 10) {
            const records = [];
            
            for (let i = 0; i < count; i++) {
                const record = {};
                
                columns.forEach(col => {
                    const isAutoIncrement = col.Extra && col.Extra.toLowerCase().includes('auto_increment');
                    const isPrimaryKey = col.Key === 'PRI';
                    
                    // Skip auto increment columns
                    if (isAutoIncrement) {
                        return;
                    }
                    
                    const value = generateRandomValue(col.Field, col.Type, isAutoIncrement, isPrimaryKey);
                    
                    if (value !== null) {
                        record[col.Field] = value;
                    }
                });
                
                records.push(record);
            }
            
            return records;
        }

        // Inject random records into current table (from List Tables)
        async function injectRandomRecords() {
            if (!selectedDatabaseId || !currentTableName) {
                showMessage('tableDataMessage', '‚ùå No table selected', 'error');
                return;
            }

            const connId = selectedDatabaseId.replace('conn_', '');
            const connections = getHostingerConnections();
            const conn = connections.find(c => c.id === connId);
            
            if (!conn) {
                showMessage('tableDataMessage', '‚ùå Connection not found', 'error');
                return;
            }

            // Get table structure first
            showMessage('tableDataMessage', 'üîÑ Generating random data...', 'info');

            const structureResult = await apiRequest('get_table_structure', {
                db_host: conn.host,
                db_name: conn.dbName,
                db_user: conn.username,
                db_pass: conn.password,
                db_port: conn.port,
                table_name: currentTableName
            });

            if (!structureResult.success) {
                showMessage('tableDataMessage', `‚ùå ${structureResult.message}`, 'error');
                return;
            }

            // Generate random records
            const randomRecords = generateRandomRecords(structureResult.columns, 10);

            if (randomRecords.length === 0) {
                showMessage('tableDataMessage', '‚ùå Could not generate records (table has only auto-increment columns?)', 'error');
                return;
            }

            // Insert records
            showMessage('tableDataMessage', 'üîÑ Injecting 10 random records...', 'info');

            const result = await apiRequest('insert_random_data', {
                db_host: conn.host,
                db_name: conn.dbName,
                db_user: conn.username,
                db_pass: conn.password,
                db_port: conn.port,
                table_name: currentTableName,
                records_data: JSON.stringify(randomRecords),
                record_count: 10
            });

            if (result.success) {
                showMessage('tableDataMessage', `‚úÖ ${result.message}`, 'success');
                // Reload table data to show new records
                viewTableData(currentTableName, currentTablePage);
            } else {
                showMessage('tableDataMessage', `‚ùå ${result.message}`, 'error');
            }
        }

        // Inject random records from Edit Table (Manage Data tab)
        async function injectRandomRecordsFromEdit() {
            if (!selectedDatabaseId || !currentEditTableName) {
                showMessage('editTableMessage', '‚ùå No table selected', 'error');
                return;
            }

            const connId = selectedDatabaseId.replace('conn_', '');
            const connections = getHostingerConnections();
            const conn = connections.find(c => c.id === connId);
            
            if (!conn) {
                showMessage('editTableMessage', '‚ùå Connection not found', 'error');
                return;
            }

            // Use existing columns structure if available
            if (currentEditTableColumns.length === 0) {
                showMessage('editTableMessage', '‚ùå Table structure not loaded', 'error');
                return;
            }

            // Generate random records
            showMessage('editTableMessage', 'üîÑ Generating random data...', 'info');
            const randomRecords = generateRandomRecords(currentEditTableColumns, 10);

            if (randomRecords.length === 0) {
                showMessage('editTableMessage', '‚ùå Could not generate records (table has only auto-increment columns?)', 'error');
                return;
            }

            // Insert records
            showMessage('editTableMessage', 'üîÑ Injecting 10 random records...', 'info');

            const result = await apiRequest('insert_random_data', {
                db_host: conn.host,
                db_name: conn.dbName,
                db_user: conn.username,
                db_pass: conn.password,
                db_port: conn.port,
                table_name: currentEditTableName,
                records_data: JSON.stringify(randomRecords),
                record_count: 10
            });

            if (result.success) {
                showMessage('editTableMessage', `‚úÖ ${result.message}`, 'success');
                // Reload data to show new records
                loadTableRecordsForManagement(currentDataPage, currentSearchTerm);
            } else {
                showMessage('editTableMessage', `‚ùå ${result.message}`, 'error');
            }
        }

        // ========================================
        // SQL GENERATOR FUNCTIONS
        // ========================================

        let generatedSQL = '';

        // Generate full database SQL
        async function generateDatabaseSQL(includeCreateDB, includeData) {
            if (!selectedDatabaseId) {
                showMessage('generateDatabaseMessage', '‚ùå Please select a database from Dashboard first', 'error');
                return;
            }

            const connId = selectedDatabaseId.replace('conn_', '');
            const connections = getHostingerConnections();
            const conn = connections.find(c => c.id === connId);
            
            if (!conn) {
                showMessage('generateDatabaseMessage', '‚ùå Selected database connection not found', 'error');
                return;
            }

            // Determine generation type
            let genType = '';
            if (includeCreateDB && includeData) {
                genType = 'Complete Database Dump (CREATE DATABASE + Structure + Data)';
            } else if (includeCreateDB && !includeData) {
                genType = 'Full Database (CREATE DATABASE + Structure Only)';
            } else if (!includeCreateDB && includeData) {
                genType = 'Tables Structure + Data';
            } else {
                genType = 'Tables Structure Only';
            }

            showMessage('generateDatabaseMessage', `üîÑ Generating ${genType}...`, 'info');

            const result = await apiRequest('generate_database_sql', {
                db_host: conn.host,
                db_name: conn.dbName,
                db_user: conn.username,
                db_pass: conn.password,
                db_port: conn.port,
                include_create_db: includeCreateDB ? 'true' : 'false',
                include_data: includeData ? 'true' : 'false'
            });

            if (result.success) {
                generatedSQL = result.sql;
                showDatabaseSQLModal(result);
                showMessage('generateDatabaseMessage', `‚úÖ ${genType} generated successfully!`, 'success');
            } else {
                showMessage('generateDatabaseMessage', `‚ùå ${result.message}`, 'error');
            }
        }

        // Show database SQL modal
        function showDatabaseSQLModal(result) {
            document.getElementById('sqlTableName').textContent = `Database: ${result.database_name}`;
            document.getElementById('sqlCode').value = result.sql;
            
            // Show info
            let typeLabel = '';
            if (result.has_create_db && result.has_data) {
                typeLabel = 'üíé Complete Dump (DB + Tables + Data)';
            } else if (result.has_create_db && !result.has_data) {
                typeLabel = 'üóÑÔ∏è Full Database (DB + Tables)';
            } else if (!result.has_create_db && result.has_data) {
                typeLabel = 'üì¶ Tables + Data';
            } else {
                typeLabel = 'üèóÔ∏è Tables Structure Only';
            }

            const infoHtml = `
                <div class="stat-box" style="flex: 1; min-width: 150px;">
                    <div class="stat-label">üìù Generation Type</div>
                    <div class="stat-value" style="font-size: 12px;">${typeLabel}</div>
                </div>
                <div class="stat-box" style="flex: 1; min-width: 150px;">
                    <div class="stat-label">üìä Total Tables</div>
                    <div class="stat-value" style="font-size: 14px;">${result.total_tables}</div>
                </div>
                ${result.has_data ? `
                <div class="stat-box" style="flex: 1; min-width: 150px;">
                    <div class="stat-label">üìà Total Rows</div>
                    <div class="stat-value" style="font-size: 14px;">${result.total_rows.toLocaleString()}</div>
                </div>` : ''}
                <div class="stat-box" style="flex: 1; min-width: 150px;">
                    <div class="stat-label">üìè SQL Size</div>
                    <div class="stat-value" style="font-size: 14px;">${formatBytes(result.sql_length)}</div>
                </div>
            `;
            document.getElementById('sqlInfo').innerHTML = infoHtml;
            
            // Show success message
            const messageHtml = `
                <div class="message success" style="display: block;">
                    ‚úÖ Database SQL generated successfully! Ready to copy or download.
                </div>
            `;
            document.getElementById('sqlMessage').innerHTML = messageHtml;
            
            document.getElementById('sqlModal').classList.add('active');
        }

        // Generate SQL from table list (when clicking buttons on table cards)
        async function generateSQLFromList(tableName, includeData) {
            if (!selectedDatabaseId) {
                alert('‚ùå No database selected');
                return;
            }

            const connId = selectedDatabaseId.replace('conn_', '');
            const connections = getHostingerConnections();
            const conn = connections.find(c => c.id === connId);
            
            if (!conn) {
                alert('‚ùå Connection not found');
                return;
            }

            // Show loading message
            showMessage('listTablesMessage', `üîÑ Generating SQL for ${tableName} ${includeData ? 'with data' : 'structure only'}...`, 'info');

            const result = await apiRequest('generate_table_sql', {
                db_host: conn.host,
                db_name: conn.dbName,
                db_user: conn.username,
                db_pass: conn.password,
                db_port: conn.port,
                table_name: tableName,
                include_data: includeData ? 'true' : 'false'
            });

            if (result.success) {
                generatedSQL = result.sql;
                showSQLModal(result);
                showMessage('listTablesMessage', `‚úÖ SQL generated successfully for ${tableName}!`, 'success');
            } else {
                showMessage('listTablesMessage', `‚ùå ${result.message}`, 'error');
            }
        }

        // Generate SQL for table (from table data view)
        async function generateSQL(includeData) {
            if (!selectedDatabaseId || !currentTableName) {
                alert('‚ùå No table selected');
                return;
            }

            const connId = selectedDatabaseId.replace('conn_', '');
            const connections = getHostingerConnections();
            const conn = connections.find(c => c.id === connId);
            
            if (!conn) {
                alert('‚ùå Connection not found');
                return;
            }

            // Show loading message
            showMessage('tableDataMessage', `üîÑ Generating SQL ${includeData ? 'with data' : 'structure only'}...`, 'info');

            const result = await apiRequest('generate_table_sql', {
                db_host: conn.host,
                db_name: conn.dbName,
                db_user: conn.username,
                db_pass: conn.password,
                db_port: conn.port,
                table_name: currentTableName,
                include_data: includeData ? 'true' : 'false'
            });

            if (result.success) {
                generatedSQL = result.sql;
                showSQLModal(result);
                showMessage('tableDataMessage', `‚úÖ SQL generated successfully!`, 'success');
            } else {
                showMessage('tableDataMessage', `‚ùå ${result.message}`, 'error');
            }
        }

        // Show SQL modal
        function showSQLModal(result) {
            document.getElementById('sqlTableName').textContent = result.table_name;
            document.getElementById('sqlCode').value = result.sql;
            
            // Show info
            const infoHtml = `
                <div class="stat-box" style="flex: 1; min-width: 150px;">
                    <div class="stat-label">${result.has_data ? 'üì¶ Structure + Data' : 'üèóÔ∏è Structure Only'}</div>
                    <div class="stat-value" style="font-size: 14px;">${result.has_data ? result.row_count + ' rows' : 'No data'}</div>
                </div>
                <div class="stat-box" style="flex: 1; min-width: 150px;">
                    <div class="stat-label">üìè SQL Size</div>
                    <div class="stat-value" style="font-size: 14px;">${formatBytes(result.sql_length)}</div>
                </div>
            `;
            document.getElementById('sqlInfo').innerHTML = infoHtml;
            
            // Show success message
            const messageHtml = `
                <div class="message success" style="display: block;">
                    ‚úÖ SQL generated successfully! You can now copy or download it.
                </div>
            `;
            document.getElementById('sqlMessage').innerHTML = messageHtml;
            
            document.getElementById('sqlModal').classList.add('active');
        }

        // Close SQL modal
        function closeSQLModal() {
            document.getElementById('sqlModal').classList.remove('active');
            generatedSQL = '';
        }

        // Copy SQL to clipboard
        async function copySQLToClipboard() {
            const sqlCode = document.getElementById('sqlCode').value;
            
            try {
                await navigator.clipboard.writeText(sqlCode);
                
                // Visual feedback in modal
                const messageEl = document.getElementById('sqlMessage');
                messageEl.innerHTML = '<div class="message success" style="display: block;">‚úÖ SQL copied to clipboard successfully!</div>';
                
                setTimeout(() => {
                    messageEl.innerHTML = '<div class="message success" style="display: block;">‚úÖ SQL generated successfully! You can now copy or download it.</div>';
                }, 2000);

                // Show message in appropriate location
                const currentView = document.getElementById('tableDataView').style.display;
                if (currentView === 'none') {
                    showMessage('generateDatabaseMessage', '‚úÖ SQL copied to clipboard!', 'success');
                } else {
                    showMessage('tableDataMessage', '‚úÖ SQL copied to clipboard!', 'success');
                }
            } catch (err) {
                // Fallback for older browsers
                const textarea = document.getElementById('sqlCode');
                textarea.select();
                document.execCommand('copy');
                
                const currentView = document.getElementById('tableDataView').style.display;
                if (currentView === 'none') {
                    showMessage('generateDatabaseMessage', '‚úÖ SQL copied to clipboard!', 'success');
                } else {
                    showMessage('tableDataMessage', '‚úÖ SQL copied to clipboard!', 'success');
                }
            }
        }

        // Download SQL file
        function downloadSQL() {
            const sqlCode = document.getElementById('sqlCode').value;
            const nameText = document.getElementById('sqlTableName').textContent;
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);
            
            // Clean filename (remove special chars)
            const cleanName = nameText.replace(/[^a-zA-Z0-9_-]/g, '_').replace(/_{2,}/g, '_');
            const filename = `${cleanName}_${timestamp}.sql`;
            
            const blob = new Blob([sqlCode], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            // Show message in appropriate location
            const currentView = document.getElementById('tableDataView').style.display;
            if (currentView === 'none') {
                showMessage('generateDatabaseMessage', `‚úÖ SQL file downloaded: ${filename}`, 'success');
            } else {
                showMessage('tableDataMessage', `‚úÖ SQL file downloaded: ${filename}`, 'success');
            }
        }

        // Load tables for dropdowns
        async function loadTablesForDropdowns() {
            if (!selectedDatabaseId) return;

            const connId = selectedDatabaseId.replace('conn_', '');
            const connections = getHostingerConnections();
            const conn = connections.find(c => c.id === connId);
            
            if (!conn) return;
            
            const result = await apiRequest('list_tables', {
                db_host: conn.host,
                db_name: conn.dbName,
                db_user: conn.username,
                db_pass: conn.password,
                db_port: conn.port
            });
            
            if (result.success) {
                const options = result.tables.map(table => 
                    `<option value="${table}">${table}</option>`
                ).join('');
                
                document.getElementById('editTableSelect').innerHTML = '<option value="">-- Select Table --</option>' + options;
                document.getElementById('deleteTableSelect').innerHTML = '<option value="">-- Select Table --</option>' + options;
                document.getElementById('renameTableOldSelect').innerHTML = '<option value="">-- Select Table --</option>' + options;
            }
        }

        // Delete table
        async function deleteTableAction(event) {
            event.preventDefault();
            
            if (!selectedDatabaseId) {
                showMessage('deleteTableMessage', '‚ùå Please select a database from Dashboard first', 'error');
                return;
            }

            const connId = selectedDatabaseId.replace('conn_', '');
            const connections = getHostingerConnections();
            const conn = connections.find(c => c.id === connId);
            
            if (!conn) {
                showMessage('deleteTableMessage', '‚ùå Connection not found', 'error');
                return;
            }
            
            const tableName = document.getElementById('deleteTableSelect').value;
            
            if (!tableName) {
                showMessage('deleteTableMessage', '‚ùå Please select a table', 'error');
                return;
            }
            
            if (!confirm(`Are you sure you want to delete the table "${tableName}"?\n\nThis action cannot be undone!`)) {
                return;
            }
            
            showMessage('deleteTableMessage', 'üîÑ Deleting table...', 'info');
            
            const result = await apiRequest('delete_table', {
                db_host: conn.host,
                db_name: conn.dbName,
                db_user: conn.username,
                db_pass: conn.password,
                db_port: conn.port,
                table_name: tableName
            });
            
            if (result.success) {
                showMessage('deleteTableMessage', `‚úÖ ${result.message}`, 'success');
                document.getElementById('deleteTableSelect').value = '';
                loadTablesForDropdowns();
                // Refresh table list if we're in that section
                if (document.getElementById('listTables').classList.contains('active')) {
                    loadTables();
                }
            } else {
                showMessage('deleteTableMessage', `‚ùå ${result.message}`, 'error');
            }
        }

        // Rename table
        async function renameTableAction(event) {
            event.preventDefault();
            
            if (!selectedDatabaseId) {
                showMessage('renameTableMessage', '‚ùå Please select a database from Dashboard first', 'error');
                return;
            }

            const connId = selectedDatabaseId.replace('conn_', '');
            const connections = getHostingerConnections();
            const conn = connections.find(c => c.id === connId);
            
            if (!conn) {
                showMessage('renameTableMessage', '‚ùå Connection not found', 'error');
                return;
            }
            
            const oldName = document.getElementById('renameTableOldSelect').value;
            const newName = document.getElementById('renameTableNewName').value.trim();
            
            if (!oldName || !newName) {
                showMessage('renameTableMessage', '‚ùå Please provide both old and new table names', 'error');
                return;
            }
            
            if (oldName === newName) {
                showMessage('renameTableMessage', '‚ùå New name must be different from old name', 'error');
                return;
            }
            
            showMessage('renameTableMessage', 'üîÑ Renaming table...', 'info');
            
            const result = await apiRequest('rename_table', {
                db_host: conn.host,
                db_name: conn.dbName,
                db_user: conn.username,
                db_pass: conn.password,
                db_port: conn.port,
                old_table_name: oldName,
                new_table_name: newName
            });
            
            if (result.success) {
                showMessage('renameTableMessage', `‚úÖ ${result.message}`, 'success');
                document.getElementById('renameTableOldSelect').value = '';
                document.getElementById('renameTableNewName').value = '';
                loadTablesForDropdowns();
                // Refresh table list if we're in that section
                if (document.getElementById('listTables').classList.contains('active')) {
                    loadTables();
                }
            } else {
                showMessage('renameTableMessage', `‚ùå ${result.message}`, 'error');
            }
        }

        // ========================================
        // EDIT TABLE - CRUD OPERATIONS
        // ========================================

        let currentEditTableName = null;
        let currentEditTableColumns = [];
        let currentEditTablePrimaryKey = null;
        let currentRecordFormMode = 'add'; // 'add' or 'edit'
        let currentEditingRecord = null;
        let currentDataPage = 1;
        let currentSearchTerm = '';

        // Switch between tabs in Edit Table
        function switchEditTab(tabName) {
            const editSection = document.getElementById('editTableTabs');
            if (!editSection) return;

            editSection.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById('editStructureTab').classList.remove('active');
            document.getElementById('editDataTab').classList.remove('active');
            document.getElementById('editTableInfoTab').classList.remove('active');
            
            if (tabName === 'structure') {
                editSection.querySelector('.tab-btn:nth-child(1)').classList.add('active');
                document.getElementById('editStructureTab').classList.add('active');
            } else if (tabName === 'manageData') {
                editSection.querySelector('.tab-btn:nth-child(2)').classList.add('active');
                document.getElementById('editDataTab').classList.add('active');
                // Load data when switching to manage data tab
                loadTableRecordsForManagement(1);
            } else if (tabName === 'tableInfo') {
                editSection.querySelector('.tab-btn:nth-child(3)').classList.add('active');
                document.getElementById('editTableInfoTab').classList.add('active');
                // Generate table info when switching to this tab
                generateTableInfo();
            }
        }

        // Load table for editing (called when table is selected)
        async function loadTableForEditing() {
            const tableName = document.getElementById('editTableSelect').value;
            
            if (!tableName || !selectedDatabaseId) {
                document.getElementById('editTableTabs').style.display = 'none';
                return;
            }

            currentEditTableName = tableName;

            const connId = selectedDatabaseId.replace('conn_', '');
            const connections = getHostingerConnections();
            const conn = connections.find(c => c.id === connId);
            
            if (!conn) {
                showMessage('editTableMessage', '‚ùå Connection not found', 'error');
                return;
            }
            
            // Load table structure
            const result = await apiRequest('get_table_structure', {
                db_host: conn.host,
                db_name: conn.dbName,
                db_user: conn.username,
                db_pass: conn.password,
                db_port: conn.port,
                table_name: tableName
            });
            
            if (result.success) {
                currentEditTableColumns = result.columns;
                
                // Find primary key
                currentEditTablePrimaryKey = null;
                for (const col of result.columns) {
                    if (col.Key === 'PRI') {
                        currentEditTablePrimaryKey = col.Field;
                        break;
                    }
                }

                // Display structure
                const container = document.getElementById('currentColumns');
                container.innerHTML = result.columns.map(col => `
                    <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong style="color: #fbbf24;">${col.Field}</strong>
                                <span style="color: rgba(254,243,199,0.7); margin-left: 15px;">${col.Type}</span>
                                ${col.Null === 'NO' ? '<span style="color: #ef4444; margin-left: 10px;">NOT NULL</span>' : ''}
                                ${col.Key === 'PRI' ? '<span style="color: #fbbf24; margin-left: 10px;">PRIMARY KEY</span>' : ''}
                                ${col.Key === 'UNI' ? '<span style="color: #3b82f6; margin-left: 10px;">UNIQUE</span>' : ''}
                                ${col.Extra ? `<span style="color: #86efac; margin-left: 10px;">${col.Extra}</span>` : ''}
                            </div>
                            <button type="button" class="btn btn-danger btn-icon" onclick="dropColumn('${tableName}', '${col.Field}')">√ó</button>
                        </div>
                        ${col.Default !== null ? `<div style="color: rgba(254,243,199,0.6); margin-top: 5px; font-size: 12px;">Default: ${col.Default}</div>` : ''}
                    </div>
                `).join('');
                
                // Show tabs
                document.getElementById('editTableTabs').style.display = 'block';
                
                showMessage('editTableMessage', `‚úÖ Loaded table: ${tableName}`, 'success');
            } else {
                showMessage('editTableMessage', '‚ùå ' + result.message, 'error');
            }
        }

        // Load table structure (old function - for backward compatibility)
        function loadTableStructure() {
            loadTableForEditing();
        }

        // Load records for management
        async function loadTableRecordsForManagement(page = 1, searchTerm = '') {
            if (!selectedDatabaseId || !currentEditTableName) {
                document.getElementById('dataManagementContainer').innerHTML = '<p style="color: rgba(254, 243, 199, 0.6); text-align: center; padding: 20px;">Please select a table first</p>';
                return;
            }

            const connId = selectedDatabaseId.replace('conn_', '');
            const connections = getHostingerConnections();
            const conn = connections.find(c => c.id === connId);
            
            if (!conn) return;

            currentDataPage = page;
            currentSearchTerm = searchTerm;

            document.getElementById('dataManagementContainer').innerHTML = '<div style="text-align: center; padding: 40px;"><div class="spinner"></div><div style="margin-top: 15px;">Loading records...</div></div>';

            const result = await apiRequest('search_records', {
                db_host: conn.host,
                db_name: conn.dbName,
                db_user: conn.username,
                db_pass: conn.password,
                db_port: conn.port,
                table_name: currentEditTableName,
                search_term: searchTerm,
                page: page,
                limit: 20
            });

            if (result.success) {
                renderDataManagementTable(result.columns, result.data);
                renderDataPagination(result.pagination);
            } else {
                document.getElementById('dataManagementContainer').innerHTML = `<div style="text-align: center; padding: 40px; color: #fca5a5;">‚ùå ${result.message}</div>`;
            }
        }

        // Render data management table
        function renderDataManagementTable(columns, data) {
            if (data.length === 0) {
                document.getElementById('dataManagementContainer').innerHTML = '<div style="text-align: center; padding: 40px; color: rgba(254, 243, 199, 0.6);">üì≠ No records found</div>';
                return;
            }

            let html = '<div style="overflow-x: auto; background: rgba(0,0,0,0.2); border-radius: 8px; padding: 10px;"><table class="data-table">';
            
            // Header
            html += '<thead><tr>';
            html += '<th style="width: 180px; text-align: center; position: sticky; left: 0; background: rgba(251, 191, 36, 0.2); z-index: 5;">Actions</th>';
            columns.forEach(col => {
                html += `<th title="${col.Type}">${col.Field}${col.Key === 'PRI' ? ' üîë' : ''}</th>`;
            });
            html += '</tr></thead>';
            
            // Body
            html += '<tbody>';
            data.forEach((row, index) => {
                const rowId = `row_${index}`;
                
                // Store row data in a global object for access
                if (!window.tableRowsData) window.tableRowsData = {};
                window.tableRowsData[rowId] = row;
                
                html += '<tr>';
                
                // Actions column (sticky) - ALWAYS show buttons
                html += `<td style="position: sticky; left: 0; background: rgba(0, 0, 0, 0.4); z-index: 4; backdrop-filter: blur(5px);">`;
                html += '<div style="display: flex; gap: 5px; justify-content: center;">';
                html += `<button class="btn btn-primary" onclick="editRecordById('${rowId}')" style="padding: 8px 14px; font-size: 13px; white-space: nowrap;">‚úèÔ∏è Edit</button>`;
                html += `<button class="btn btn-danger" onclick="deleteRecordByRow('${rowId}')" style="padding: 8px 14px; font-size: 13px;">üóëÔ∏è</button>`;
                html += '</div></td>';
                
                // Data columns
                columns.forEach(col => {
                    const value = row[col.Field];
                    let displayValue;
                    if (value === null) {
                        displayValue = '<span style="color: #fca5a5; font-style: italic;">NULL</span>';
                    } else if (typeof value === 'string' && value.length > 50) {
                        displayValue = value.substring(0, 50) + '...';
                    } else {
                        displayValue = value;
                    }
                    html += `<td title="${value}">${displayValue}</td>`;
                });
                
                html += '</tr>';
            });
            html += '</tbody></table></div>';
            
            document.getElementById('dataManagementContainer').innerHTML = html;
        }

        // Edit record by row ID
        function editRecordById(rowId) {
            if (window.tableRowsData && window.tableRowsData[rowId]) {
                showRecordForm('edit', window.tableRowsData[rowId]);
            }
        }

        // Delete record by row (works with or without PK)
        function deleteRecordByRow(rowId) {
            if (!window.tableRowsData || !window.tableRowsData[rowId]) {
                showMessage('editTableMessage', '‚ùå Record data not found', 'error');
                return;
            }

            const record = window.tableRowsData[rowId];
            
            if (!confirm('Are you sure you want to delete this record?\n\nThis action cannot be undone!')) {
                return;
            }

            // If table has primary key, use it
            if (currentEditTablePrimaryKey && record[currentEditTablePrimaryKey]) {
                deleteRecordAction(record[currentEditTablePrimaryKey]);
            } else {
                // No primary key - use all columns as WHERE condition
                deleteRecordByAllColumns(record);
            }
        }

        // Delete record using all columns (when no PK)
        async function deleteRecordByAllColumns(record) {
            if (!selectedDatabaseId || !currentEditTableName) {
                showMessage('editTableMessage', '‚ùå No table selected', 'error');
                return;
            }

            const connId = selectedDatabaseId.replace('conn_', '');
            const connections = getHostingerConnections();
            const conn = connections.find(c => c.id === connId);
            
            if (!conn) return;

            showMessage('editTableMessage', 'üîÑ Deleting record...', 'info');

            // Build WHERE clause using all columns
            const whereConditions = [];
            const whereValues = [];
            
            currentEditTableColumns.forEach(col => {
                const value = record[col.Field];
                whereConditions.push(`\`${col.Field}\` = ?`);
                whereValues.push(value);
            });

            // For tables without PK, we'll delete using LIMIT 1 to be safe
            const whereSql = whereConditions.join(' AND ');

            // Since we can't send complex WHERE via our current API,
            // let's use the primary key method but with first column as fallback
            let identifierKey = currentEditTablePrimaryKey;
            let identifierValue = currentEditTablePrimaryKey ? record[currentEditTablePrimaryKey] : null;

            // Fallback: use first column
            if (!identifierValue && currentEditTableColumns.length > 0) {
                identifierKey = currentEditTableColumns[0].Field;
                identifierValue = record[identifierKey];
            }

            if (!identifierValue) {
                showMessage('editTableMessage', '‚ùå Cannot delete: No identifier found', 'error');
                return;
            }

            const result = await apiRequest('delete_record', {
                db_host: conn.host,
                db_name: conn.dbName,
                db_user: conn.username,
                db_pass: conn.password,
                db_port: conn.port,
                table_name: currentEditTableName,
                primary_key: identifierKey,
                primary_value: identifierValue
            });

            if (result.success) {
                showMessage('editTableMessage', `‚úÖ ${result.message}`, 'success');
                loadTableRecordsForManagement(currentDataPage, currentSearchTerm);
            } else {
                showMessage('editTableMessage', `‚ùå ${result.message}`, 'error');
            }
        }

        // Render data pagination
        function renderDataPagination(pagination) {
            const html = `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                    <div class="pagination-info">
                        Showing <strong>${pagination.showing_from}</strong> - <strong>${pagination.showing_to}</strong> of <strong>${pagination.total_rows}</strong> records
                    </div>
                    <div class="pagination-buttons">
                        <button class="btn btn-secondary" onclick="loadTableRecordsForManagement(1, currentSearchTerm)" ${pagination.current_page === 1 ? 'disabled' : ''}>‚èÆÔ∏è First</button>
                        <button class="btn btn-secondary" onclick="loadTableRecordsForManagement(${pagination.current_page - 1}, currentSearchTerm)" ${pagination.current_page === 1 ? 'disabled' : ''}>‚óÄÔ∏è Prev</button>
                        <span style="padding: 0 15px;">Page ${pagination.current_page} of ${pagination.total_pages}</span>
                        <button class="btn btn-secondary" onclick="loadTableRecordsForManagement(${pagination.current_page + 1}, currentSearchTerm)" ${pagination.current_page === pagination.total_pages ? 'disabled' : ''}>Next ‚ñ∂Ô∏è</button>
                        <button class="btn btn-secondary" onclick="loadTableRecordsForManagement(${pagination.total_pages}, currentSearchTerm)" ${pagination.current_page === pagination.total_pages ? 'disabled' : ''}>Last ‚è≠Ô∏è</button>
                    </div>
                </div>
            `;
            document.getElementById('dataPagination').innerHTML = html;
        }

        // Instant search (real-time)
        let searchTimeout = null;
        function searchTableRecordsInstant() {
            // Clear previous timeout
            if (searchTimeout) {
                clearTimeout(searchTimeout);
            }

            const searchInput = document.getElementById('dataSearchInput');
            const searchTerm = searchInput.value.trim();
            const statusEl = document.getElementById('searchStatus');

            if (searchTerm) {
                statusEl.textContent = 'üîç Searching...';
            } else {
                statusEl.textContent = '';
            }

            // Debounce search (wait 300ms after user stops typing)
            searchTimeout = setTimeout(() => {
                loadTableRecordsForManagement(1, searchTerm);
                if (searchTerm) {
                    statusEl.textContent = `üîç Search results for: "${searchTerm}"`;
                } else {
                    statusEl.textContent = '';
                }
            }, 300);
        }

        // Search table records (button click)
        function searchTableRecords() {
            const searchTerm = document.getElementById('dataSearchInput').value.trim();
            loadTableRecordsForManagement(1, searchTerm);
        }

        // Clear search
        function clearSearch() {
            document.getElementById('dataSearchInput').value = '';
            document.getElementById('searchStatus').textContent = '';
            loadTableRecordsForManagement(1, '');
        }

        // Show record form (add or edit)
        function showRecordForm(mode, record = null) {
            currentRecordFormMode = mode;
            currentEditingRecord = record;

            if (mode === 'add') {
                document.getElementById('recordFormTitle').textContent = `Add New Record to ${currentEditTableName}`;
                document.getElementById('recordFormSaveIcon').textContent = '‚ûï';
                document.getElementById('recordFormSaveText').textContent = 'Add Record';
            } else {
                document.getElementById('recordFormTitle').textContent = `Edit Record in ${currentEditTableName}`;
                document.getElementById('recordFormSaveIcon').textContent = 'üíæ';
                document.getElementById('recordFormSaveText').textContent = 'Update Record';
            }

            // Generate form fields dynamically
            let formHtml = '';
            
            // Add hidden field for identifier in edit mode
            if (mode === 'edit') {
                const identifierKey = currentEditTablePrimaryKey || (currentEditTableColumns.length > 0 ? currentEditTableColumns[0].Field : null);
                const identifierValue = identifierKey && record ? record[identifierKey] : '';
                if (identifierKey) {
                    formHtml += `<input type="hidden" id="recordIdentifierKey" value="${identifierKey}">`;
                    formHtml += `<input type="hidden" id="recordIdentifierValue" value="${identifierValue}">`;
                }
            }

            currentEditTableColumns.forEach(col => {
                const isAutoIncrement = col.Extra && col.Extra.toLowerCase().includes('auto_increment');
                const value = record ? record[col.Field] : '';
                
                // Skip auto increment in add mode
                if (mode === 'add' && isAutoIncrement) {
                    return;
                }

                // Determine identifier (PK or first column)
                const identifierKey = currentEditTablePrimaryKey || (currentEditTableColumns.length > 0 ? currentEditTableColumns[0].Field : null);
                
                // Read-only for identifier in edit mode ONLY if it's auto-increment
                const isReadOnly = mode === 'edit' && col.Field === identifierKey && isAutoIncrement;

                formHtml += `
                    <div class="form-group">
                        <label class="form-label">
                            ${col.Field}
                            ${col.Key === 'PRI' ? ' üîë' : ''}
                            ${col.Field === identifierKey && mode === 'edit' ? ' <span style="color: #3b82f6;">(Identifier)</span>' : ''}
                            ${col.Null === 'NO' && !isAutoIncrement ? ' <span style="color: #ef4444;">*</span>' : ''}
                        </label>
                        ${generateFormInput(col, value, isReadOnly)}
                        <div class="helper-text">${col.Type}${col.Null === 'YES' ? ' (Optional)' : col.Null === 'NO' && !isAutoIncrement ? ' (Required)' : ''}</div>
                    </div>
                `;
            });

            document.getElementById('recordFormFields').innerHTML = formHtml;
            document.getElementById('recordFormMessage').innerHTML = '';
            document.getElementById('recordFormModal').classList.add('active');
        }

        // Generate form input based on column type
        function generateFormInput(col, value, isReadOnly) {
            const typeUpper = col.Type.toUpperCase();
            const required = col.Null === 'NO' && !col.Extra?.includes('auto_increment') ? 'required' : '';
            const readonlyAttr = isReadOnly ? 'readonly' : '';
            const readonlyStyle = isReadOnly ? 'style="background: rgba(255, 255, 255, 0.05); cursor: not-allowed;"' : '';
            
            // TEXT/LONGTEXT
            if (typeUpper.includes('TEXT') && !typeUpper.includes('TINY')) {
                return `<textarea name="${col.Field}" class="form-input" rows="4" ${required} ${readonlyAttr} ${readonlyStyle}>${value || ''}</textarea>`;
            }
            
            // DATE
            if (typeUpper.includes('DATE') && !typeUpper.includes('TIME')) {
                return `<input type="date" name="${col.Field}" class="form-input" value="${value || ''}" ${required} ${readonlyAttr} ${readonlyStyle}>`;
            }
            
            // DATETIME/TIMESTAMP
            if (typeUpper.includes('DATETIME') || typeUpper.includes('TIMESTAMP')) {
                const datetimeValue = value ? value.replace(' ', 'T').slice(0, 16) : '';
                return `<input type="datetime-local" name="${col.Field}" class="form-input" value="${datetimeValue}" ${required} ${readonlyAttr} ${readonlyStyle}>`;
            }
            
            // TIME
            if (typeUpper.includes('TIME') && !typeUpper.includes('DATE')) {
                return `<input type="time" name="${col.Field}" class="form-input" value="${value || ''}" ${required} ${readonlyAttr} ${readonlyStyle}>`;
            }
            
            // BOOLEAN/TINYINT(1)
            if (typeUpper.includes('TINYINT(1)') || typeUpper.includes('BOOLEAN') || typeUpper.includes('BOOL')) {
                return `
                    <select name="${col.Field}" class="form-select" ${required} ${readonlyAttr} ${readonlyStyle}>
                        <option value="">-- Select --</option>
                        <option value="1" ${value == 1 ? 'selected' : ''}>‚úÖ True (1)</option>
                        <option value="0" ${value == 0 ? 'selected' : ''}>‚ùå False (0)</option>
                    </select>
                `;
            }
            
            // INT/DECIMAL/FLOAT - use number input
            if (typeUpper.includes('INT') || typeUpper.includes('DECIMAL') || typeUpper.includes('FLOAT') || typeUpper.includes('DOUBLE')) {
                const step = typeUpper.includes('DECIMAL') || typeUpper.includes('FLOAT') || typeUpper.includes('DOUBLE') ? '0.01' : '1';
                return `<input type="number" name="${col.Field}" class="form-input" value="${value || ''}" step="${step}" ${required} ${readonlyAttr} ${readonlyStyle}>`;
            }
            
            // Default: text input
            return `<input type="text" name="${col.Field}" class="form-input" value="${value || ''}" ${required} ${readonlyAttr} ${readonlyStyle}>`;
        }

        // Edit record
        function editRecord(record) {
            showRecordForm('edit', record);
        }

        // Close record form
        function closeRecordForm() {
            document.getElementById('recordFormModal').classList.remove('active');
            currentRecordFormMode = 'add';
            currentEditingRecord = null;
        }

        // Save record (add or update)
        async function saveRecord(event) {
            event.preventDefault();

            if (!selectedDatabaseId || !currentEditTableName) {
                showMessage('editTableMessage', '‚ùå No table selected', 'error');
                return;
            }

            const connId = selectedDatabaseId.replace('conn_', '');
            const connections = getHostingerConnections();
            const conn = connections.find(c => c.id === connId);
            
            if (!conn) {
                showMessage('editTableMessage', '‚ùå Connection not found', 'error');
                return;
            }

            // Get form data
            const formData = new FormData(document.getElementById('recordForm'));
            const recordData = {};
            for (const [key, value] of formData.entries()) {
                recordData[key] = value || null;
            }

            const messageEl = document.getElementById('recordFormMessage');

            if (currentRecordFormMode === 'add') {
                // Insert new record
                messageEl.className = 'message info';
                messageEl.textContent = 'üîÑ Adding record...';
                messageEl.style.display = 'block';

                const result = await apiRequest('insert_record', {
                    db_host: conn.host,
                    db_name: conn.dbName,
                    db_user: conn.username,
                    db_pass: conn.password,
                    db_port: conn.port,
                    table_name: currentEditTableName,
                    record_data: JSON.stringify(recordData)
                });

                if (result.success) {
                    showMessage('editTableMessage', `‚úÖ ${result.message}`, 'success');
                    closeRecordForm();
                    loadTableRecordsForManagement(currentDataPage, currentSearchTerm);
                } else {
                    messageEl.className = 'message error';
                    messageEl.textContent = `‚ùå ${result.message}`;
                }
            } else {
                // Update existing record
                if (!currentEditingRecord) {
                    messageEl.className = 'message error';
                    messageEl.textContent = '‚ùå Cannot update: No record data';
                    return;
                }

                messageEl.className = 'message info';
                messageEl.textContent = 'üîÑ Updating record...';
                messageEl.style.display = 'block';

                // Determine identifier (Primary Key or first column)
                let identifierKey = currentEditTablePrimaryKey;
                let identifierValue = currentEditTablePrimaryKey ? currentEditingRecord[currentEditTablePrimaryKey] : null;

                // Fallback: use first column as identifier
                if (!identifierValue && currentEditTableColumns.length > 0) {
                    identifierKey = currentEditTableColumns[0].Field;
                    identifierValue = currentEditingRecord[identifierKey];
                }

                if (!identifierValue) {
                    messageEl.className = 'message error';
                    messageEl.textContent = '‚ùå Cannot update: No identifier found';
                    return;
                }

                const result = await apiRequest('update_record', {
                    db_host: conn.host,
                    db_name: conn.dbName,
                    db_user: conn.username,
                    db_pass: conn.password,
                    db_port: conn.port,
                    table_name: currentEditTableName,
                    record_data: JSON.stringify(recordData),
                    primary_key: identifierKey,
                    primary_value: identifierValue
                });

                if (result.success) {
                    showMessage('editTableMessage', `‚úÖ ${result.message}`, 'success');
                    closeRecordForm();
                    loadTableRecordsForManagement(currentDataPage, currentSearchTerm);
                } else {
                    messageEl.className = 'message error';
                    messageEl.textContent = `‚ùå ${result.message}`;
                }
            }
        }

        // Delete record action
        async function deleteRecordAction(primaryValue) {
            if (!confirm('Are you sure you want to delete this record?\n\nThis action cannot be undone!')) {
                return;
            }

            if (!selectedDatabaseId || !currentEditTableName || !currentEditTablePrimaryKey) {
                showMessage('editTableMessage', '‚ùå Cannot delete: Missing information', 'error');
                return;
            }

            const connId = selectedDatabaseId.replace('conn_', '');
            const connections = getHostingerConnections();
            const conn = connections.find(c => c.id === connId);
            
            if (!conn) return;

            showMessage('editTableMessage', 'üîÑ Deleting record...', 'info');

            const result = await apiRequest('delete_record', {
                db_host: conn.host,
                db_name: conn.dbName,
                db_user: conn.username,
                db_pass: conn.password,
                db_port: conn.port,
                table_name: currentEditTableName,
                primary_key: currentEditTablePrimaryKey,
                primary_value: primaryValue
            });

            if (result.success) {
                showMessage('editTableMessage', `‚úÖ ${result.message}`, 'success');
                loadTableRecordsForManagement(currentDataPage, currentSearchTerm);
            } else {
                showMessage('editTableMessage', `‚ùå ${result.message}`, 'error');
            }
        }

        // Generate Table Info for AI
        async function generateTableInfo() {
            if (!selectedDatabaseId || !currentEditTableName) {
                document.getElementById('tableInfoText').value = 'Please select a table first...';
                return;
            }

            const connId = selectedDatabaseId.replace('conn_', '');
            const connections = getHostingerConnections();
            const conn = connections.find(c => c.id === connId);
            
            if (!conn) {
                document.getElementById('tableInfoText').value = 'Connection not found...';
                return;
            }

            // Show loading
            document.getElementById('tableInfoLoading').style.display = 'block';
            document.getElementById('tableInfoText').value = 'Analyzing table structure...';

            // Get table data with info
            const dataResult = await apiRequest('get_table_data', {
                db_host: conn.host,
                db_name: conn.dbName,
                db_user: conn.username,
                db_pass: conn.password,
                db_port: conn.port,
                table_name: currentEditTableName,
                page: 1,
                limit: 5  // Get first 5 rows as sample
            });

            if (!dataResult.success) {
                document.getElementById('tableInfoLoading').style.display = 'none';
                document.getElementById('tableInfoText').value = `Error: ${dataResult.message}`;
                return;
            }

            // Build table info description
            const info = dataResult.table_info;
            const pagination = dataResult.pagination;
            const columns = dataResult.columns;
            const sampleData = dataResult.data;

            let description = `TABLE INFORMATION FOR AI
=====================================

Database: ${conn.dbName}
Table Name: ${currentEditTableName}
Connection: ${conn.name}

TABLE OVERVIEW:
- Total Records: ${pagination.total_rows.toLocaleString()} rows
- Total Columns: ${columns.length}
- Engine: ${info.engine}
- Collation: ${info.collation}
- Data Size: ${formatBytes(info.data_length)}
- Average Row Length: ${info.avg_row_length} bytes
${info.created ? `- Created: ${new Date(info.created).toLocaleString()}` : ''}
${info.updated ? `- Last Updated: ${new Date(info.updated).toLocaleString()}` : ''}

COLUMN STRUCTURE:
${'='.repeat(60)}

`;

            // List all columns with details
            columns.forEach((col, idx) => {
                description += `${idx + 1}. ${col.Field}\n`;
                description += `   Type: ${col.Type}\n`;
                description += `   Nullable: ${col.Null}\n`;
                if (col.Key) {
                    let keyType = '';
                    if (col.Key === 'PRI') keyType = 'PRIMARY KEY';
                    else if (col.Key === 'UNI') keyType = 'UNIQUE';
                    else if (col.Key === 'MUL') keyType = 'INDEX';
                    description += `   Key: ${keyType}\n`;
                }
                if (col.Default !== null) description += `   Default: ${col.Default}\n`;
                if (col.Extra) description += `   Extra: ${col.Extra}\n`;
                description += `\n`;
            });

            // Sample data (first 5 rows)
            if (sampleData.length > 0) {
                description += `\nSAMPLE DATA (First ${sampleData.length} rows):\n`;
                description += `${'='.repeat(60)}\n\n`;
                
                sampleData.forEach((row, idx) => {
                    description += `Record ${idx + 1}:\n`;
                    columns.forEach(col => {
                        const value = row[col.Field];
                        const displayValue = value === null ? 'NULL' : 
                                           typeof value === 'string' && value.length > 100 ? value.substring(0, 100) + '...' : 
                                           value;
                        description += `  ${col.Field}: ${displayValue}\n`;
                    });
                    description += `\n`;
                });
            }

            description += `\nDATA STATISTICS:\n`;
            description += `${'='.repeat(60)}\n`;
            description += `- Total Rows: ${pagination.total_rows.toLocaleString()}\n`;
            description += `- Table Size: ${formatBytes(info.data_length)}\n`;
            description += `- Average Row Size: ${info.avg_row_length} bytes\n`;
            description += `- Estimated Total Size: ${formatBytes(info.data_length)}\n\n`;

            description += `COLUMN SUMMARY:\n`;
            description += `- Total Columns: ${columns.length}\n`;
            
            // Count column types
            const primaryKeys = columns.filter(c => c.Key === 'PRI').map(c => c.Field);
            const uniqueKeys = columns.filter(c => c.Key === 'UNI').map(c => c.Field);
            const requiredCols = columns.filter(c => c.Null === 'NO').length;
            const autoIncrementCols = columns.filter(c => c.Extra && c.Extra.includes('auto_increment')).map(c => c.Field);
            
            if (primaryKeys.length > 0) description += `- Primary Keys: ${primaryKeys.join(', ')}\n`;
            if (uniqueKeys.length > 0) description += `- Unique Keys: ${uniqueKeys.join(', ')}\n`;
            if (autoIncrementCols.length > 0) description += `- Auto Increment: ${autoIncrementCols.join(', ')}\n`;
            description += `- Required Fields: ${requiredCols} columns\n`;
            description += `- Optional Fields: ${columns.length - requiredCols} columns\n\n`;

            description += `RECOMMENDATIONS FOR AI:\n`;
            description += `- Use column names exactly as shown above\n`;
            description += `- Respect NOT NULL constraints\n`;
            description += `- Auto-increment columns should not be included in INSERT statements\n`;
            description += `- Primary key is: ${primaryKeys.length > 0 ? primaryKeys[0] : 'Not defined'}\n`;
            description += `- Consider data types when generating INSERT/UPDATE queries\n`;
            description += `- Sample data above shows actual data patterns in this table\n`;

            // Set the description
            document.getElementById('tableInfoText').value = description;
            document.getElementById('tableInfoLoading').style.display = 'none';
        }

        // Copy Table Info to clipboard
        async function copyTableInfo() {
            const infoText = document.getElementById('tableInfoText').value;
            
            try {
                await navigator.clipboard.writeText(infoText);
                showMessage('editTableMessage', '‚úÖ Table information copied to clipboard!', 'success');
                
                // Visual feedback
                const btns = document.querySelectorAll('#editTableInfoTab .btn-primary');
                btns.forEach(btn => {
                    if (btn.textContent.includes('Copy')) {
                        const originalHtml = btn.innerHTML;
                        btn.innerHTML = '<span>‚úÖ</span> Copied!';
                        btn.style.background = '#22c55e';
                        
                        setTimeout(() => {
                            btn.innerHTML = originalHtml;
                            btn.style.background = '';
                        }, 2000);
                    }
                });
            } catch (err) {
                // Fallback
                const textarea = document.getElementById('tableInfoText');
                textarea.select();
                document.execCommand('copy');
                showMessage('editTableMessage', '‚úÖ Table information copied to clipboard!', 'success');
            }
        }

        // Add column to existing table
        async function addColumn() {
            if (!currentEditTableName || !selectedDatabaseId) {
                showMessage('editTableMessage', '‚ùå Please select a table first', 'error');
                return;
            }

            const connId = selectedDatabaseId.replace('conn_', '');
            const connections = getHostingerConnections();
            const conn = connections.find(c => c.id === connId);
            
            if (!conn) {
                showMessage('editTableMessage', '‚ùå Connection not found', 'error');
                return;
            }
            
            const columnData = {
                name: document.getElementById('newColName').value.trim(),
                type: document.getElementById('newColType').value,
                length: document.getElementById('newColLength').value.trim(),
                nullable: document.getElementById('newColNullable').value,
                defaultValue: document.getElementById('newColDefault').value.trim()
            };
            
            if (!columnData.name) {
                showMessage('editTableMessage', '‚ùå Please enter a column name', 'error');
                return;
            }
            
            showMessage('editTableMessage', 'üîÑ Adding column...', 'info');
            
            const result = await apiRequest('alter_table', {
                db_host: conn.host,
                db_name: conn.dbName,
                db_user: conn.username,
                db_pass: conn.password,
                db_port: conn.port,
                table_name: currentEditTableName,
                alter_action: 'add',
                column_data: JSON.stringify(columnData)
            });
            
            if (result.success) {
                showMessage('editTableMessage', `‚úÖ ${result.message}`, 'success');
                document.getElementById('newColName').value = '';
                document.getElementById('newColLength').value = '';
                document.getElementById('newColDefault').value = '';
                // Reload table to refresh structure
                loadTableForEditing();
            } else {
                showMessage('editTableMessage', `‚ùå ${result.message}`, 'error');
            }
        }

        // Drop column from table
        async function dropColumn(tableName, columnName) {
            if (!confirm(`Are you sure you want to drop column "${columnName}" from table "${tableName}"?\n\nThis action cannot be undone!`)) {
                return;
            }

            if (!selectedDatabaseId) {
                showMessage('editTableMessage', '‚ùå No database selected', 'error');
                return;
            }

            const connId = selectedDatabaseId.replace('conn_', '');
            const connections = getHostingerConnections();
            const conn = connections.find(c => c.id === connId);
            
            if (!conn) {
                showMessage('editTableMessage', '‚ùå Connection not found', 'error');
                return;
            }
            
            showMessage('editTableMessage', 'üîÑ Dropping column...', 'info');
            
            const result = await apiRequest('alter_table', {
                db_host: conn.host,
                db_name: conn.dbName,
                db_user: conn.username,
                db_pass: conn.password,
                db_port: conn.port,
                table_name: tableName,
                alter_action: 'drop',
                column_data: JSON.stringify({ name: columnName })
            });
            
            if (result.success) {
                showMessage('editTableMessage', `‚úÖ ${result.message}`, 'success');
                // Reload table to refresh structure
                loadTableForEditing();
            } else {
                showMessage('editTableMessage', `‚ùå ${result.message}`, 'error');
            }
        }

        // Initialize column builder on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Add initial column row
            addColumnRow();
        });

        // ========================================
        // EXPORT/IMPORT CONNECTIONS FUNCTIONS
        // ========================================

        const PREFERRED_EXPORT_PATH_KEY = 'preferred_export_path';

        // Export connections to file (Direct Download)
        async function exportConnectionsToFile() {
            const connections = getHostingerConnections();
            
            if (connections.length === 0) {
                showMessage('settingsMessage', '‚ùå No connections to export', 'error');
                return;
            }

            showMessage('settingsMessage', 'üîÑ Preparing export...', 'info');

            // Create export data
            const exportData = {
                exported_at: new Date().toLocaleString(),
                total_connections: connections.length,
                connections: connections
            };

            // Generate filename with timestamp
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);
            const filename = `hostinger_connections_${timestamp}.json`;
            
            // Convert to JSON
            const jsonData = JSON.stringify(exportData, null, 2);
            const blob = new Blob([jsonData], { type: 'application/json' });

            // Check if File System Access API is supported
            if ('showSaveFilePicker' in window) {
                try {
                    // Get preferred directory from localStorage
                    const preferredPath = localStorage.getItem(PREFERRED_EXPORT_PATH_KEY);
                    
                    const options = {
                        suggestedName: filename,
                        types: [{
                            description: 'JSON Files',
                            accept: { 'application/json': ['.json'] }
                        }]
                    };

                    // Show file picker
                    const fileHandle = await window.showSaveFilePicker(options);
                    
                    // Write file
                    const writable = await fileHandle.createWritable();
                    await writable.write(blob);
                    await writable.close();

                    // Save the directory path for next time (if possible)
                    try {
                        const dirHandle = await fileHandle.getParent?.();
                        if (dirHandle) {
                            localStorage.setItem(PREFERRED_EXPORT_PATH_KEY, dirHandle.name);
                        }
                    } catch (e) {
                        // Ignore if getParent is not supported
                    }

                    showMessage('settingsMessage', 
                        `‚úÖ Connections exported successfully!\nüìÅ File: ${filename}\nüìä Total: ${connections.length} connections`, 
                        'success'
                    );
                } catch (error) {
                    if (error.name !== 'AbortError') {
                        // Fallback to download if user didn't cancel
                        downloadFile(blob, filename);
                        showMessage('settingsMessage', 
                            `‚úÖ Export started! Check your downloads folder.\nüìÅ File: ${filename}\nüìä Total: ${connections.length} connections`, 
                            'success'
                        );
                    }
                }
            } else {
                // Fallback: Direct download
                downloadFile(blob, filename);
                showMessage('settingsMessage', 
                    `‚úÖ Export started! Check your downloads folder.\nüìÅ File: ${filename}\nüìä Total: ${connections.length} connections`, 
                    'success'
                );
            }
        }

        // Helper function to download file
        function downloadFile(blob, filename) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Import connections using File Picker
        async function showImportModal() {
            // Check if File System Access API is supported
            if ('showOpenFilePicker' in window) {
                importConnectionsWithFilePicker();
            } else {
                // Fallback: Use hidden input file
                importConnectionsWithInputFile();
            }
        }

        // Import using File System Access API
        async function importConnectionsWithFilePicker() {
            try {
                const options = {
                    types: [{
                        description: 'JSON Files',
                        accept: { 'application/json': ['.json'] }
                    }],
                    multiple: false
                };

                showMessage('settingsMessage', 'üìÇ Opening file picker...', 'info');

                const [fileHandle] = await window.showOpenFilePicker(options);
                const file = await fileHandle.getFile();
                
                await processImportFile(file);
            } catch (error) {
                if (error.name !== 'AbortError') {
                    showMessage('settingsMessage', `‚ùå Error: ${error.message}`, 'error');
                }
            }
        }

        // Import using traditional input file (fallback)
        function importConnectionsWithInputFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json,application/json';
            
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (file) {
                    await processImportFile(file);
                }
            };
            
            input.click();
        }

        // Process the imported file
        async function processImportFile(file) {
            try {
                showMessage('settingsMessage', `üîÑ Reading file: ${file.name}...`, 'info');

                const text = await file.text();
                const importData = JSON.parse(text);

                // Validate structure
                if (!importData.connections || !Array.isArray(importData.connections)) {
                    showMessage('settingsMessage', '‚ùå Invalid file format. Expected connections array.', 'error');
                    return;
                }

                // Confirm import
                if (!confirm(`Import ${importData.connections.length} connections from:\n${file.name}\n\nThis will MERGE with your existing connections. Continue?`)) {
                    return;
                }

                showMessage('settingsMessage', 'üîÑ Importing connections...', 'info');

                // Get current connections
                let currentConnections = getHostingerConnections();
                const importedConnections = importData.connections;

                // Merge strategy: Update existing by ID or add new
                let updatedCount = 0;
                let addedCount = 0;

                importedConnections.forEach(imported => {
                    const existingIndex = currentConnections.findIndex(c => c.id === imported.id);
                    if (existingIndex !== -1) {
                        // Update existing
                        currentConnections[existingIndex] = imported;
                        updatedCount++;
                    } else {
                        // Add new
                        currentConnections.push(imported);
                        addedCount++;
                    }
                });

                // Save merged connections
                saveHostingerConnections(currentConnections);

                // Refresh UI
                loadHostingerConnectionsTable();
                loadDashboardConnections();

                showMessage('settingsMessage', 
                    `‚úÖ Import successful!\nüìä Total: ${importData.connections.length}\n‚úèÔ∏è Updated: ${updatedCount}\n‚ûï Added: ${addedCount}\nüìÖ Exported: ${importData.exported_at || 'Unknown'}`, 
                    'success'
                );
            } catch (error) {
                showMessage('settingsMessage', `‚ùå Import failed: ${error.message}`, 'error');
            }
        }

        // Close import modal (not needed anymore but keeping for compatibility)
        function closeImportModal() {
            const modal = document.getElementById('importModal');
            if (modal) {
                modal.classList.remove('active');
            }
        }
    </script>
</body>
</html>




