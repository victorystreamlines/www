<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cursor Ultra Usage Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        accent: '#8B5CF6',
                        danger: '#EF4444',
                        warning: '#F59E0B',
                        dark: '#1F2937',
                        light: '#F9FAFB'
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            direction: ltr;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .card-shadow {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .progress-bar {
            transition: width 0.5s ease-in-out;
        }
        
        .model-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .model-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }
        
        .usage-input {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .usage-input:focus {
            border-color: #3B82F6;
            background: white;
        }
        
        .animate-pulse-soft {
            animation: pulse-soft 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse-soft {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 min-h-screen">
    
    <!-- Header -->
    <header class="gradient-bg text-white py-8 mb-8">
        <div class="max-w-6xl mx-auto px-6">
            <h1 class="text-4xl font-bold text-center mb-2">🚀 Cursor Ultra Usage Report</h1>
            <p class="text-xl text-center opacity-90">Smart AI Usage Monitoring & Analytics Dashboard</p>
        </div>
    </header>

    <div class="max-w-6xl mx-auto px-6 pb-12">
        
        <!-- Data Input Section -->
        <div class="bg-white rounded-2xl card-shadow p-8 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <span class="bg-primary text-white w-8 h-8 rounded-full flex items-center justify-center mr-3 text-sm">📊</span>
                Paste Your Usage Data Here
            </h2>
            
            <div class="space-y-4">
                <label class="block text-gray-700 font-medium">Paste your latest Cursor usage data to generate a fresh report:</label>
                <textarea 
                    id="usageData" 
                    class="usage-input w-full h-48 p-4 rounded-lg resize-y border-2 border-gray-200 focus:border-blue-500"
                    placeholder="Copy and paste your usage data from Cursor here...

Example format:
Current billing period: Jul 24, 2025 - Aug 24, 2025
MODEL    INPUT    OUTPUT    TOTAL TOKENS    API COST
claude-4-sonnet    23,609,414    3,183,225    294,669,855    $210.43
...

You can find this data in Cursor -> Settings -> Usage"></textarea>
                
                <div class="flex gap-4 flex-wrap">
                    <button 
                        onclick="generateReport()" 
                        class="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-8 py-3 rounded-lg font-medium transition-all duration-200 flex items-center gap-2 shadow-lg">
                        <span>🚀</span> Generate Report
                    </button>
                    
                    <button 
                        onclick="clearData()" 
                        class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-all duration-200 flex items-center gap-2">
                        <span>🗑️</span> Clear
                    </button>
                    
                    <button 
                        onclick="loadSampleData()" 
                        class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-6 py-3 rounded-lg font-medium transition-all duration-200 flex items-center gap-2">
                        <span>📈</span> Load Sample Data
                    </button>
                    
                    <button 
                        onclick="exportReport()" 
                        class="bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white px-6 py-3 rounded-lg font-medium transition-all duration-200 flex items-center gap-2">
                        <span>📥</span> Export Report
                    </button>
                </div>
                
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <h3 class="font-semibold text-blue-800 mb-2">💡 How to get your usage data:</h3>
                    <ol class="text-sm text-blue-700 space-y-1">
                        <li>1. Open Cursor IDE</li>
                        <li>2. Go to Settings (Ctrl/Cmd + ,)</li>
                        <li>3. Navigate to Usage section</li>
                        <li>4. Copy the entire usage table</li>
                        <li>5. Paste it in the textarea above and click "Generate Report"</li>
                    </ol>
                </div>
            </div>
        </div>

        <!-- Report Section -->
        <div id="reportSection" class="space-y-8">
            
            <!-- Billing Period & Summary -->
            <div class="bg-white rounded-2xl card-shadow p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <span class="bg-secondary text-white w-8 h-8 rounded-full flex items-center justify-center mr-3 text-sm">📅</span>
                    Billing Period & Usage Summary
                </h2>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-xl">
                        <h3 class="font-semibold text-gray-700 mb-2">📅 Current Billing Period</h3>
                        <p id="billingPeriod" class="text-lg font-bold text-primary">Jul 24, 2025 - Aug 24, 2025</p>
                    </div>
                    
                    <div class="bg-gradient-to-r from-green-50 to-emerald-50 p-6 rounded-xl">
                        <h3 class="font-semibold text-gray-700 mb-2">💰 Monthly Included Usage</h3>
                        <p class="text-lg font-bold text-secondary">$400+ USD Monthly</p>
                        <p class="text-sm text-gray-500 mt-2">Report generated: <span id="reportTimestamp"></span></p>
                    </div>
                </div>
            </div>

            <!-- Total Usage Overview -->
            <div class="bg-white rounded-2xl card-shadow p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <span class="bg-accent text-white w-8 h-8 rounded-full flex items-center justify-center mr-3 text-sm">💰</span>
                    Total Usage Overview
                </h2>
                
                <div class="grid lg:grid-cols-2 gap-8">
                    <!-- Cost Progress -->
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <h3 class="font-semibold text-gray-700">💸 Total API Cost</h3>
                            <span id="totalCost" class="text-2xl font-bold text-primary">$423.22</span>
                        </div>
                        
                        <div class="w-full bg-gray-200 rounded-full h-6">
                            <div id="costProgress" class="progress-bar bg-gradient-to-r from-primary to-purple-500 h-6 rounded-full relative">
                                <div class="absolute inset-0 flex items-center justify-center text-white text-sm font-medium">
                                    <span id="costPercentage">105.8%</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex justify-between text-sm text-gray-600">
                            <span>$0</span>
                            <span>Limit: $400</span>
                            <span id="costOverage" class="text-red-600 font-medium">+$23.22 Free</span>
                        </div>
                    </div>
                    
                    <!-- Tokens Progress -->
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <h3 class="font-semibold text-gray-700">🔢 Total Tokens</h3>
                            <span id="totalTokens" class="text-2xl font-bold text-secondary">591.78M</span>
                        </div>
                        
                        <div class="w-full bg-gray-200 rounded-full h-6">
                            <div id="tokensProgress" class="progress-bar bg-gradient-to-r from-secondary to-green-400 h-6 rounded-full relative">
                                <div class="absolute inset-0 flex items-center justify-center text-white text-sm font-medium">
                                    <span id="tokensPercentage">100%</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-center text-sm text-gray-600">
                            <span>🎯 Ultra Plan: Unlimited Tokens</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Models Breakdown -->
            <div class="bg-white rounded-2xl card-shadow p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <span class="bg-warning text-white w-8 h-8 rounded-full flex items-center justify-center mr-3 text-sm">🤖</span>
                    AI Models Usage Breakdown
                </h2>
                
                <div id="modelsGrid" class="grid lg:grid-cols-2 xl:grid-cols-3 gap-6">
                    <!-- Models will be populated by JavaScript -->
                </div>
            </div>

            <!-- Detailed Usage Table -->
            <div class="bg-white rounded-2xl card-shadow p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <span class="bg-danger text-white w-8 h-8 rounded-full flex items-center justify-center mr-3 text-sm">📊</span>
                    Detailed Usage Table
                </h2>
                
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="border border-gray-200 px-4 py-3 text-right font-semibold">MODEL</th>
                                <th class="border border-gray-200 px-4 py-3 text-center font-semibold">INPUT (W/ CACHE)</th>
                                <th class="border border-gray-200 px-4 py-3 text-center font-semibold">INPUT (W/O CACHE)</th>
                                <th class="border border-gray-200 px-4 py-3 text-center font-semibold">CACHE READ</th>
                                <th class="border border-gray-200 px-4 py-3 text-center font-semibold">OUTPUT</th>
                                <th class="border border-gray-200 px-4 py-3 text-center font-semibold">TOTAL TOKENS</th>
                                <th class="border border-gray-200 px-4 py-3 text-center font-semibold">API COST</th>
                                <th class="border border-gray-200 px-4 py-3 text-center font-semibold">COST TO YOU</th>
                            </tr>
                        </thead>
                        <tbody id="usageTableBody">
                            <!-- Table rows will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Additional Insights -->
            <div class="bg-white rounded-2xl card-shadow p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <span class="bg-indigo-500 text-white w-8 h-8 rounded-full flex items-center justify-center mr-3 text-sm">💡</span>
                    Key Insights & Analytics
                </h2>
                
                <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 p-6 rounded-xl text-center">
                        <div class="text-3xl mb-2">🎯</div>
                        <div class="text-sm text-gray-600 mb-1">Most Used Model</div>
                        <div id="topModel" class="font-bold text-primary">Claude-4-Sonnet</div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-green-50 to-green-100 p-6 rounded-xl text-center">
                        <div class="text-3xl mb-2">💰</div>
                        <div class="text-sm text-gray-600 mb-1">Cost Efficiency</div>
                        <div class="font-bold text-secondary">100% FREE</div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-purple-50 to-purple-100 p-6 rounded-xl text-center">
                        <div class="text-3xl mb-2">🚀</div>
                        <div class="text-sm text-gray-600 mb-1">Cache Hit Rate</div>
                        <div id="cacheRate" class="font-bold text-accent">87.8%</div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-yellow-50 to-yellow-100 p-6 rounded-xl text-center">
                        <div class="text-3xl mb-2">⚡</div>
                        <div class="text-sm text-gray-600 mb-1">Daily Average</div>
                        <div id="dailyAverage" class="font-bold text-warning">$13.65</div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Sample data for demonstration
        const sampleData = `Current billing period: Jul 24, 2025 - Aug 24, 2025

Ultra comes with at least $400 of included usage per month. We work closely with the model providers to make this monthly allotment as high as possible. You'll be notified in-app when you're nearing your monthly limit.

During the promotional release period, initial GPT-5 usage does not count towards usage limits.

MODEL	INPUT (W/ CACHE WRITE)	INPUT (W/O CACHE WRITE)	CACHE READ	OUTPUT	TOTAL TOKENS	API COST	COST TO YOU
claude-4-sonnet
23,609,414	10,695,712	257,181,504	3,183,225	294,669,855	$210.43	$0
claude-4-sonnet-thinking
22,427,757	5,635,021	256,448,094	2,974,750	287,485,622	$203.39	$0
gpt-5
0	2,318,759	1,066,985	60,359	3,446,103	$3.64	$0
claude-4.1-opus
61,624	299	595,398	10,833	668,154	$3.44	$0
auto
591,862	171,573	4,712,251	31,513	5,507,199	$2.32	$0
Total	46,690,657	18,821,364	520,004,232	6,260,680	591,776,933	$423.22	$0`;

        // Load sample data
        function loadSampleData() {
            document.getElementById('usageData').value = sampleData;
            generateReport();
        }

        // Clear data
        function clearData() {
            document.getElementById('usageData').value = '';
            // Clear all displays
            document.getElementById('totalCost').textContent = '$0.00';
            document.getElementById('totalTokens').textContent = '0';
            document.getElementById('modelsGrid').innerHTML = '';
            document.getElementById('usageTableBody').innerHTML = '';
        }

        // Parse usage data
        function parseUsageData(data) {
            const lines = data.split('\n').filter(line => line.trim());
            const models = [];
            let totalCost = 0;
            let totalTokens = 0;
            let billingPeriod = '';

            // Extract billing period
            const periodMatch = data.match(/Current billing period: (.+)/);
            if (periodMatch) {
                billingPeriod = periodMatch[1];
            }

            // Find the table start
            let tableStartIndex = -1;
            for (let i = 0; i < lines.length; i++) {
                if (lines[i].includes('MODEL') && lines[i].includes('INPUT') && lines[i].includes('OUTPUT')) {
                    tableStartIndex = i + 1;
                    break;
                }
            }

            if (tableStartIndex === -1) return { models, totalCost, totalTokens, billingPeriod };

            // Parse model data
            for (let i = tableStartIndex; i < lines.length; i++) {
                const line = lines[i].trim();
                if (line === '' || line.startsWith('Total')) {
                    if (line.startsWith('Total')) {
                        // Parse totals
                        const parts = line.split('\t');
                        if (parts.length >= 7) {
                            totalTokens = parseInt(parts[5].replace(/,/g, ''));
                            totalCost = parseFloat(parts[6].replace('$', ''));
                        }
                    }
                    continue;
                }

                // Parse model line
                const parts = line.split('\t');
                if (parts.length >= 8) {
                    const model = {
                        name: parts[0],
                        inputWithCache: parseInt(parts[1].replace(/,/g, '')) || 0,
                        inputWithoutCache: parseInt(parts[2].replace(/,/g, '')) || 0,
                        cacheRead: parseInt(parts[3].replace(/,/g, '')) || 0,
                        output: parseInt(parts[4].replace(/,/g, '')) || 0,
                        totalTokens: parseInt(parts[5].replace(/,/g, '')) || 0,
                        apiCost: parseFloat(parts[6].replace('$', '')) || 0,
                        costToYou: parseFloat(parts[7].replace('$', '')) || 0
                    };
                    models.push(model);
                }
            }

            return { models, totalCost, totalTokens, billingPeriod };
        }

        // Format numbers
        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(2) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toLocaleString();
        }

        // Format currency
        function formatCurrency(amount) {
            return '$' + amount.toFixed(2);
        }

        // Generate model cards
        function generateModelCards(models) {
            const grid = document.getElementById('modelsGrid');
            grid.innerHTML = '';

            models.forEach((model, index) => {
                const colors = [
                    'from-blue-500 to-blue-600',
                    'from-purple-500 to-purple-600', 
                    'from-green-500 to-green-600',
                    'from-red-500 to-red-600',
                    'from-yellow-500 to-yellow-600'
                ];
                
                const costPercentage = model.totalTokens > 0 ? (model.apiCost / 400 * 100).toFixed(1) : 0;
                
                const card = `
                    <div class="model-card bg-white rounded-xl p-6 border border-gray-100">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="font-bold text-gray-800 truncate">${model.name}</h3>
                            <div class="w-3 h-3 rounded-full bg-gradient-to-r ${colors[index % colors.length]}"></div>
                        </div>
                        
                        <div class="space-y-3">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Total Tokens:</span>
                                <span class="font-semibold">${formatNumber(model.totalTokens)}</span>
                            </div>
                            
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">API Cost:</span>
                                <span class="font-semibold text-primary">${formatCurrency(model.apiCost)}</span>
                            </div>
                            
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Cost to You:</span>
                                <span class="font-bold text-secondary">${formatCurrency(model.costToYou)}</span>
                            </div>
                            
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-4">
                                <div class="bg-gradient-to-r ${colors[index % colors.length]} h-2 rounded-full" 
                                     style="width: ${Math.min(costPercentage, 100)}%"></div>
                            </div>
                            <div class="text-xs text-gray-500 text-center">${costPercentage}% of $400 limit</div>
                        </div>
                    </div>
                `;
                grid.innerHTML += card;
            });
        }

        // Generate usage table
        function generateUsageTable(models) {
            const tbody = document.getElementById('usageTableBody');
            tbody.innerHTML = '';

            models.forEach((model, index) => {
                const row = `
                    <tr class="${index % 2 === 0 ? 'bg-gray-50' : 'bg-white'}">
                        <td class="border border-gray-200 px-4 py-3 font-medium">${model.name}</td>
                        <td class="border border-gray-200 px-4 py-3 text-center">${model.inputWithCache.toLocaleString()}</td>
                        <td class="border border-gray-200 px-4 py-3 text-center">${model.inputWithoutCache.toLocaleString()}</td>
                        <td class="border border-gray-200 px-4 py-3 text-center">${model.cacheRead.toLocaleString()}</td>
                        <td class="border border-gray-200 px-4 py-3 text-center">${model.output.toLocaleString()}</td>
                        <td class="border border-gray-200 px-4 py-3 text-center font-semibold">${model.totalTokens.toLocaleString()}</td>
                        <td class="border border-gray-200 px-4 py-3 text-center font-semibold text-primary">${formatCurrency(model.apiCost)}</td>
                        <td class="border border-gray-200 px-4 py-3 text-center font-bold text-secondary">${formatCurrency(model.costToYou)}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        // Update insights
        function updateInsights(models, totalCost) {
            // Find top model by cost
            const topModel = models.reduce((max, model) => 
                model.apiCost > max.apiCost ? model : max, models[0] || {name: 'N/A'});
            
            document.getElementById('topModel').textContent = topModel.name || 'N/A';
            
            // Calculate cache hit rate
            const totalInputWithCache = models.reduce((sum, m) => sum + m.inputWithCache, 0);
            const totalCacheRead = models.reduce((sum, m) => sum + m.cacheRead, 0);
            const cacheRate = totalInputWithCache + totalCacheRead > 0 ? 
                ((totalCacheRead / (totalInputWithCache + totalCacheRead)) * 100).toFixed(1) : '0';
            
            document.getElementById('cacheRate').textContent = cacheRate + '%';
            
            // Daily average (assuming 31 days in month)
            const dailyAverage = totalCost / 31;
            document.getElementById('dailyAverage').textContent = formatCurrency(dailyAverage);
        }

        // Export report as JSON or print
        function exportReport() {
            const reportData = {
                generatedAt: new Date().toISOString(),
                billingPeriod: document.getElementById('billingPeriod').textContent,
                totalCost: document.getElementById('totalCost').textContent,
                totalTokens: document.getElementById('totalTokens').textContent,
                topModel: document.getElementById('topModel').textContent,
                cacheRate: document.getElementById('cacheRate').textContent,
                dailyAverage: document.getElementById('dailyAverage').textContent
            };
            
            // Create downloadable JSON file
            const blob = new Blob([JSON.stringify(reportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `cursor-usage-report-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            // Show success message
            const button = document.querySelector('button[onclick="exportReport()"]');
            const originalText = button.innerHTML;
            button.innerHTML = '<span>✅</span> Exported!';
            button.classList.add('bg-green-500');
            
            setTimeout(() => {
                button.innerHTML = originalText;
                button.classList.remove('bg-green-500');
            }, 2000);
        }

        // Enhanced data parsing to handle various formats
        function parseUsageData(data) {
            const lines = data.split('\n').filter(line => line.trim());
            const models = [];
            let totalCost = 0;
            let totalTokens = 0;
            let billingPeriod = '';

            // Extract billing period (multiple formats)
            const periodPatterns = [
                /Current billing period: (.+)/,
                /Billing period: (.+)/,
                /Period: (.+)/,
                /Date range: (.+)/
            ];
            
            for (const pattern of periodPatterns) {
                const match = data.match(pattern);
                if (match) {
                    billingPeriod = match[1];
                    break;
                }
            }

            // Find table data - more flexible parsing
            let tableData = [];
            let isInTable = false;
            let headerIndex = -1;
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                // Detect table header (various formats)
                if (line.toLowerCase().includes('model') && 
                    (line.toLowerCase().includes('input') || line.toLowerCase().includes('tokens') || line.toLowerCase().includes('cost'))) {
                    isInTable = true;
                    headerIndex = i;
                    continue;
                }
                
                // Parse table rows
                if (isInTable && line && !line.toLowerCase().startsWith('total')) {
                    // Split by tabs or multiple spaces
                    const parts = line.split(/\t|  +/).filter(p => p.trim());
                    
                    if (parts.length >= 3) {  // Minimum: model name, some tokens, some cost
                        const model = {
                            name: parts[0],
                            inputWithCache: 0,
                            inputWithoutCache: 0,
                            cacheRead: 0,
                            output: 0,
                            totalTokens: 0,
                            apiCost: 0,
                            costToYou: 0
                        };
                        
                        // Flexible field mapping
                        for (let j = 1; j < parts.length; j++) {
                            const part = parts[j].replace(/,/g, '');
                            
                            if (part.startsWith('$')) {
                                // This is a cost field
                                const cost = parseFloat(part.replace('$', '')) || 0;
                                if (model.apiCost === 0) {
                                    model.apiCost = cost;
                                } else {
                                    model.costToYou = cost;
                                }
                            } else if (!isNaN(parseInt(part))) {
                                // This is a number field (tokens)
                                const num = parseInt(part) || 0;
                                if (model.totalTokens === 0) {
                                    model.totalTokens = num;
                                } else if (model.inputWithCache === 0) {
                                    model.inputWithCache = num;
                                } else if (model.inputWithoutCache === 0) {
                                    model.inputWithoutCache = num;
                                } else if (model.cacheRead === 0) {
                                    model.cacheRead = num;
                                } else if (model.output === 0) {
                                    model.output = num;
                                }
                            }
                        }
                        
                        models.push(model);
                    }
                }
                
                // Handle total line
                if (line.toLowerCase().startsWith('total')) {
                    const parts = line.split(/\t|  +/).filter(p => p.trim());
                    for (const part of parts) {
                        if (part.startsWith('$')) {
                            totalCost = parseFloat(part.replace('$', '').replace(/,/g, '')) || 0;
                        } else if (!isNaN(parseInt(part.replace(/,/g, '')))) {
                            const num = parseInt(part.replace(/,/g, ''));
                            if (num > totalTokens) {
                                totalTokens = num;
                            }
                        }
                    }
                }
            }

            // If no totals found, calculate from models
            if (totalCost === 0) {
                totalCost = models.reduce((sum, model) => sum + model.apiCost, 0);
            }
            if (totalTokens === 0) {
                totalTokens = models.reduce((sum, model) => sum + model.totalTokens, 0);
            }

            return { models, totalCost, totalTokens, billingPeriod };
        }

        // Main generate report function
        function generateReport() {
            const data = document.getElementById('usageData').value;
            if (!data.trim()) {
                alert('Please enter usage data first');
                return;
            }

            const parsed = parseUsageData(data);
            const { models, totalCost, totalTokens, billingPeriod } = parsed;

            // Update billing period and timestamp
            if (billingPeriod) {
                document.getElementById('billingPeriod').textContent = billingPeriod;
            }
            document.getElementById('reportTimestamp').textContent = new Date().toLocaleString();

            // Update totals
            document.getElementById('totalCost').textContent = formatCurrency(totalCost);
            document.getElementById('totalTokens').textContent = formatNumber(totalTokens);

            // Update progress bars
            const costPercentage = (totalCost / 400) * 100;
            document.getElementById('costProgress').style.width = Math.min(costPercentage, 100) + '%';
            document.getElementById('costPercentage').textContent = costPercentage.toFixed(1) + '%';
            
            if (totalCost > 400) {
                document.getElementById('costOverage').textContent = `+${formatCurrency(totalCost - 400)} Free`;
                document.getElementById('costProgress').classList.add('bg-gradient-to-r', 'from-red-500', 'to-red-600');
            } else {
                document.getElementById('costOverage').textContent = `${formatCurrency(400 - totalCost)} Remaining`;
            }

            // Generate model cards and table
            generateModelCards(models);
            generateUsageTable(models);
            updateInsights(models, totalCost);

            // Show success message with animation
            const button = document.querySelector('button[onclick="generateReport()"]');
            const originalText = button.innerHTML;
            button.innerHTML = '<span>✅</span> Report Generated Successfully!';
            button.classList.remove('from-blue-500', 'to-blue-600');
            button.classList.add('from-green-500', 'to-green-600');
            
            setTimeout(() => {
                button.innerHTML = originalText;
                button.classList.remove('from-green-500', 'to-green-600');
                button.classList.add('from-blue-500', 'to-blue-600');
            }, 3000);
            
            // Auto-scroll to report
            document.getElementById('reportSection').scrollIntoView({ behavior: 'smooth' });
        }

        // Load sample data on page load
        window.addEventListener('load', () => {
            loadSampleData();
        });
    </script>

</body>
</html>
